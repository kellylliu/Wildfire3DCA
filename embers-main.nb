(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Wolfram 14.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       154,          7]
NotebookDataLength[    268640,       6118]
NotebookOptionsPosition[    261062,       6025]
NotebookOutlinePosition[    261495,       6042]
CellTagsIndexPosition[    261452,       6039]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$patchTypes", "=", 
    RowBox[{"<|", 
     RowBox[{
      RowBox[{"0", "->", "\"\<Empty/Burned\>\""}], ",", 
      RowBox[{"1", "->", "\"\<Grass\>\""}], ",", 
      RowBox[{"2", "->", "\"\<Sand\>\""}], ",", 
      RowBox[{"3", "->", "\"\<Rock/Concrete\>\""}], ",", 
      RowBox[{"4", "->", "\"\<Forest\>\""}], ",", 
      RowBox[{"5", "->", "\"\<Swamp\>\""}], ",", 
      RowBox[{"6", "->", "\"\<Lakes/Rivers\>\""}], ",", 
      RowBox[{"7", "->", "\"\<Clay\>\""}], ",", 
      RowBox[{"8", "->", "\"\<Dry grass\>\""}], ",", 
      RowBox[{"9", "->", "\"\<Shrubland\>\""}], ",", 
      RowBox[{"10", "->", "\"\<Agricultural crops\>\""}], ",", 
      RowBox[{"11", "->", "\"\<Urban area\>\""}], ",", 
      RowBox[{"12", "->", "\"\<Road\>\""}], ",", 
      RowBox[{"13", "->", "\"\<Snow/Ice\>\""}], ",", 
      RowBox[{"14", "->", "\"\<Burned soil\>\""}]}], "|>"}]}], ";"}], "  ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"old", " ", "fire", " ", "scar"}], ",", 
    RowBox[{
     RowBox[{"not", " ", "the", " ", "live"}], "-", 
     RowBox[{"burn", " ", "state"}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"$terrainLookup", "=", 
    RowBox[{"<|", 
     RowBox[{
      RowBox[{"0", "->", "Black"}], ",", 
      RowBox[{"1", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.39", ",", "0.71", ",", "0.34"}], "]"}]}], ",", 
      RowBox[{"(*", "grass", "*)"}], 
      RowBox[{"2", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.93", ",", "0.79", ",", "0.69"}], "]"}]}], ",", 
      RowBox[{"(*", "sand", "*)"}], 
      RowBox[{"3", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.60", ",", "0.60", ",", "0.60"}], "]"}]}], ",", 
      RowBox[{"(*", 
       RowBox[{"rock", "/", "concrete"}], "*)"}], 
      RowBox[{"4", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.13", ",", "0.55", ",", "0.13"}], "]"}]}], ",", 
      RowBox[{"(*", "forest", "*)"}], 
      RowBox[{"5", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.31", ",", "0.46", ",", "0.33"}], "]"}]}], ",", 
      RowBox[{"(*", "swamp", "*)"}], 
      RowBox[{"6", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.00", ",", "0.55", ",", "0.85"}], "]"}]}], ",", 
      RowBox[{"(*", "water", "*)"}], 
      RowBox[{"7", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.80", ",", "0.45", ",", "0.34"}], "]"}]}], ",", 
      RowBox[{"(*", "clay", "*)"}], 
      RowBox[{"8", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.85", ",", "0.70", ",", "0.30"}], "]"}]}], ",", 
      RowBox[{"(*", 
       RowBox[{"dry", " ", "grass"}], "*)"}], 
      RowBox[{"9", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.42", ",", "0.55", ",", "0.16"}], "]"}]}], ",", 
      RowBox[{"(*", "shrubland", "*)"}], 
      RowBox[{"10", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.80", ",", "0.72", ",", "0.48"}], "]"}]}], ",", 
      RowBox[{"(*", "crops", "*)"}], 
      RowBox[{"11", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.70", ",", "0.70", ",", "0.70"}], "]"}]}], ",", 
      RowBox[{"(*", "urban", "*)"}], 
      RowBox[{"12", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.30", ",", "0.30", ",", "0.30"}], "]"}]}], ",", 
      RowBox[{"(*", "road", "*)"}], 
      RowBox[{"13", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.95", ",", "0.95", ",", "0.95"}], "]"}]}], ",", 
      RowBox[{"(*", 
       RowBox[{"snow", "/", "ice"}], "*)"}], 
      RowBox[{"14", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.20", ",", "0.20", ",", "0.20"}], "]"}]}]}], "           ", 
     RowBox[{"(*", 
      RowBox[{"old", " ", "burn", " ", "scar"}], "*)"}], "|>"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"$terrainColorRules", "=", 
   RowBox[{"Normal", "[", "$terrainLookup", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.9607312972333164`*^9, 3.9607313129091167`*^9}, {
   3.960731353996256*^9, 3.9607313564877243`*^9}, {3.96073140213863*^9, 
   3.9607314167015686`*^9}, {3.9607321818480606`*^9, 
   3.9607322350213394`*^9}, {3.960732298035309*^9, 3.9607323184353733`*^9}, {
   3.960732396009285*^9, 3.9607324027871494`*^9}, {3.960733382536829*^9, 
   3.9607334200994473`*^9}, {3.960881490300865*^9, 3.9608814966926174`*^9}, {
   3.960972173230324*^9, 3.960972199275589*^9}, {3.961024934371357*^9, 
   3.9610249414439926`*^9}, 3.9610251115021324`*^9, {3.9610649465948296`*^9, 
   3.961064950341486*^9}, {3.961161153352501*^9, 3.9611611810871735`*^9}, 
   3.9611617329997463`*^9, 3.96325091309204*^9, 3.963250949453389*^9},
 CellLabel->
  "In[106]:=",ExpressionUUID->"ec872261-498c-8745-a3f8-cb83eb805c15"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$firePlotColorRules", "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"KeyDrop", "[", 
      RowBox[{"$terrainColorRules", ",", "0"}], "]"}], ",", 
     RowBox[{"(*", "terrain", "*)"}], 
     RowBox[{"AssociationThread", "[", 
      RowBox[{
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"20", ",", "30"}], "]"}], ",", 
         RowBox[{"{", "35", "}"}]}], "]"}], "->", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Blend", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Orange", ",", "Red"}], "}"}], ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"k", "-", "20"}], ")"}], "/", "10"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"k", ",", "20", ",", "30"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", "Black", "}"}]}], "]"}]}], "]"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.963250992426346*^9, 3.963250992429545*^9}, 
   3.963251212343421*^9, 3.963314236831297*^9},
 CellLabel->
  "In[109]:=",ExpressionUUID->"3096bf60-9e56-cd40-b74c-b96ccafc3a04"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getRandomEarthLocation", "[", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "continentalBoxes", ",", " ", "continentNames", ",", "selectedBox", ",", 
      " ", "lat", ",", "lon"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"continentalBoxes", "=", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"15", ",", "30"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "5"}], ",", "15"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"5", ",", "15"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "10"}], ",", "25"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"15", ",", "35"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "30"}], ",", 
            RowBox[{"-", "20"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"20", ",", "30"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"35", ",", "45"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "115"}], ",", 
            RowBox[{"-", "95"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"40", ",", "48"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "100"}], ",", 
            RowBox[{"-", "75"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"25", ",", "30"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "110"}], ",", 
            RowBox[{"-", "95"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"50", ",", "58"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "130"}], ",", 
            RowBox[{"-", "115"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "15"}], ",", 
            RowBox[{"-", "5"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "70"}], ",", 
            RowBox[{"-", "55"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "25"}], ",", 
            RowBox[{"-", "15"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "60"}], ",", 
            RowBox[{"-", "48"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "35"}], ",", 
            RowBox[{"-", "25"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "70"}], ",", 
            RowBox[{"-", "60"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"45", ",", "52"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "5"}], ",", "10"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"48", ",", "55"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"10", ",", "25"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"40", ",", "45"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "5"}], ",", "5"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"55", ",", "60"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"10", ",", "25"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"30", ",", "40"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"70", ",", "85"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"35", ",", "45"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"50", ",", "65"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"20", ",", "35"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"95", ",", "110"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"30", ",", "40"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"110", ",", "120"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"45", ",", "55"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"85", ",", "115"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"35", ",", "40"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"125", ",", "130"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "35"}], ",", 
            RowBox[{"-", "25"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"135", ",", "145"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "25"}], ",", 
            RowBox[{"-", "15"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"130", ",", "140"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "35"}], ",", 
            RowBox[{"-", "30"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"115", ",", "120"}], "}"}]}], "}"}]}], " ", "}"}]}], ";", 
     "\n", 
     RowBox[{"selectedBox", "=", 
      RowBox[{"RandomChoice", "[", "continentalBoxes", "]"}]}], ";", "\n", 
     RowBox[{"lat", "=", 
      RowBox[{"RandomReal", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"selectedBox", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"selectedBox", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "}"}], "]"}]}], ";", "\n", 
     RowBox[{"lon", "=", 
      RowBox[{"RandomReal", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"selectedBox", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"selectedBox", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "}"}], "]"}]}], ";", "\n", 
     RowBox[{"{", 
      RowBox[{"lat", ",", "lon"}], "}"}]}]}], "\n", "]"}]}]], "Input",
 CellChangeTimes->{{3.9607312972333164`*^9, 3.9607313129091167`*^9}, {
   3.960731353996256*^9, 3.9607313564877243`*^9}, {3.96073140213863*^9, 
   3.9607314167015686`*^9}, {3.9607321818480606`*^9, 
   3.9607322350213394`*^9}, {3.960732298035309*^9, 3.9607323184353733`*^9}, {
   3.960732396009285*^9, 3.960732416705759*^9}, {3.9608813134197807`*^9, 
   3.9608813184413586`*^9}, {3.9609763131541862`*^9, 
   3.9609764146850758`*^9}, {3.9610250074793015`*^9, 3.961025116894905*^9}, 
   3.961054587180338*^9, {3.961054621733692*^9, 3.9610546232368984`*^9}, 
   3.961055412356045*^9, 3.9611614093744183`*^9, {3.9611617387078342`*^9, 
   3.961161810822857*^9}, {3.961163262198103*^9, 3.9611632648128586`*^9}, 
   3.963314240316221*^9},
 CellLabel->
  "In[110]:=",ExpressionUUID->"e7078143-e7d5-0c4b-9ecd-4fd8e55d41ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"calculateGeoRange", "[", 
    RowBox[{"rangeKM", ":", " ", "1.0"}], "]"}], " ", ":=", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"range", "=", 
      RowBox[{"gridSize", "*", "0.01"}]}], ";"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Quantity", "[", 
    RowBox[{"rangeKM", ",", " ", "\"\<Kilometers\>\""}], "]"}]}], 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.9607312972333164`*^9, 3.9607313129091167`*^9}, {
   3.960731353996256*^9, 3.9607313564877243`*^9}, {3.96073140213863*^9, 
   3.9607314167015686`*^9}, {3.9607321818480606`*^9, 
   3.9607322350213394`*^9}, {3.960732298035309*^9, 3.9607323184353733`*^9}, {
   3.960732396009285*^9, 3.960732416705759*^9}, {3.9608813134197807`*^9, 
   3.9608813184413586`*^9}, {3.9609763131541862`*^9, 
   3.9609764146850758`*^9}, {3.9610250074793015`*^9, 3.961025116894905*^9}, 
   3.961054587180338*^9, {3.961054621733692*^9, 3.9610546221468487`*^9}, 
   3.961055465134651*^9, {3.9610556246698112`*^9, 3.961055628388954*^9}, 
   3.9611614272838783`*^9, {3.9611618146794815`*^9, 3.9611618177373314`*^9}, {
   3.9623622250750504`*^9, 3.962362275617817*^9}, {3.962365296266522*^9, 
   3.9623652975291843`*^9}, {3.9623653606618547`*^9, 3.9623653651459303`*^9}, 
   3.962365410840514*^9},
 CellLabel->
  "In[111]:=",ExpressionUUID->"5c708908-e4dd-a040-bb40-0a18c6c525a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"build", " ", "once"}], "\[Dash]", "rules", ",", 
    RowBox[{"NOT", " ", "an", " ", "Association"}]}], "*)"}], 
  RowBox[{
   RowBox[{"nearestRules", "=", 
    RowBox[{"Thread", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Values", "[", "$terrainLookup", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ";;"}], "]"}], "]"}], "   ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"skip", " ", "code"}], "-", 
        RowBox[{"0", " ", "black"}]}], "*)"}], "->", 
      RowBox[{"Range", "[", 
       RowBox[{"1", ",", 
        RowBox[{
         RowBox[{"Length", "[", "$terrainLookup", "]"}], "-", "1"}]}], 
       "]"}]}], "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.9632511600668163`*^9, 3.963251161270218*^9}},
 CellLabel->
  "In[112]:=",ExpressionUUID->"e2fd2e29-d6ab-3b42-99f1-4e629672631d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"assignTerrain", "[", 
    RowBox[{"location_", ",", "gridSize_", ",", 
     RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"range", ",", "imgRGB"}], "}"}], ",", 
     RowBox[{
      RowBox[{"range", "=", 
       RowBox[{"Quantity", "[", 
        RowBox[{"rangeKM", ",", "\"\<Kilometers\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"imgRGB", "=", 
       RowBox[{"ImageData", "@", 
        RowBox[{"ImageResize", "[", 
         RowBox[{
          RowBox[{"GeoImage", "[", 
           RowBox[{
            RowBox[{"GeoPosition", "[", "location", "]"}], ",", 
            RowBox[{"GeoRange", "->", "range"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"gridSize", ",", "gridSize"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"First", "@", 
         RowBox[{"Nearest", "[", 
          RowBox[{"nearestRules", ",", 
           RowBox[{"RGBColor", "@", 
            RowBox[{"imgRGB", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "gridSize"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "gridSize"}], "}"}]}], "]"}]}]}], "]"}]}], 
  "\n"}]], "Input",
 CellChangeTimes->{{3.963251178157927*^9, 3.963251182671644*^9}},
 CellLabel->
  "In[113]:=",ExpressionUUID->"707ae6fe-563c-744a-89d5-7463c13bcb30"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getRealElevationData", "[", 
   RowBox[{"location_", ",", "gridSize_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "elevData", ",", "range", ",", "normalizedElev", ",", "resampled"}], 
     "}"}], ",", 
    RowBox[{
     RowBox[{"range", "=", 
      RowBox[{"gridSize", "*", "0.01"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"elevData", "=", 
      RowBox[{"QuantityMagnitude", "[", 
       RowBox[{"GeoElevationData", "[", 
        RowBox[{"GeoRange", "->", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"GeoPosition", "[", 
            RowBox[{"location", "-", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"range", ",", "range"}], "}"}], "/", "2"}]}], "]"}], ",", 
           RowBox[{"GeoPosition", "[", 
            RowBox[{"location", "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"range", ",", "range"}], "}"}], "/", "2"}]}], "]"}]}], 
          "}"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"normalizedElev", "=", 
      RowBox[{"Rescale", "[", 
       RowBox[{"elevData", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Min", "[", "elevData", "]"}], ",", 
          RowBox[{"Max", "[", "elevData", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"resampled", "=", 
      RowBox[{"ArrayResample", "[", 
       RowBox[{"normalizedElev", ",", 
        RowBox[{"{", 
         RowBox[{"gridSize", ",", "gridSize"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "resampled"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.962389536642228*^9, 3.962389536644046*^9}},
 CellLabel->
  "In[114]:=",ExpressionUUID->"ec1eceb4-c53f-5c46-a622-04f53923f1eb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mapTerrainValues", "[", 
   RowBox[{"gridSize_", ",", 
    RowBox[{"location_", ":", "Automatic"}], ",", " ", 
    RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "terrainAndElev", ",", "terrainGrid", ",", "elevationHeights", ",", 
      "newArray"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"terrainAndElev", "=", 
      RowBox[{"initializeTerrainGrid", "[", 
       RowBox[{"gridSize", ",", "location", ",", " ", "rangeKM"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"terrainGrid", "=", 
      RowBox[{"terrainAndElev", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"elevationHeights", "=", 
      RowBox[{"terrainAndElev", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"newArray", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"elevationHeights", "[", 
           RowBox[{"[", 
            RowBox[{"x", ",", "y"}], "]"}], "]"}], ",", 
          RowBox[{"terrainGrid", "[", 
           RowBox[{"[", 
            RowBox[{"x", ",", "y"}], "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "gridSize"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "gridSize"}], "}"}]}], "]"}]}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.9607312972333164`*^9, 3.9607313129091167`*^9}, {
   3.960731353996256*^9, 3.9607313564877243`*^9}, {3.96073140213863*^9, 
   3.9607314167015686`*^9}, {3.9607321818480606`*^9, 
   3.9607322350213394`*^9}, {3.960732298035309*^9, 3.9607323184353733`*^9}, {
   3.960732396009285*^9, 3.960732416705759*^9}, {3.9608813134197807`*^9, 
   3.9608813184413586`*^9}, {3.9609763131541862`*^9, 3.9609764543840504`*^9}, 
   3.9609765106269207`*^9, {3.961025160876356*^9, 3.9610251741719456`*^9}, 
   3.9610545939473534`*^9, 3.9611614212568607`*^9, {3.961161897657299*^9, 
   3.961161904513279*^9}, {3.961164841789873*^9, 3.9611648434981194`*^9}, {
   3.9623682141937466`*^9, 3.9623682494116974`*^9}, {3.96236858811434*^9, 
   3.9623685963667927`*^9}},
 CellLabel->
  "In[115]:=",ExpressionUUID->"7acbf94e-f5b9-4749-9b68-60bc17f9e244"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"identifyWater", "[", 
    RowBox[{"loc_", ",", "n_", ",", "rangeKM_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"waterColor", "=", 
        RowBox[{"RGBColor", "[", 
         RowBox[{"0.6", ",", ".8078", ",", "1"}], "]"}]}], ",", "range", ",", 
       "originalGeo", ",", "graphics", ",", "img", ",", "mask", ",", "grid"}],
       "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{"1", " ", "\[RightPointer]", " ", "fetch", " ", "map"}], "*)"}], 
     RowBox[{
      RowBox[{"range", "=", 
       RowBox[{"Quantity", "[", 
        RowBox[{"rangeKM", ",", " ", "\"\<Kilometers\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"originalGeo", "=", 
       RowBox[{"GeoGraphics", "[", 
        RowBox[{
         RowBox[{"GeoCenter", "->", 
          RowBox[{"GeoPosition", "[", "loc", "]"}]}], ",", 
         RowBox[{"GeoRange", "->", "range"}], ",", 
         RowBox[{"GeoBackground", "->", "\"\<VectorMinimal\>\""}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"graphics", "=", 
       RowBox[{"Normal", "[", "originalGeo", "]"}]}], ";", 
      RowBox[{"graphics", "=", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{"graphics", ",", "_Text", ",", "\[Infinity]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Echo", "[", "graphics", "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "2", " ", "\[RightPointer]", " ", "rasterise", " ", "at", " ", 
        "higher", " ", "resolution", " ", "to", " ", "avoid", " ", 
        "aliasing"}], "*)"}], 
      RowBox[{"img", "=", 
       RowBox[{"Rasterize", "[", 
        RowBox[{"graphics", ",", 
         RowBox[{"RasterSize", "->", 
          RowBox[{"10", "n"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "3", " ", "\[RightPointer]", " ", "mask", " ", "everything", " ", 
        "close", " ", "to", " ", "waterColor"}], "*)"}], 
      RowBox[{"mask", "=", 
       RowBox[{"Binarize", "[", 
        RowBox[{
         RowBox[{"ColorDistance", "[", 
          RowBox[{"img", ",", "waterColor"}], "]"}], ",", "0.05"}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Echo", "[", "mask", "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"ImageResize", "[", 
        RowBox[{"mask", ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"N", "[", 
       RowBox[{"1", "-", 
        RowBox[{"ImageData", "[", "grid", "]"}]}], "]"}]}]}], 
    "               ", "]"}]}], "\n"}]], "Input",
 CellChangeTimes->{{3.9623683177309933`*^9, 3.962368317734364*^9}, {
   3.962368381647605*^9, 3.962368418425329*^9}, {3.96236845177631*^9, 
   3.962368520123461*^9}, {3.9623687989490833`*^9, 3.962368808789357*^9}, {
   3.962368853854206*^9, 3.962368900999669*^9}, {3.962369054118259*^9, 
   3.9623690543511047`*^9}, {3.962369203738324*^9, 3.96236923135912*^9}, {
   3.962382996414213*^9, 3.962383051864419*^9}, 3.962389246498955*^9, {
   3.962389837976549*^9, 3.962389839951273*^9}, {3.9623898907032537`*^9, 
   3.962389919266252*^9}, {3.9623907314890957`*^9, 3.9623907400102777`*^9}},
 CellLabel->
  "In[116]:=",ExpressionUUID->"db6a00bb-150a-4946-b664-4f0d96327d47"],

Cell[BoxData[
 RowBox[{
  RowBox[{"initializeTerrainGrid", "[", 
   RowBox[{"gridSize_", ",", 
    RowBox[{"location_", ":", "Automatic"}], ",", 
    RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "actualLocation", ",", "terrain", ",", "waterMask", ",", "elevation", ",",
       "i", ",", "j"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"actualLocation", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"location", "===", "Automatic"}], ",", "\[IndentingNewLine]", 
        RowBox[{"getRandomEarthLocation", "[", "]"}], ",", 
        "\[IndentingNewLine]", "location"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"terrain", "=", 
      RowBox[{"assignTerrain", "[", 
       RowBox[{"actualLocation", ",", "gridSize", ",", "rangeKM"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"waterMask", "=", 
      RowBox[{"identifyWater", "[", 
       RowBox[{"actualLocation", ",", "gridSize", ",", "rangeKM"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"terrain", " ", "=", " ", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Which", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"waterMask", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "1"}], ",", "6", ",",
           "True", ",", 
          RowBox[{"terrain", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}]}], " ", 
         "\[IndentingNewLine]", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "gridSize"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "gridSize"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"elevation", "=", 
      RowBox[{"getRealElevationData", "[", 
       RowBox[{"actualLocation", ",", "gridSize"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"terrain", ",", "elevation"}], "}"}]}]}], "\[IndentingNewLine]",
    "]"}]}]], "Input",
 CellChangeTimes->{{3.9607312972333164`*^9, 3.9607313129091167`*^9}, {
   3.960731353996256*^9, 3.9607313564877243`*^9}, {3.96073140213863*^9, 
   3.9607314167015686`*^9}, {3.9607321818480606`*^9, 
   3.9607322350213394`*^9}, {3.960732298035309*^9, 3.9607323184353733`*^9}, {
   3.960732396009285*^9, 3.960732416705759*^9}, {3.9608813134197807`*^9, 
   3.9608813184413586`*^9}, {3.9609763131541862`*^9, 
   3.9609764543840504`*^9}, {3.9609765106269207`*^9, 3.960976585656376*^9}, {
   3.961025320535204*^9, 3.961025335556656*^9}, 3.961144573650751*^9, {
   3.962309353182472*^9, 3.9623093533045006`*^9}, {3.9623095691751137`*^9, 
   3.9623095848981113`*^9}, 3.9623096197150993`*^9, {3.9623098523241787`*^9, 
   3.9623098594188385`*^9}, {3.9623368488988943`*^9, 3.962336854389511*^9}, {
   3.9623623875916862`*^9, 3.9623624185703583`*^9}, 3.962389961785133*^9, {
   3.9623904877100153`*^9, 3.9623904899830723`*^9}, 3.9623905404607553`*^9, {
   3.962390722198144*^9, 3.962390725429488*^9}},
 CellLabel->
  "In[117]:=",ExpressionUUID->"8dbef89e-d692-6f49-b071-d7d38c73c568"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"getPatchProperties", "[", "code_", "]"}], ":=", 
   RowBox[{"Switch", "[", 
    RowBox[{"code", ",", "1", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "2"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "2"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "2"}]}], "|>"}], ",", 
     RowBox[{"(*", "grass", "*)"}], "2", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "5"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "3"}]}], "|>"}], ",", 
     RowBox[{"(*", "sand", "*)"}], "3", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "5"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "5"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "4"}]}], "|>"}], ",", 
     RowBox[{"(*", "rock", "*)"}], "4", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "1"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "1"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "1"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "1"}]}], "|>"}], ",", 
     RowBox[{"(*", "forest", "*)"}], "5", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "5"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "2"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "2"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "5"}]}], "|>"}], ",", 
     RowBox[{"(*", "swamp", "*)"}], "6", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "1"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "6"}]}], "|>"}], ",", 
     RowBox[{"(*", "water", "*)"}], "7", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "3"}]}], "|>"}], ",", 
     RowBox[{"(*", "clay", "*)"}], "8", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "2"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "5"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "2"}]}], "|>"}], ",", 
     RowBox[{"(*", 
      RowBox[{"dry", " ", "grass"}], "*)"}], "9", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "2"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "5"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "3"}]}], "|>"}], ",", 
     RowBox[{"(*", "shrubland", "*)"}], "10", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "5"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "3"}]}], "|>"}], ",", 
     RowBox[{"(*", "crops", "*)"}], "11", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "1"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "4"}]}], "|>"}], ",", 
     RowBox[{"(*", "urban", "*)"}], "12", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "1"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "4"}]}], "|>"}], ",", 
     RowBox[{"(*", "road", "*)"}], "13", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "0"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "6"}]}], "|>"}], ",", 
     RowBox[{"(*", 
      RowBox[{"snow", "/", "ice"}], "*)"}], "14", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "0"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "6"}]}], "|>"}], ",", 
     RowBox[{"(*", 
      RowBox[{"old", " ", "burn", " ", "scar"}], "*)"}], "_", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "3"}]}], "|>"}]}], "]"}]}], 
  "\n"}]], "Input",
 CellChangeTimes->{{3.963250976442923*^9, 3.963250976446097*^9}},
 CellLabel->
  "In[118]:=",ExpressionUUID->"8ecbfd1b-0aa8-3940-9388-fa3a3005ad16"],

Cell[BoxData[
 RowBox[{
  RowBox[{"calculateSlopeFactor", "[", 
   RowBox[{
   "currentElev_", ",", "neighborElev_", ",", "uphillMultiplier_", ",", 
    "downhillMultiplier_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"slope", ",", "factor"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"slope", "=", 
      RowBox[{"neighborElev", "-", "currentElev"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Which", "[", 
      RowBox[{
       RowBox[{"slope", ">", "0"}], ",", 
       RowBox[{"1", "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"uphillMultiplier", "-", "1"}], ")"}], "*", 
         RowBox[{"Tanh", "[", 
          RowBox[{"slope", "*", "10"}], "]"}]}]}], ",", 
       RowBox[{"slope", "<", "0"}], ",", 
       RowBox[{"1", "-", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "-", "downhillMultiplier"}], ")"}], "*", 
         RowBox[{"Tanh", "[", 
          RowBox[{
           RowBox[{"Abs", "[", "slope", "]"}], "*", "10"}], "]"}]}]}], ",", 
       "True", ",", "1.0"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607312972333164`*^9, 3.9607313129091167`*^9}, {
   3.960731353996256*^9, 3.9607313564877243`*^9}, {3.96073140213863*^9, 
   3.9607314167015686`*^9}, {3.9607321818480606`*^9, 
   3.9607322350213394`*^9}, {3.960732298035309*^9, 3.9607323184353733`*^9}, {
   3.960732396009285*^9, 3.960732416705759*^9}, {3.9608813134197807`*^9, 
   3.9608813184413586`*^9}, {3.9610794855878716`*^9, 3.961079509457304*^9}, {
   3.9610797121795464`*^9, 3.961079730922962*^9}, {3.961113243295084*^9, 
   3.9611132451408253`*^9}, 3.961161248057001*^9, {3.961161925120142*^9, 
   3.9611619253812065`*^9}},
 CellLabel->
  "In[119]:=",ExpressionUUID->"b5fa2306-2b5b-df40-a334-11a80f71b061"],

Cell[BoxData[
 RowBox[{
  RowBox[{"fireSpreadRule", "[", 
   RowBox[{
   "terrainGrid_", ",", "fireGrid_", ",", "elevationGrid_", ",", "gridSize_", 
    ",", "ignitionProbability_", ",", "windSpeed_", ",", "windDirection_", ",",
     "moisture_", ",", "uphillMultiplier_", ",", "downhillMultiplier_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"newGrid", "=", "fireGrid"}], ",", "currentTerrain", ",", 
      "currentFire", ",", "currentElev", ",", "patchProps", ",", "neighbors", 
      ",", 
      RowBox[{"totalHeat", "=", "0"}], ",", "burnTimeLeft", ",", "nTerrain", ",",
       "nFire", ",", "nElev", ",", "distance", ",", "nProps", ",", 
      "radiationStr", ",", "windQ", ",", "slopeFactor", ",", "emberProd"}], 
     "}"}], ",", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"currentTerrain", "=", 
         RowBox[{"terrainGrid", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"currentFire", "=", 
         RowBox[{"fireGrid", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"currentElev", "=", 
         RowBox[{"elevationGrid", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"patchProps", "=", 
         RowBox[{"getPatchProperties", "[", "currentTerrain", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"currentTerrain", "==", "6"}], "||", 
           RowBox[{"currentTerrain", "==", "3"}]}], ",", "Null", ",", 
          RowBox[{"0", "<", "currentFire", "<=", "10"}], ",", 
          RowBox[{
           RowBox[{"burnTimeLeft", "=", 
            RowBox[{"currentFire", "-", "1"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"newGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"burnTimeLeft", "<=", "0"}], ",", "11", ",", 
              "burnTimeLeft"}], "]"}]}]}], ",", 
          RowBox[{"currentFire", "==", "11"}], ",", "Null", ",", 
          RowBox[{"currentFire", "==", "0"}], ",", 
          RowBox[{
           RowBox[{"neighbors", "=", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"i", "-", "1"}], ",", 
                  RowBox[{"j", "-", "1"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"i", "-", "1"}], ",", "j"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"i", "-", "1"}], ",", 
                  RowBox[{"j", "+", "1"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", 
                  RowBox[{"j", "-", "1"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", 
                  RowBox[{"j", "+", "1"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"i", "+", "1"}], ",", 
                  RowBox[{"j", "-", "1"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"i", "+", "1"}], ",", "j"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"i", "+", "1"}], ",", 
                  RowBox[{"j", "+", "1"}]}], "}"}]}], "}"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"1", "<=", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "<=", "gridSize"}], "&&", 
                RowBox[{"1", "<=", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "<=", "gridSize"}]}], 
               "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"totalHeat", "=", "0"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"nTerrain", "=", 
               RowBox[{"terrainGrid", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"neighbor", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"neighbor", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"nFire", "=", 
               RowBox[{"fireGrid", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"neighbor", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"neighbor", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"nElev", "=", 
               RowBox[{"elevationGrid", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"neighbor", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"neighbor", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"0", "<", "nFire", "<=", "10"}], ",", 
                RowBox[{
                 RowBox[{"distance", "=", 
                  RowBox[{"Norm", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"neighbor", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "i"}], ",", 
                    RowBox[{
                    RowBox[{"neighbor", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "-", "j"}]}], "}"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"nProps", "=", 
                  RowBox[{"getPatchProperties", "[", "nTerrain", "]"}]}], ";",
                  "\[IndentingNewLine]", 
                 RowBox[{"radiationStr", "=", 
                  RowBox[{"7", "-", 
                   RowBox[{
                   "nProps", "[", "\"\<radiationStrength\>\"", "]"}]}]}], ";",
                  "\[IndentingNewLine]", 
                 RowBox[{"slopeFactor", "=", 
                  RowBox[{"calculateSlopeFactor", "[", 
                   RowBox[{
                   "currentElev", ",", "nElev", ",", "uphillMultiplier", ",", 
                    "downhillMultiplier"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"totalHeat", "+=", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"radiationStr", "*", "slopeFactor"}], ")"}], "/", 
                   RowBox[{"(", 
                    RowBox[{"1", "+", "distance"}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"windQ", "=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"windDirection", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "*", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"neighbor", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "-", "j"}], ")"}]}], "+", 
                    RowBox[{
                    RowBox[{"windDirection", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "*", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"neighbor", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "i"}], ")"}]}]}], ">",
                    "0.3"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{"windQ", ",", 
                   RowBox[{
                    RowBox[{"emberProd", "=", 
                    RowBox[{"7", "-", 
                    RowBox[{
                    "nProps", "[", "\"\<emberProduction\>\"", "]"}]}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"totalHeat", "+=", 
                    RowBox[{
                    "emberProd", "*", "windSpeed", "*", "slopeFactor"}]}], 
                    ";"}]}], "]"}], ";"}]}], "]"}], ";"}], ",", 
             RowBox[{"{", 
              RowBox[{"neighbor", ",", "neighbors"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"totalHeat", ">", "0"}], ",", 
             RowBox[{"Module", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "flammability", ",", "heatResistance", ",", "moistureEffect", 
                 ",", "ignitionChance"}], "}"}], ",", 
               RowBox[{
                RowBox[{"flammability", "=", 
                 RowBox[{"7", "-", 
                  RowBox[{
                  "patchProps", "[", "\"\<flammability\>\"", "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"heatResistance", "=", 
                 RowBox[{"patchProps", "[", "\"\<heatResistance\>\"", "]"}]}],
                 ";", "\[IndentingNewLine]", 
                RowBox[{"moistureEffect", "=", 
                 RowBox[{"1", "-", "moisture"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"ignitionChance", "=", 
                 RowBox[{"Min", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    "totalHeat", "*", "flammability", "*", "moistureEffect", "*",
                     "ignitionProbability"}], ")"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"heatResistance", "*", "8"}], ")"}]}], ",", 
                   "0.9"}], "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"RandomReal", "[", "]"}], "<", "ignitionChance"}], 
                  ",", 
                  RowBox[{
                   RowBox[{"newGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
                   RowBox[{"patchProps", "[", "\"\<burnTime\>\"", "]"}]}]}], 
                 "]"}], ";"}]}], "]"}]}], "]"}]}]}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "gridSize"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "gridSize"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "newGrid"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607312972333164`*^9, 3.9607313129091167`*^9}, {
   3.960731353996256*^9, 3.9607313564877243`*^9}, {3.96073140213863*^9, 
   3.9607314167015686`*^9}, {3.9607321818480606`*^9, 
   3.9607322350213394`*^9}, {3.960732298035309*^9, 3.9607323184353733`*^9}, {
   3.960732396009285*^9, 3.960732416705759*^9}, {3.9608813134197807`*^9, 
   3.9608813353514137`*^9}, {3.960881374362566*^9, 3.960881374776224*^9}, {
   3.9609725635078583`*^9, 3.960972668860792*^9}, {3.960972730514366*^9, 
   3.9609727340503006`*^9}, {3.9610531550978775`*^9, 3.961053201829853*^9}, {
   3.9610602647350616`*^9, 3.961060397577238*^9}, 3.961078236162508*^9, {
   3.9611132508056755`*^9, 3.9611132628333225`*^9}, {3.961161356266527*^9, 
   3.9611613627322235`*^9}, {3.9611619292987976`*^9, 3.9611619392986774`*^9}, 
   3.961163490981146*^9, {3.9641268582308025`*^9, 3.964126874310734*^9}},
 CellLabel->
  "In[120]:=",ExpressionUUID->"02f9d060-2b92-3645-928e-2c404b6a5751"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"fireSpreadRuleWithEmbers", "[", 
    RowBox[{
    "terrainGrid_", ",", "fireGrid_", ",", "elevationGrid_", ",", 
     "emberGrid_", ",", "gridSize_", ",", "ignitionProbability_", ",", 
     "windSpeed_", ",", "windDirection_", ",", "moisture_", ",", 
     "uphillMultiplier_", ",", "downhillMultiplier_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"newGrid", ",", "newEmberGrid"}], "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{
      "Original", " ", "fire", " ", "spread", " ", "for", " ", "adjacent", " ",
        "cells"}], "*)"}], 
     RowBox[{
      RowBox[{"newGrid", "=", 
       RowBox[{"fireSpreadRule", "[", 
        RowBox[{
        "terrainGrid", ",", "fireGrid", ",", "elevationGrid", ",", "gridSize",
          ",", "ignitionProbability", ",", "windSpeed", ",", "windDirection", 
         ",", "moisture", ",", "uphillMultiplier", ",", 
         "downhillMultiplier"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Disperse", " ", "embers", " ", "from", " ", "burning", " ", "cells"}],
        "*)"}], 
      RowBox[{"newEmberGrid", "=", 
       RowBox[{"disperseEmbers", "[", 
        RowBox[{
        "terrainGrid", ",", "newGrid", ",", "elevationGrid", ",", "emberGrid",
          ",", "gridSize", ",", "windSpeed", ",", "windDirection"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Check", " ", "for", " ", "spot", " ", "fire", " ", "ignitions", " ", 
        "from", " ", "ember", " ", "accumulation"}], "*)"}], 
      RowBox[{"newGrid", "=", 
       RowBox[{"checkSpotFireIgnition", "[", 
        RowBox[{
        "terrainGrid", ",", "newGrid", ",", "newEmberGrid", ",", 
         "elevationGrid", ",", "moisture", ",", "gridSize"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"newGrid", ",", "newEmberGrid"}], "}"}]}]}], "]"}]}], 
  "\n"}]], "Input",
 CellChangeTimes->{{3.9607312972333164`*^9, 3.9607313129091167`*^9}, {
   3.960731353996256*^9, 3.9607313564877243`*^9}, {3.96073140213863*^9, 
   3.9607314167015686`*^9}, {3.9607321818480606`*^9, 
   3.9607322350213394`*^9}, {3.960732298035309*^9, 3.9607323184353733`*^9}, {
   3.960732396009285*^9, 3.960732416705759*^9}, {3.9608813134197807`*^9, 
   3.9608813353514137`*^9}, {3.960881374362566*^9, 3.960881374776224*^9}, {
   3.9609725635078583`*^9, 3.960972668860792*^9}, {3.960972730514366*^9, 
   3.9609727340503006`*^9}, {3.9610531550978775`*^9, 3.961053201829853*^9}, {
   3.9610602647350616`*^9, 3.961060397577238*^9}, 3.961078236162508*^9, {
   3.9611132508056755`*^9, 3.9611132628333225`*^9}, {3.961161356266527*^9, 
   3.9611613627322235`*^9}, {3.9611619292987976`*^9, 3.9611619392986774`*^9}, 
   3.961163490981146*^9, {3.9641268582308025`*^9, 3.9641268750324345`*^9}},
 CellLabel->
  "In[121]:=",ExpressionUUID->"ae2d832c-59aa-014d-a0a1-132ab3c0d118"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plotTerrain", "[", 
   RowBox[{"terrainGrid_", ",", 
    RowBox[{"title_", ":", "\"\<\>\""}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"ArrayPlot", "[", 
   RowBox[{"terrainGrid", ",", 
    RowBox[{"ColorRules", "->", "$terrainColorRules"}], ",", 
    RowBox[{"Mesh", "->", "False"}], ",", 
    RowBox[{"ImageSize", "->", "200"}], ",", 
    RowBox[{"PlotLabel", "->", "title"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, 3.9608824257727604`*^9, 
   3.9610568691381607`*^9, {3.9610570265792694`*^9, 3.961057030013502*^9}, {
   3.961059462398344*^9, 3.96105951470018*^9}, 3.9611613290315094`*^9},
 CellLabel->
  "In[122]:=",ExpressionUUID->"d87f1353-4342-de40-9863-ebf7a79690d3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"plotFire", "[", 
    RowBox[{"fireGrid_", ",", "terrainGrid_", ",", 
     RowBox[{"title_", ":", "\"\<\>\""}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "display", "}"}], ",", 
     RowBox[{
      RowBox[{"display", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Which", "[", 
          RowBox[{
           RowBox[{"1", "<=", 
            RowBox[{"fireGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "<=", "10"}], ",", 
           RowBox[{"20", "+", 
            RowBox[{"fireGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
           RowBox[{"(*", 
            RowBox[{"20", "-", "30"}], "*)"}], 
           RowBox[{
            RowBox[{"fireGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "11"}], ",", "35", 
           ",", 
           RowBox[{"(*", "charred", "*)"}], "True", ",", 
           RowBox[{"terrainGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "fireGrid", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"fireGrid", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ArrayPlot", "[", 
       RowBox[{"display", ",", 
        RowBox[{"ColorRules", "->", "$firePlotColorRules"}], ",", 
        RowBox[{"Mesh", "->", "False"}], ",", 
        RowBox[{"ImageSize", "->", "400"}], ",", 
        RowBox[{"PlotLabel", "->", "title"}]}], "]"}]}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, 3.9608824257727604`*^9, 
   3.9610568691381607`*^9, {3.9610570265792694`*^9, 3.961057030013502*^9}, {
   3.961059462398344*^9, 3.9610594808719406`*^9}, 3.9610953904857044`*^9, {
   3.9611571910689354`*^9, 3.961157195129633*^9}, 3.9611613361552563`*^9, 
   3.9632512308381567`*^9},
 CellLabel->
  "In[123]:=",ExpressionUUID->"2ea035cc-b2d6-3749-93c6-fcd8fadf2038"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plotAllFireRegions", "[", 
   RowBox[{
   "terrainGrids_", ",", "fireGrids_", ",", "numRows_", ",", "numCols_"}], 
   "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "plots", "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"plots", " ", "=", " ", 
      RowBox[{"Table", "[", "\n", 
       RowBox[{
        RowBox[{"plotFire", "[", 
         RowBox[{
          RowBox[{"fireGrids", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
          RowBox[{"terrainGrids", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
          RowBox[{"\"\<Region(\>\"", "<>", 
           RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<,\>\"", "<>", 
           RowBox[{"ToString", "[", "j", "]"}], "<>", "\"\<)\>\""}]}], "]"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "numRows"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Grid", "[", 
      RowBox[{"plots", ",", 
       RowBox[{"Spacings", "->", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}]}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, 3.9608824257727604`*^9, 
   3.9610568691381607`*^9, {3.9610570265792694`*^9, 3.961057030013502*^9}, {
   3.961059462398344*^9, 3.9610594808719406`*^9}, 3.9610953904857044`*^9, {
   3.9611571910689354`*^9, 3.9611571914774647`*^9}, 3.961161341893038*^9},
 CellLabel->
  "In[124]:=",ExpressionUUID->"1e55fdb2-fd20-894b-97ad-c9b4ab13f4b6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"getUnburnedPositions", "[", "fireGrid_", "]"}], ":=", 
   RowBox[{"Position", "[", 
    RowBox[{"fireGrid", ",", "0"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"getBurningPositions", "[", "fireGrid_", "]"}], ":=", 
   RowBox[{"Position", "[", 
    RowBox[{"fireGrid", ",", 
     RowBox[{"y_", "/;", 
      RowBox[{"1", "<=", "y", "<=", "10"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"getBurnedPositions", "[", "fireGrid_", "]"}], ":=", 
   RowBox[{"Position", "[", 
    RowBox[{"fireGrid", ",", "11"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, {3.960882428063238*^9, 
   3.9608824586046505`*^9}, 3.960882500531225*^9, {3.9610793033353176`*^9, 
   3.961079379380127*^9}, 3.961161275076906*^9},
 CellLabel->
  "In[125]:=",ExpressionUUID->"2283654e-e278-d946-a977-15c2ee13fbd4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"countUnburned", "[", "fireGrid_", "]"}], ":=", 
   RowBox[{"Count", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", "fireGrid", "]"}], ",", "0"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"countBurning", "[", "fireGrid_", "]"}], ":=", 
   RowBox[{"Count", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", "fireGrid", "]"}], ",", 
     RowBox[{"y_", "/;", 
      RowBox[{"1", "<=", "y", "<=", "10"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"countBurned", "[", "fireGrid_", "]"}], ":=", 
   RowBox[{"Count", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", "fireGrid", "]"}], ",", "11"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, {3.960882428063238*^9, 
   3.9608824586046505`*^9}, 3.960882500531225*^9, {3.9610793033353176`*^9, 
   3.961079441345209*^9}, 3.9610995579307327`*^9, 3.9610998217466946`*^9, 
   3.961099991019785*^9, 3.9611511163739376`*^9, {3.9611612688435955`*^9, 
   3.961161270968628*^9}, {3.961161960540848*^9, 3.961161960764654*^9}, {
   3.964126779466425*^9, 3.964126785522379*^9}},
 CellLabel->
  "In[128]:=",ExpressionUUID->"8e222a23-4365-a841-8c5c-7478fc5ec5a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"calculateEmberDistance", "[", 
   RowBox[{"fireIntensity_", ",", "windSpeed_", ",", "elevation_", ",", 
    RowBox[{"baseDistance_", ":", "5"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "distance", "}"}], ",", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
       RowBox[{"Fire", " ", "intensity", " ", "1"}], "-", "10"}], ",", 
      RowBox[{"higher", "=", 
       RowBox[{"farther", " ", "embers"}]}]}], "*)"}], 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
       RowBox[{"Wind", " ", "speed", " ", "0"}], "-", "1"}], ",", 
      RowBox[{"higher", "=", 
       RowBox[{"farther", " ", "travel"}]}]}], "*)"}], 
    RowBox[{"(*", 
     RowBox[{
     "Elevation", " ", "factor", " ", "for", " ", "ridge", " ", "effects"}], 
     "*)"}], 
    RowBox[{
     RowBox[{"distance", "=", 
      RowBox[{"baseDistance", "*", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"fireIntensity", "/", "5"}]}], ")"}], "*", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"windSpeed", "*", "3"}]}], ")"}], "*", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"elevation", "*", "0.5"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Min", "[", 
      RowBox[{"distance", ",", "20"}], "]"}]}]}], " ", 
   RowBox[{"(*", 
    RowBox[{
    "Cap", " ", "at", " ", "20", " ", "cells", " ", "max", " ", "distance"}], 
    "*)"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, {3.960882428063238*^9, 
   3.9608824586046505`*^9}, 3.960882500531225*^9, {3.9610793033353176`*^9, 
   3.961079441345209*^9}, 3.9610995579307327`*^9, 3.9610998217466946`*^9, 
   3.961099991019785*^9, 3.9611511163739376`*^9, {3.9611612688435955`*^9, 
   3.961161270968628*^9}, {3.961161960540848*^9, 3.961161960764654*^9}, {
   3.964126779466425*^9, 3.964126800411766*^9}},
 CellLabel->
  "In[131]:=",ExpressionUUID->"223bbd27-b475-324a-a29b-cfddc3b2d168"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generateEmberLandingProbability", "[", 
   RowBox[{
   "sourcePos_", ",", "targetPos_", ",", "windDirection_", ",", "windSpeed_", 
    ",", "maxDistance_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "distance", ",", "angleAlignment", ",", "prob", ",", "windVector"}], 
     "}"}], ",", 
    RowBox[{
     RowBox[{"distance", "=", 
      RowBox[{"Norm", "[", 
       RowBox[{"targetPos", "-", "sourcePos"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"distance", ">", "maxDistance"}], ",", 
       RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Base", " ", "probability", " ", "decreases", " ", "with", " ", 
       "distance"}], "*)"}], 
     RowBox[{"prob", "=", 
      RowBox[{"Exp", "[", 
       RowBox[{
        RowBox[{"-", "distance"}], "/", 
        RowBox[{"(", 
         RowBox[{"maxDistance", "/", "3"}], ")"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Wind", " ", "alignment", " ", "increases", " ", "probability", " ", 
       "in", " ", "downwind", " ", "direction"}], "*)"}], 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"distance", ">", "0"}], ",", 
       RowBox[{
        RowBox[{"windVector", "=", 
         RowBox[{"Normalize", "[", 
          RowBox[{"targetPos", "-", "sourcePos"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"angleAlignment", "=", 
         RowBox[{"Max", "[", 
          RowBox[{"0", ",", 
           RowBox[{"windVector", ".", "windDirection"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"prob", "*=", 
         RowBox[{"(", 
          RowBox[{"1", "+", 
           RowBox[{"angleAlignment", "*", "windSpeed", "*", "2"}]}], ")"}]}], 
        ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Add", " ", "some", " ", "randomness", " ", "for", " ", "realistic", " ",
        "scatter"}], "*)"}], 
     RowBox[{"prob", "*", 
      RowBox[{"RandomReal", "[", 
       RowBox[{"{", 
        RowBox[{"0.8", ",", "1.2"}], "}"}], "]"}]}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, {3.960882428063238*^9, 
   3.9608824586046505`*^9}, 3.960882500531225*^9, {3.9610793033353176`*^9, 
   3.961079441345209*^9}, 3.9610995579307327`*^9, 3.9610998217466946`*^9, 
   3.961099991019785*^9, 3.9611511163739376`*^9, {3.9611612688435955`*^9, 
   3.961161270968628*^9}, {3.961161960540848*^9, 3.961161960764654*^9}, {
   3.964126779466425*^9, 3.964126809348297*^9}},
 CellLabel->
  "In[132]:=",ExpressionUUID->"3d57b8e4-f5fe-db43-adf7-8b5e633c5dfd"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"initializeEmberGrid", "[", "gridSize_", "]"}], ":=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"gridSize", ",", "gridSize"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, {3.960882428063238*^9, 
   3.9608824586046505`*^9}, 3.960882500531225*^9, {3.9610793033353176`*^9, 
   3.961079441345209*^9}, 3.9610995579307327`*^9, 3.9610998217466946`*^9, 
   3.961099991019785*^9, 3.9611511163739376`*^9, {3.9611612688435955`*^9, 
   3.961161270968628*^9}, {3.961161960540848*^9, 3.961161960764654*^9}, {
   3.964126779466425*^9, 3.9641268275439186`*^9}},
 CellLabel->
  "In[133]:=",ExpressionUUID->"a979d1d7-5bcf-d746-911c-be8b98ed540b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"disperseEmbers", "[", 
   RowBox[{
   "terrainGrid_", ",", "fireGrid_", ",", "elevationGrid_", ",", "emberGrid_",
     ",", "gridSize_", ",", "windSpeed_", ",", "windDirection_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"newEmberGrid", "=", "emberGrid"}], ",", "burningCells", ",", 
      "emberCount", ",", "targetCells", ",", "landingProb", ",", "maxDist", ",",
       "fireIntensity", ",", "elevation", ",", "terrain", ",", "props"}], 
     "}"}], ",", 
    RowBox[{"(*", 
     RowBox[{
     "Find", " ", "all", " ", "actively", " ", "burning", " ", "cells"}], 
     "*)"}], 
    RowBox[{
     RowBox[{"burningCells", "=", 
      RowBox[{"Position", "[", 
       RowBox[{"fireGrid", ",", 
        RowBox[{"x_", "/;", 
         RowBox[{"1", "<=", "x", "<=", "10"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Process", " ", "each", " ", "burning", " ", "cell"}], "*)"}], 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"terrain", "=", 
         RowBox[{"terrainGrid", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"cell", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"cell", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"props", "=", 
         RowBox[{"getPatchProperties", "[", "terrain", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Ember", " ", "production", " ", "based", " ", "on", " ", "fuel", " ",
           "type", " ", "and", " ", "fire", " ", "intensity"}], "*)"}], 
        RowBox[{"emberCount", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"7", "-", 
            RowBox[{"props", "[", "\"\<emberProduction\>\"", "]"}]}], ")"}], "*", 
          RowBox[{
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"cell", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"cell", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "/", "3"}]}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"emberCount", "=", 
         RowBox[{"Round", "[", 
          RowBox[{"emberCount", "*", 
           RowBox[{"RandomReal", "[", 
            RowBox[{"{", 
             RowBox[{"0.5", ",", "1.5"}], "}"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"emberCount", ">", "0"}], ",", 
          RowBox[{"(*", 
           RowBox[{
           "Calculate", " ", "maximum", " ", "ember", " ", "travel", " ", 
            "distance"}], "*)"}], 
          RowBox[{
           RowBox[{"fireIntensity", "=", 
            RowBox[{"fireGrid", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"cell", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"cell", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"elevation", "=", 
            RowBox[{"elevationGrid", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"cell", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"cell", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"maxDist", "=", 
            RowBox[{"calculateEmberDistance", "[", 
             RowBox[{"fireIntensity", ",", "windSpeed", ",", "elevation"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Generate", " ", "ember", " ", "landing", " ", "positions"}], 
            "*)"}], 
           RowBox[{"Table", "[", 
            RowBox[{"(*", 
             RowBox[{
             "Sample", " ", "potential", " ", "landing", " ", "positions"}], 
             "*)"}], 
            RowBox[{
             RowBox[{
              RowBox[{"targetCells", "=", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"Module", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    "angle", ",", "dist", ",", "targetX", ",", "targetY"}], 
                    "}"}], ",", 
                   RowBox[{"(*", 
                    RowBox[{
                    "Bias", " ", "angle", " ", "toward", " ", "wind", " ", 
                    "direction"}], "*)"}], 
                   RowBox[{
                    RowBox[{"angle", "=", 
                    RowBox[{
                    RowBox[{"RandomReal", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "Pi"}], ",", "Pi"}], "}"}], "]"}], "+", 
                    RowBox[{"ArcTan", "[", 
                    RowBox[{
                    RowBox[{"windDirection", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"windDirection", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"dist", "=", 
                    RowBox[{"RandomReal", "[", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", "maxDist"}], "}"}], "]"}]}], ";", 
                    RowBox[{"(*", 
                    RowBox[{"Skip", " ", "immediate", " ", "neighbors"}], 
                    "*)"}], 
                    RowBox[{"targetX", "=", 
                    RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{"cell", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{"dist", "*", 
                    RowBox[{"Cos", "[", "angle", "]"}]}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"targetY", "=", 
                    RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{"cell", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", 
                    RowBox[{"dist", "*", 
                    RowBox[{"Sin", "[", "angle", "]"}]}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"Check", " ", "bounds"}], "*)"}], 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"1", "<=", "targetX", "<=", "gridSize"}], "&&", 
                    RowBox[{"1", "<=", "targetY", "<=", "gridSize"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"targetX", ",", "targetY"}], "}"}], ",", 
                    "Nothing"}], "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", "5", "}"}]}], "]"}]}], ";", 
              RowBox[{"(*", 
               RowBox[{
               "Try", " ", "5", " ", "potential", " ", "positions", " ", 
                "per", " ", "ember"}], "*)"}], 
              RowBox[{"(*", 
               RowBox[{
               "Select", " ", "best", " ", "landing", " ", "position", " ", 
                "based", " ", "on", " ", "probability"}], "*)"}], 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "targetCells", "]"}], ">", "0"}], ",", 
                RowBox[{
                 RowBox[{"Module", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"bestPos", ",", 
                    RowBox[{"bestProb", "=", "0"}], ",", "prob"}], "}"}], ",", 
                   RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"prob", "=", 
                    RowBox[{"generateEmberLandingProbability", "[", 
                    RowBox[{
                    "cell", ",", "pos", ",", "windDirection", ",", 
                    "windSpeed", ",", "maxDist"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"prob", ">", "bestProb"}], "&&", 
                    RowBox[{
                    RowBox[{"terrainGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"pos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"pos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "!=", 
                    "6"}]}], ",", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"Don", "'"}], "t", " ", "land", " ", "on", " ", 
                    "water"}], "*)"}], 
                    RowBox[{
                    RowBox[{"bestProb", "=", "prob"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"bestPos", "=", "pos"}], ";"}]}], "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"pos", ",", "targetCells"}], "}"}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"bestProb", ">", "0.1"}], ",", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Threshold", " ", "for", " ", "successful", " ", "ember", 
                    " ", "landing"}], "*)"}], 
                    RowBox[{
                    RowBox[{
                    RowBox[{"newEmberGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"bestPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"bestPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "+=", 
                    RowBox[{"RandomReal", "[", 
                    RowBox[{"{", 
                    RowBox[{"0.5", ",", "1.5"}], "}"}], "]"}]}], ";"}]}], 
                    "]"}], ";"}]}], "]"}], ";"}]}], "]"}]}], ",", 
             RowBox[{"{", "emberCount", "}"}]}], "]"}], ";"}]}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"cell", ",", "burningCells"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Decay", " ", "old", " ", "embers"}], "*)"}], 
     RowBox[{"newEmberGrid", "=", 
      RowBox[{"newEmberGrid", "*", "0.9"}]}], ";", "\[IndentingNewLine]", 
     "newEmberGrid"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, {3.960882428063238*^9, 
   3.9608824586046505`*^9}, 3.960882500531225*^9, {3.9610793033353176`*^9, 
   3.961079441345209*^9}, 3.9610995579307327`*^9, 3.9610998217466946`*^9, 
   3.961099991019785*^9, 3.9611511163739376`*^9, {3.9611612688435955`*^9, 
   3.961161270968628*^9}, {3.961161960540848*^9, 3.961161960764654*^9}, {
   3.964126779466425*^9, 3.964126837300646*^9}},
 CellLabel->
  "In[134]:=",ExpressionUUID->"1fcc9f02-132b-3f42-9c86-354d15febb11"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"checkSpotFireIgnition", "[", 
    RowBox[{
    "terrainGrid_", ",", "fireGrid_", ",", "emberGrid_", ",", 
     "elevationGrid_", ",", "moisture_", ",", "gridSize_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"newFireGrid", "=", "fireGrid"}], ",", "emberThreshold", ",", 
       "ignitionProb", ",", "terrain", ",", "props", ",", "emberLevel"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"fireGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "0"}], "&&", 
           RowBox[{
            RowBox[{"emberGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], ">", "0"}]}], ",", 
          RowBox[{"(*", 
           RowBox[{
           "Cell", " ", "is", " ", "not", " ", "burning", " ", "but", " ", 
            "has", " ", "embers"}], "*)"}], 
          RowBox[{
           RowBox[{"terrain", "=", 
            RowBox[{"terrainGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"props", "=", 
            RowBox[{"getPatchProperties", "[", "terrain", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"emberLevel", "=", 
            RowBox[{"emberGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Higher", " ", "ember", " ", "accumulation"}], "=", 
             RowBox[{"higher", " ", "ignition", " ", "chance"}]}], "*)"}], 
           RowBox[{"(*", 
            RowBox[{
            "Moisture", " ", "reduces", " ", "ignition", " ", "probability"}],
             "*)"}], 
           RowBox[{"emberThreshold", "=", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"props", "[", "\"\<heatResistance\>\"", "]"}], "/", 
               "6"}], ")"}], "*", 
             RowBox[{"(", 
              RowBox[{"1", "+", 
               RowBox[{"moisture", "*", "2"}]}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"emberLevel", ">", "emberThreshold"}], ",", 
             RowBox[{
              RowBox[{"ignitionProb", "=", 
               RowBox[{"Min", "[", 
                RowBox[{"0.8", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"emberLevel", "-", "emberThreshold"}], ")"}], "/", 
                  "5"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"ignitionProb", "*=", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"7", "-", 
                  RowBox[{"props", "[", "\"\<flammability\>\"", "]"}]}], 
                 ")"}], "/", "6"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"ignitionProb", "*=", 
               RowBox[{"(", 
                RowBox[{"1", "-", "moisture"}], ")"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"RandomReal", "[", "]"}], "<", "ignitionProb"}], ",", 
                RowBox[{"(*", 
                 RowBox[{"Spot", " ", "fire", " ", 
                  RowBox[{"ignites", "!"}]}], "*)"}], 
                RowBox[{
                 RowBox[{
                  RowBox[{"newFireGrid", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
                  RowBox[{"props", "[", "\"\<burnTime\>\"", "]"}]}], ";"}]}], 
               "]"}], ";"}]}], "]"}], ";"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "gridSize"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "gridSize"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "newFireGrid"}]}], "]"}]}], "\n"}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, {3.960882428063238*^9, 
   3.9608824586046505`*^9}, 3.960882500531225*^9, {3.9610793033353176`*^9, 
   3.961079441345209*^9}, 3.9610995579307327`*^9, 3.9610998217466946`*^9, 
   3.961099991019785*^9, 3.9611511163739376`*^9, {3.9611612688435955`*^9, 
   3.961161270968628*^9}, {3.961161960540848*^9, 3.961161960764654*^9}, {
   3.964126779466425*^9, 3.9641268387019672`*^9}},
 CellLabel->
  "In[135]:=",ExpressionUUID->"7540be41-7e27-2343-974c-efb6768d1272"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"runFireSimulation", "[", 
   RowBox[{
    RowBox[{"gridSize_", ":", "80"}], ",", 
    RowBox[{"initialFires_", ":", "2"}], ",", 
    RowBox[{"timeSteps_", ":", "100"}], ",", 
    RowBox[{"ignitionProbability_", ":", "0.8"}], ",", 
    RowBox[{"windSpeed_", ":", "0.3"}], ",", 
    RowBox[{"windDirection_", ":", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}]}], ",", 
    RowBox[{"moisture_", ":", "0.2"}], ",", 
    RowBox[{"numRows_", ":", "1"}], ",", 
    RowBox[{"numCols_", ":", "1"}], ",", 
    RowBox[{"interRegionSpreadProb_", ":", "0.5"}], ",", 
    RowBox[{"uphillMultiplier_", ":", "1.5"}], ",", 
    RowBox[{"downhillMultiplier_", ":", "0.7"}], ",", 
    RowBox[{"location_", ":", "Automatic"}], ",", 
    RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "terrainGrids", ",", "elevationGrids", ",", "fireGrids", ",", 
      "unburnedPositions", ",", 
      RowBox[{"firePoints", "=", 
       RowBox[{"{", "}"}]}], ",", "terrainAndElev", ",", "actualLocation", ",",
       "result", ",", "gridPos"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"actualLocation", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"location", "===", "Automatic"}], ",", 
        RowBox[{"getRandomEarthLocation", "[", "]"}], ",", "location"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"terrainGrids", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"elevationGrids", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"terrainAndElev", "=", 
         RowBox[{"initializeTerrainGrid", "[", 
          RowBox[{"gridSize", ",", "actualLocation", ",", "rangeKM"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"terrainGrids", ",", 
          RowBox[{"terrainAndElev", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"elevationGrids", ",", 
          RowBox[{"terrainAndElev", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "numRows"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"terrainGrids", "=", 
      RowBox[{"ArrayReshape", "[", 
       RowBox[{"terrainGrids", ",", 
        RowBox[{"{", 
         RowBox[{
         "numRows", ",", "numCols", ",", "gridSize", ",", "gridSize"}], 
         "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"elevationGrids", "=", 
      RowBox[{"ArrayReshape", "[", 
       RowBox[{"elevationGrids", ",", 
        RowBox[{"{", 
         RowBox[{
         "numRows", ",", "numCols", ",", "gridSize", ",", "gridSize"}], 
         "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fireGrids", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"gridSize", ",", "gridSize"}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "numRows"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"unburnedPositions", "=", 
      RowBox[{"getUnburnedPositions", "[", 
       RowBox[{"fireGrids", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"unburnedPositions", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"unburnedPositions", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"terrainGrids", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "!=", "6"}], 
         "&"}]}], "]"}]}], ";", 
     RowBox[{"result", "=", 
      RowBox[{"DialogInput", "[", 
       RowBox[{"DynamicModule", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"currentPoint", "=", 
            RowBox[{"{", 
             RowBox[{"15", ",", "15"}], "}"}]}], ",", 
           RowBox[{"selectedPoints", "=", 
            RowBox[{"{", "}"}]}]}], "}"}], ",", 
         RowBox[{"Column", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
            "Text", "[", "\"\<Click on the terrain to place fire starting \
points\>\"", "]"}], ",", 
            RowBox[{"Text", "[", 
             RowBox[{"Dynamic", "[", 
              RowBox[{"\"\<Points selected: \>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"Length", "[", "selectedPoints", "]"}], "]"}], 
               "<>", "\"\</\>\"", "<>", 
               RowBox[{"ToString", "[", "initialFires", "]"}]}], "]"}], "]"}],
             ",", 
            RowBox[{"LocatorPane", "[", 
             RowBox[{
              RowBox[{"Dynamic", "[", "currentPoint", "]"}], ",", 
              RowBox[{"plotAllFireRegions", "[", 
               RowBox[{
               "terrainGrids", ",", "fireGrids", ",", "numRows", ",", 
                "numCols"}], "]"}], ",", 
              RowBox[{"Appearance", "->", 
               RowBox[{"Graphics", "[", 
                RowBox[{"{", 
                 RowBox[{"Red", ",", 
                  RowBox[{"PointSize", "[", "0.05", "]"}], ",", 
                  RowBox[{"Point", "[", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], "]"}]}], "}"}], "]"}]}]}],
              "]"}], ",", 
            RowBox[{"Row", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Add Fire Point\>\"", ",", 
                 RowBox[{
                  RowBox[{"gridPos", "=", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Clip", "[", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{"gridSize", "-", 
                    RowBox[{"currentPoint", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "gridSize"}], "}"}]}], "]"}], ",", 
                    RowBox[{"Clip", "[", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{"currentPoint", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "gridSize"}], "}"}]}], "]"}]}], "}"}]}],
                   ";", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"terrainGrids", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1", ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "!=", 
                    "6"}], "&&", 
                    RowBox[{
                    RowBox[{"terrainGrids", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1", ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "!=", 
                    "3"}]}], ",", 
                    RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"selectedPoints", ",", "gridPos"}], "]"}], ";"}], 
                    ",", 
                    RowBox[{
                    "MessageDialog", 
                    "[", "\"\<Cannot place fire on water!\>\"", "]"}]}], 
                   "]"}]}], ",", 
                 RowBox[{"Enabled", "->", 
                  RowBox[{"Dynamic", "[", 
                   RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], "<", 
                    "initialFires"}], "]"}]}]}], "]"}], ",", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Reset\>\"", ",", 
                 RowBox[{"selectedPoints", "=", 
                  RowBox[{"{", "}"}]}]}], "]"}], ",", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Run Simulation\>\"", ",", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], ">", 
                    "0"}], ",", 
                   RowBox[{"DialogReturn", "[", "selectedPoints", "]"}], ",", 
                   RowBox[{
                   "MessageDialog", 
                    "[", "\"\<Please select at least one fire point!\>\"", 
                    "]"}]}], "]"}], ",", 
                 RowBox[{"Enabled", "->", 
                  RowBox[{"Dynamic", "[", 
                   RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], ">", 
                    "0"}], "]"}]}]}], "]"}], ",", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Cancel\>\"", ",", 
                 RowBox[{"DialogReturn", "[", "$Canceled", "]"}]}], "]"}]}], 
              "}"}], "]"}]}], "}"}], "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"result", "===", "$Canceled"}], ",", 
       RowBox[{
        RowBox[{"Echo", "[", "\"\<Simulation canceled by user.\>\"", "]"}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "$Canceled", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "result", "]"}], "==", "0"}], ",", 
       RowBox[{
        RowBox[{"Echo", "[", "\"\<No fire points selected.\>\"", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"firePoints", "=", "result"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Echo", "[", 
      RowBox[{"{", 
       RowBox[{"\"\<Starting simulation with \>\"", ",", 
        RowBox[{"Length", "[", "firePoints", "]"}], 
        ",", "\"\< fire points at: \>\"", ",", "firePoints"}], "}"}], "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"showBurnFireGrids", "[", 
      RowBox[{
      "firePoints", ",", "terrainGrids", ",", "elevationGrids", ",", 
       "fireGrids", ",", "numRows", ",", "numCols", ",", "gridSize", ",", 
       "ignitionProbability", ",", "windSpeed", ",", "windDirection", ",", 
       "moisture", ",", "interRegionSpreadProb", ",", "timeSteps", ",", 
       "initialFires", ",", "uphillMultiplier", ",", "downhillMultiplier", ",",
        "actualLocation", ",", "rangeKM"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, {3.9608823687401543`*^9, 3.9608823766538296`*^9}, {
   3.9608824979550247`*^9, 3.960882498579052*^9}, 3.960882550603531*^9, 
   3.9609741155886116`*^9, 3.9610535090859127`*^9, {3.961055558796732*^9, 
   3.961055559991287*^9}, {3.9610557112636375`*^9, 3.961055745647846*^9}, 
   3.961058588091799*^9, {3.9610606024089317`*^9, 3.961060648068531*^9}, 
   3.961078275949913*^9, {3.9610954066951866`*^9, 3.961095443284231*^9}, 
   3.9611009698623714`*^9, {3.9611574860470314`*^9, 3.961157486150364*^9}, 
   3.9611606772820854`*^9, 3.9611613945502415`*^9, {3.9611619806772175`*^9, 
   3.961162026992628*^9}, 3.961163652467371*^9, {3.961165097552368*^9, 
   3.9611650982630424`*^9}, {3.9611652771644154`*^9, 
   3.9611653019519176`*^9}, {3.961170857695324*^9, 3.961170886261444*^9}, {
   3.962362055247761*^9, 3.9623620711064453`*^9}, {3.9623624322774105`*^9, 
   3.962362460774046*^9}, {3.9623626973702164`*^9, 3.9623627218169193`*^9}, {
   3.962362753719263*^9, 3.962362773246792*^9}, {3.962363071822918*^9, 
   3.9623631218902073`*^9}, {3.9623646329692163`*^9, 3.962364635062722*^9}, 
   3.962365071828312*^9, {3.962365380910968*^9, 3.96236538651917*^9}, {
   3.9623678178476315`*^9, 3.962367866326542*^9}, {3.9623690718316956`*^9, 
   3.962369072737461*^9}, {3.963314340103853*^9, 3.9633143462170267`*^9}},
 CellLabel->
  "In[136]:=",ExpressionUUID->"f97df745-1b35-0645-8e96-b5d659be6eb4"],

Cell[BoxData[
 TemplateBox[{
  "Pattern", "patm", 
   "\"Too many (\\!\\(\\*RowBox[{\\\"14\\\"}]\\)) optional arguments required \
in \\!\\(\\*RowBox[{\\\"runFireSimulation\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \
\\\"[\\\", RowBox[{\\\"1\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"80\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"2\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"2\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"3\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"100\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"4\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"0.8`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"5\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"0.3`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"6\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{\\\"1\\\", \\\
\",\\\", \\\"0\\\"}], \\\"}\\\"}]}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"7\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"0.2`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"8\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"1\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"9\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"1\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"10\\\", \\\",\\\", \\\
\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"0.5`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"11\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"1.5`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"12\\\", \\\",\\\", \\\
\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"0.7`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"13\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"Automatic\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \
\\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"14\\\", \\\
\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"1.`\\\"}], \\\"]\\\"}]}], \
\\\"]\\\"}]\\).\"", 2, 136, 10, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{
  3.9623678699529305`*^9, 3.9623686642971306`*^9, {3.9623690739988766`*^9, 
   3.9623690847223988`*^9}, 3.9623695961164284`*^9, 3.9623700341548805`*^9, 
   3.962382636260741*^9, 3.96238305726261*^9, 3.9623892228668423`*^9, 
   3.962389564265596*^9, 3.962389873589664*^9, 3.962389924324864*^9, 
   3.9623899674578753`*^9, 3.9623904624773903`*^9, 3.962390783125682*^9, 
   3.962398039470965*^9, 3.9623984985057716`*^9, 3.9624111652147713`*^9, 
   3.9624876621731243`*^9, 3.962639738512211*^9, 3.963250999522291*^9, 
   3.963251365516972*^9, 3.963294715087214*^9, 3.9632952342897587`*^9, 
   3.9633133706826878`*^9, 3.963313579928974*^9, 3.9633143498689737`*^9, 
   3.9633143977733793`*^9, 3.9633146038008623`*^9, 3.96332797166319*^9, 
   3.963328121889558*^9, 3.963328335926527*^9, 3.963328906593665*^9, 
   3.963329260807644*^9, 3.963329395973377*^9, 3.963329787328619*^9, 
   3.963329835444066*^9, 3.963329972445209*^9, 3.963330141206808*^9, 
   3.964124952974621*^9, 3.9641269713230343`*^9, 3.964127203151016*^9},
 CellLabel->
  "During evaluation of \
In[136]:=",ExpressionUUID->"9557876c-88e1-ff43-a57f-df32c6139751"],

Cell[BoxData[
 TemplateBox[{
  "Pattern", "patm", 
   "\"Too many (\\!\\(\\*RowBox[{\\\"14\\\"}]\\)) optional arguments required \
in \\!\\(\\*RowBox[{\\\"runFireSimulation\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \
\\\"[\\\", RowBox[{\\\"1\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"80\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"2\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"2\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"3\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"100\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"4\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"0.8`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"5\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"0.3`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"6\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{\\\"1\\\", \\\
\",\\\", \\\"0\\\"}], \\\"}\\\"}]}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"7\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"0.2`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"8\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"1\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"9\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"1\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"10\\\", \\\",\\\", \\\
\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"0.5`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"11\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"1.5`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"12\\\", \\\",\\\", \\\
\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"0.7`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"13\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"Automatic\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \
\\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"14\\\", \\\
\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"1.`\\\"}], \\\"]\\\"}]}], \
\\\"]\\\"}]\\).\"", 2, 136, 11, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{
  3.9623678699529305`*^9, 3.9623686642971306`*^9, {3.9623690739988766`*^9, 
   3.9623690847223988`*^9}, 3.9623695961164284`*^9, 3.9623700341548805`*^9, 
   3.962382636260741*^9, 3.96238305726261*^9, 3.9623892228668423`*^9, 
   3.962389564265596*^9, 3.962389873589664*^9, 3.962389924324864*^9, 
   3.9623899674578753`*^9, 3.9623904624773903`*^9, 3.962390783125682*^9, 
   3.962398039470965*^9, 3.9623984985057716`*^9, 3.9624111652147713`*^9, 
   3.9624876621731243`*^9, 3.962639738512211*^9, 3.963250999522291*^9, 
   3.963251365516972*^9, 3.963294715087214*^9, 3.9632952342897587`*^9, 
   3.9633133706826878`*^9, 3.963313579928974*^9, 3.9633143498689737`*^9, 
   3.9633143977733793`*^9, 3.9633146038008623`*^9, 3.96332797166319*^9, 
   3.963328121889558*^9, 3.963328335926527*^9, 3.963328906593665*^9, 
   3.963329260807644*^9, 3.963329395973377*^9, 3.963329787328619*^9, 
   3.963329835444066*^9, 3.963329972445209*^9, 3.963330141206808*^9, 
   3.964124952974621*^9, 3.9641269713230343`*^9, 3.9641272031665516`*^9},
 CellLabel->
  "During evaluation of \
In[136]:=",ExpressionUUID->"8ea980ce-2fec-4443-a9ef-47897437a661"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"interRegionFireSpread", "[", 
   RowBox[{
   "terrainGrids_", ",", "fireGrids_", ",", "gridSize_", ",", "numRows_", ",",
     "numCols_", ",", "interRegionSpreadProb_", ",", "windSpeed_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"updatedFireGrids", "=", "fireGrids"}], "}"}], ",", 
    "\[IndentingNewLine]", "updatedFireGrids"}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, {3.9608823687401543`*^9, 3.9608823766538296`*^9}, {
   3.9608824979550247`*^9, 3.960882498579052*^9}, 3.960882550603531*^9, 
   3.9609741155886116`*^9, 3.9610535090859127`*^9, {3.961055558796732*^9, 
   3.961055559991287*^9}, {3.9610557112636375`*^9, 3.961055745647846*^9}, 
   3.961058588091799*^9, {3.9610606024089317`*^9, 3.961060648068531*^9}, 
   3.961078275949913*^9, {3.9610954066951866`*^9, 3.961095443284231*^9}, 
   3.9611009698623714`*^9, {3.9611574860470314`*^9, 3.961157486150364*^9}, 
   3.9611606772820854`*^9, 3.9611613945502415`*^9, {3.9611619806772175`*^9, 
   3.961162026992628*^9}, {3.961163652467371*^9, 3.9611636558065033`*^9}, 
   3.961163811226879*^9},
 CellLabel->
  "In[137]:=",ExpressionUUID->"bcf4bdbd-b468-654a-ba10-ede5f21afbc8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"updateAllFireRegionsWithEmbers", "[", 
   RowBox[{
   "terrainGrids_", ",", "fireGrids_", ",", "elevationGrids_", ",", 
    "emberGrids_", ",", "gridSize_", ",", "numRows_", ",", "numCols_", ",", 
    "ignitionProbability_", ",", "windSpeed_", ",", "windDirection_", ",", 
    "moisture_", ",", "interRegionSpreadProb_", ",", "uphillMultiplier_", ",",
     "downhillMultiplier_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"updatedFireGrids", ",", "updatedEmberGrids", ",", "result"}], 
     "}"}], ",", 
    RowBox[{"(*", 
     RowBox[{"Initialize", " ", "output", " ", "grids"}], "*)"}], 
    RowBox[{
     RowBox[{"updatedFireGrids", "=", "fireGrids"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"updatedEmberGrids", "=", "emberGrids"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Update", " ", "each", " ", "region"}], "*)"}], 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"result", "=", 
         RowBox[{"fireSpreadRuleWithEmbers", "[", 
          RowBox[{
           RowBox[{"terrainGrids", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
           RowBox[{"fireGrids", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
           RowBox[{"elevationGrids", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
           RowBox[{"emberGrids", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", "gridSize", ",", 
           "ignitionProbability", ",", "windSpeed", ",", "windDirection", ",",
            "moisture", ",", "uphillMultiplier", ",", "downhillMultiplier"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"updatedFireGrids", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
         RowBox[{"result", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"updatedEmberGrids", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
         RowBox[{"result", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ";"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "numRows"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Handle", " ", "inter"}], "-", 
       RowBox[{"region", " ", "spread", " ", "if", " ", "needed"}]}], "*)"}], 
     RowBox[{"updatedFireGrids", "=", 
      RowBox[{"interRegionFireSpread", "[", 
       RowBox[{
       "terrainGrids", ",", "updatedFireGrids", ",", "gridSize", ",", 
        "numRows", ",", "numCols", ",", "interRegionSpreadProb", ",", 
        "windSpeed"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"updatedFireGrids", ",", "updatedEmberGrids"}], "}"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, {3.9608823687401543`*^9, 3.9608823766538296`*^9}, {
   3.9608824979550247`*^9, 3.960882498579052*^9}, {3.960882550603531*^9, 
   3.9608825892607193`*^9}, {3.9608826200954094`*^9, 3.960882668139206*^9}, {
   3.9610800357627487`*^9, 3.9610800676855316`*^9}, 3.9610954506060543`*^9, {
   3.961146433585226*^9, 3.9611464342639084`*^9}, 3.96116137437595*^9, {
   3.961162030923668*^9, 3.9611620336377506`*^9}, {3.9641268953573513`*^9, 
   3.9641269107883854`*^9}},
 CellLabel->
  "In[138]:=",ExpressionUUID->"372c6aae-98f9-5a47-9cd8-f9171e99d78b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plotEmberAccumulation", "[", 
   RowBox[{"emberGrid_", ",", 
    RowBox[{"title_", ":", "\"\<Ember Accumulation\>\""}]}], "]"}], ":=", 
  RowBox[{"ArrayPlot", "[", 
   RowBox[{"emberGrid", ",", 
    RowBox[{"ColorFunction", "->", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Blend", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"White", ",", "Yellow", ",", "Orange", ",", "Red"}], "}"}], 
         ",", "#"}], "]"}], "&"}], ")"}]}], ",", 
    RowBox[{"ColorFunctionScaling", "->", "True"}], ",", 
    RowBox[{"PlotRange", "->", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{"Max", "[", 
        RowBox[{"5", ",", 
         RowBox[{"Max", "[", 
          RowBox[{"Flatten", "[", "emberGrid", "]"}], "]"}]}], "]"}]}], 
      "}"}]}], ",", 
    RowBox[{"Mesh", "->", "False"}], ",", 
    RowBox[{"ImageSize", "->", "200"}], ",", 
    RowBox[{"PlotLabel", "->", "title"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, {3.9608823687401543`*^9, 3.9608823766538296`*^9}, {
   3.9608824979550247`*^9, 3.960882498579052*^9}, {3.960882550603531*^9, 
   3.9608825892607193`*^9}, {3.9608826200954094`*^9, 3.960882668139206*^9}, {
   3.9610800357627487`*^9, 3.9610800676855316`*^9}, 3.9610954506060543`*^9, {
   3.961146433585226*^9, 3.9611464342639084`*^9}, 3.96116137437595*^9, {
   3.961162030923668*^9, 3.9611620336377506`*^9}, {3.9641268953573513`*^9, 
   3.9641269294031086`*^9}},
 CellLabel->
  "In[139]:=",ExpressionUUID->"6fe474f9-8575-ff44-ad90-69e7bff27625"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plotFireWithEmbers", "[", 
   RowBox[{"fireGrid_", ",", "terrainGrid_", ",", "emberGrid_", ",", 
    RowBox[{"title_", ":", "\"\<Fire & Embers\>\""}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"fireDisplay", ",", "emberOverlay", ",", "combined"}], "}"}], ",", 
    RowBox[{"(*", 
     RowBox[{"Create", " ", "fire", " ", "display"}], "*)"}], 
    RowBox[{
     RowBox[{"fireDisplay", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{"1", "<=", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "<=", "10"}], ",", 
          RowBox[{"20", "+", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "11"}], ",", "35", ",",
           "True", ",", 
          RowBox[{"terrainGrid", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "fireGrid", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Overlay", " ", "ember", " ", "indicators", " ", "on", " ", "non"}], "-", 
       RowBox[{"burning", " ", "cells"}]}], "*)"}], 
     RowBox[{"combined", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"fireGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "0"}], "&&", 
           RowBox[{
            RowBox[{"emberGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], ">", "0.5"}]}], ",", 
          RowBox[{"(*", 
           RowBox[{
           "Show", " ", "ember", " ", "accumulation", " ", "on", " ", 
            "unburned", " ", "cells"}], "*)"}], 
          RowBox[{"15", "+", 
           RowBox[{"Min", "[", 
            RowBox[{"4", ",", 
             RowBox[{"Floor", "[", 
              RowBox[{"emberGrid", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Special", " ", "codes", " ", "15"}], "-", 
            RowBox[{"19", " ", "for", " ", "embers"}]}], "*)"}], 
          RowBox[{"fireDisplay", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "fireGrid", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Extended", " ", "color", " ", "rules", " ", "to", " ", "include", " ", 
       "ember", " ", "visualization"}], "*)"}], 
     RowBox[{"ArrayPlot", "[", 
      RowBox[{"combined", ",", 
       RowBox[{"ColorRules", "->", 
        RowBox[{"Join", "[", 
         RowBox[{"$firePlotColorRules", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"15", "->", "Yellow"}], ",", 
            RowBox[{"16", "->", 
             RowBox[{"Blend", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Yellow", ",", "Orange"}], "}"}], ",", "0.25"}], 
              "]"}]}], ",", 
            RowBox[{"17", "->", 
             RowBox[{"Blend", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Yellow", ",", "Orange"}], "}"}], ",", "0.5"}], 
              "]"}]}], ",", 
            RowBox[{"18", "->", 
             RowBox[{"Blend", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Yellow", ",", "Orange"}], "}"}], ",", "0.75"}], 
              "]"}]}], ",", 
            RowBox[{"19", "->", "Orange"}]}], "}"}]}], "]"}]}], ",", 
       RowBox[{"Mesh", "->", "False"}], ",", 
       RowBox[{"ImageSize", "->", "400"}], ",", 
       RowBox[{"PlotLabel", "->", "title"}]}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, {3.9608823687401543`*^9, 3.9608823766538296`*^9}, {
   3.9608824979550247`*^9, 3.960882498579052*^9}, {3.960882550603531*^9, 
   3.9608825892607193`*^9}, {3.9608826200954094`*^9, 3.960882668139206*^9}, {
   3.9610800357627487`*^9, 3.9610800676855316`*^9}, 3.9610954506060543`*^9, {
   3.961146433585226*^9, 3.9611464342639084`*^9}, 3.96116137437595*^9, {
   3.961162030923668*^9, 3.9611620336377506`*^9}, {3.9641268953573513`*^9, 
   3.9641269464831657`*^9}},
 CellLabel->
  "In[140]:=",ExpressionUUID->"27325b19-05f6-354c-8d92-805d2a3b5872"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"runFireSimulationWithEmbers", "[", 
    RowBox[{
     RowBox[{"gridSize_", ":", "80"}], ",", 
     RowBox[{"initialFires_", ":", "2"}], ",", 
     RowBox[{"timeSteps_", ":", "100"}], ",", 
     RowBox[{"ignitionProbability_", ":", "0.8"}], ",", 
     RowBox[{"windSpeed_", ":", "0.3"}], ",", 
     RowBox[{"windDirection_", ":", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}]}], ",", 
     RowBox[{"moisture_", ":", "0.2"}], ",", 
     RowBox[{"numRows_", ":", "1"}], ",", 
     RowBox[{"numCols_", ":", "1"}], ",", 
     RowBox[{"interRegionSpreadProb_", ":", "0.5"}], ",", 
     RowBox[{"uphillMultiplier_", ":", "1.5"}], ",", 
     RowBox[{"downhillMultiplier_", ":", "0.7"}], ",", 
     RowBox[{"location_", ":", "Automatic"}], ",", 
     RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "terrainGrids", ",", "elevationGrids", ",", "fireGrids", ",", 
       "emberGrids", ",", "unburnedPositions", ",", 
       RowBox[{"firePoints", "=", 
        RowBox[{"{", "}"}]}], ",", "terrainAndElev", ",", "actualLocation", ",",
        "result", ",", "gridPos", ",", "fireHistory", ",", "emberHistory", ",",
        "animationFrames", ",", "finalFire", ",", "stats", ",", "terrain", ",",
        "props"}], "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{"Initialize", " ", "location", " ", "and", " ", "terrain"}], 
      "*)"}], 
     RowBox[{
      RowBox[{"actualLocation", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"location", "===", "Automatic"}], ",", 
         RowBox[{"getRandomEarthLocation", "[", "]"}], ",", "location"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Create", " ", "terrain", " ", "and", " ", "elevation", " ", "grids"}],
        "*)"}], 
      RowBox[{"terrainGrids", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"elevationGrids", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"terrainAndElev", "=", 
          RowBox[{"initializeTerrainGrid", "[", 
           RowBox[{"gridSize", ",", "actualLocation", ",", "rangeKM"}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"terrainGrids", ",", 
           RowBox[{"terrainAndElev", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"elevationGrids", ",", 
           RowBox[{"terrainAndElev", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "numRows"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"terrainGrids", "=", 
       RowBox[{"ArrayReshape", "[", 
        RowBox[{"terrainGrids", ",", 
         RowBox[{"{", 
          RowBox[{
          "numRows", ",", "numCols", ",", "gridSize", ",", "gridSize"}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"elevationGrids", "=", 
       RowBox[{"ArrayReshape", "[", 
        RowBox[{"elevationGrids", ",", 
         RowBox[{"{", 
          RowBox[{
          "numRows", ",", "numCols", ",", "gridSize", ",", "gridSize"}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Initialize", " ", "fire", " ", "and", " ", "ember", " ", "grids"}], 
       "*)"}], 
      RowBox[{"fireGrids", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"gridSize", ",", "gridSize"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "numRows"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"emberGrids", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"initializeEmberGrid", "[", "gridSize", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "numRows"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Get", " ", "fire", " ", "starting", " ", "points", " ", "via", " ", 
        "dialog"}], "*)"}], 
      RowBox[{"unburnedPositions", "=", 
       RowBox[{"getUnburnedPositions", "[", 
        RowBox[{"fireGrids", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"unburnedPositions", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"unburnedPositions", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"terrainGrids", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1", ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "!=", "6"}], 
          "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"result", "=", 
       RowBox[{"DialogInput", "[", 
        RowBox[{"DynamicModule", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"currentPoint", "=", 
             RowBox[{"{", 
              RowBox[{"15", ",", "15"}], "}"}]}], ",", 
            RowBox[{"selectedPoints", "=", 
             RowBox[{"{", "}"}]}]}], "}"}], ",", 
          RowBox[{"Column", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "Text", "[", "\"\<Click on the terrain to place fire starting \
points\>\"", "]"}], ",", 
             RowBox[{"Text", "[", 
              RowBox[{"Dynamic", "[", 
               RowBox[{"\"\<Points selected: \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"Length", "[", "selectedPoints", "]"}], "]"}], 
                "<>", "\"\</\>\"", "<>", 
                RowBox[{"ToString", "[", "initialFires", "]"}]}], "]"}], 
              "]"}], ",", 
             RowBox[{"LocatorPane", "[", 
              RowBox[{
               RowBox[{"Dynamic", "[", "currentPoint", "]"}], ",", 
               RowBox[{"plotAllFireRegions", "[", 
                RowBox[{
                "terrainGrids", ",", "fireGrids", ",", "numRows", ",", 
                 "numCols"}], "]"}], ",", 
               RowBox[{"Appearance", "->", 
                RowBox[{"Graphics", "[", 
                 RowBox[{"{", 
                  RowBox[{"Red", ",", 
                   RowBox[{"PointSize", "[", "0.05", "]"}], ",", 
                   RowBox[{"Point", "[", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], "]"}]}], "}"}], "]"}]}]}],
               "]"}], ",", 
             RowBox[{"Row", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Button", "[", 
                 RowBox[{"\"\<Add Fire Point\>\"", ",", 
                  RowBox[{
                   RowBox[{"gridPos", "=", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Clip", "[", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{"gridSize", "-", 
                    RowBox[{"currentPoint", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "gridSize"}], "}"}]}], "]"}], ",", 
                    RowBox[{"Clip", "[", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{"currentPoint", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "gridSize"}], "}"}]}], "]"}]}], "}"}]}],
                    ";", "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"terrainGrids", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1", ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "!=", 
                    "6"}], "&&", 
                    RowBox[{
                    RowBox[{"terrainGrids", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1", ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "!=", 
                    "3"}]}], ",", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"selectedPoints", ",", "gridPos"}], "]"}], ",", 
                    RowBox[{
                    "MessageDialog", 
                    "[", "\"\<Cannot place fire on water!\>\"", "]"}]}], 
                    "]"}]}], ",", 
                  RowBox[{"Enabled", "->", 
                   RowBox[{"Dynamic", "[", 
                    RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], "<", 
                    "initialFires"}], "]"}]}]}], "]"}], ",", 
                RowBox[{"Button", "[", 
                 RowBox[{"\"\<Reset\>\"", ",", 
                  RowBox[{"selectedPoints", "=", 
                   RowBox[{"{", "}"}]}]}], "]"}], ",", 
                RowBox[{"Button", "[", 
                 RowBox[{"\"\<Run Simulation\>\"", ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], ">", 
                    "0"}], ",", 
                    RowBox[{"DialogReturn", "[", "selectedPoints", "]"}], ",", 
                    RowBox[{
                    "MessageDialog", 
                    "[", "\"\<Please select at least one fire point!\>\"", 
                    "]"}]}], "]"}], ",", 
                  RowBox[{"Enabled", "->", 
                   RowBox[{"Dynamic", "[", 
                    RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], ">", 
                    "0"}], "]"}]}]}], "]"}], ",", 
                RowBox[{"Button", "[", 
                 RowBox[{"\"\<Cancel\>\"", ",", 
                  RowBox[{"DialogReturn", "[", "$Canceled", "]"}]}], "]"}]}], 
               "}"}], "]"}]}], "}"}], "]"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"result", "===", "$Canceled"}], ",", 
        RowBox[{
         RowBox[{"Echo", "[", "\"\<Simulation canceled by user.\>\"", "]"}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "$Canceled", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "result", "]"}], "==", "0"}], ",", 
        RowBox[{
         RowBox[{"Echo", "[", "\"\<No fire points selected.\>\"", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"firePoints", "=", "result"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Echo", "[", 
       RowBox[{"{", 
        RowBox[{"\"\<Starting simulation with \>\"", ",", 
         RowBox[{"Length", "[", "firePoints", "]"}], 
         ",", "\"\< fire points at: \>\"", ",", "firePoints"}], "}"}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Set", " ", "initial", " ", "fires"}], "*)"}], 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"terrain", "=", 
          RowBox[{"terrainGrids", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", 
             RowBox[{"pos", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"pos", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"props", "=", 
          RowBox[{"getPatchProperties", "[", "terrain", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"fireGrids", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", 
             RowBox[{"pos", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"pos", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "=", 
          RowBox[{"props", "[", "\"\<burnTime\>\"", "]"}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"pos", ",", "firePoints"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Run", " ", "simulation", " ", "with", " ", "ember", " ", "tracking"}],
        "*)"}], 
      RowBox[{"fireHistory", "=", 
       RowBox[{"{", "fireGrids", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"emberHistory", "=", 
       RowBox[{"{", "emberGrids", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", "updated", "}"}], ",", 
          RowBox[{
           RowBox[{"updated", "=", 
            RowBox[{"updateAllFireRegionsWithEmbers", "[", 
             RowBox[{"terrainGrids", ",", 
              RowBox[{"Last", "[", "fireHistory", "]"}], ",", 
              "elevationGrids", ",", 
              RowBox[{"Last", "[", "emberHistory", "]"}], ",", "gridSize", ",",
               "numRows", ",", "numCols", ",", "ignitionProbability", ",", 
              "windSpeed", ",", "windDirection", ",", "moisture", ",", 
              "interRegionSpreadProb", ",", "uphillMultiplier", ",", 
              "downhillMultiplier"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"fireHistory", ",", 
             RowBox[{"updated", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"emberHistory", ",", 
             RowBox[{"updated", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";"}]}], "]"}], ",", 
        RowBox[{"{", "timeSteps", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Create", " ", "animation", " ", "frames"}], "*)"}], 
      RowBox[{"animationFrames", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Grid", "[", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"plotFireWithEmbers", "[", 
              RowBox[{
               RowBox[{"fireHistory", "[", 
                RowBox[{"[", 
                 RowBox[{"t", ",", "1", ",", "1"}], "]"}], "]"}], ",", 
               RowBox[{"terrainGrids", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
               RowBox[{"emberHistory", "[", 
                RowBox[{"[", 
                 RowBox[{"t", ",", "1", ",", "1"}], "]"}], "]"}], ",", 
               RowBox[{"\"\<Time: \>\"", "<>", 
                RowBox[{"ToString", "[", "t", "]"}]}]}], "]"}], ",", 
             RowBox[{"plotEmberAccumulation", "[", 
              RowBox[{
               RowBox[{"emberHistory", "[", 
                RowBox[{"[", 
                 RowBox[{"t", ",", "1", ",", "1"}], "]"}], "]"}], ",", 
               RowBox[{"\"\<Embers at t=\>\"", "<>", 
                RowBox[{"ToString", "[", "t", "]"}]}]}], "]"}]}], "}"}], 
           "}"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", 
           RowBox[{"Length", "[", "fireHistory", "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Calculate", " ", "statistics"}], "*)"}], 
      RowBox[{"finalFire", "=", 
       RowBox[{"Last", "[", "fireHistory", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"stats", "=", 
       RowBox[{"<|", 
        RowBox[{
         RowBox[{"\"\<TotalBurned\>\"", "->", 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{"countBurned", "[", 
             RowBox[{"finalFire", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "numRows"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ",", 
         RowBox[{"\"\<TotalBurning\>\"", "->", 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{"countBurning", "[", 
             RowBox[{"finalFire", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "numRows"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ",", 
         RowBox[{"\"\<TotalUnburned\>\"", "->", 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{"countUnburned", "[", 
             RowBox[{"finalFire", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "numRows"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ",", 
         RowBox[{"\"\<MaxEmberAccumulation\>\"", "->", 
          RowBox[{"Max", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Last", "[", "emberHistory", "]"}], "]"}], "]"}]}], ",", 
         RowBox[{"\"\<SpotFireLocations\>\"", "->", 
          RowBox[{"{", "}"}]}]}], " ", 
        RowBox[{"(*", 
         RowBox[{"Could", " ", "track", " ", "these", " ", "separately"}], 
         "*)"}], "|>"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Return", " ", "results"}], "*)"}], 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"\"\<FireHistory\>\"", "->", "fireHistory"}], ",", 
        RowBox[{"\"\<EmberHistory\>\"", "->", "emberHistory"}], ",", 
        RowBox[{"\"\<Animation\>\"", "->", 
         RowBox[{"ListAnimate", "[", 
          RowBox[{"animationFrames", ",", 
           RowBox[{"AnimationRunning", "->", "True"}], ",", 
           RowBox[{"AnimationRate", "->", "2"}]}], "]"}]}], ",", 
        RowBox[{"\"\<TerrainGrids\>\"", "->", "terrainGrids"}], ",", 
        RowBox[{"\"\<ElevationGrids\>\"", "->", "elevationGrids"}], ",", 
        RowBox[{"\"\<Statistics\>\"", "->", "stats"}], ",", 
        RowBox[{"\"\<FinalFire\>\"", "->", "finalFire"}], ",", 
        RowBox[{"\"\<Parameters\>\"", "->", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<gridSize\>\"", "->", "gridSize"}], ",", 
           RowBox[{"\"\<initialFires\>\"", "->", "initialFires"}], ",", 
           RowBox[{"\"\<timeSteps\>\"", "->", "timeSteps"}], ",", 
           
           RowBox[{"\"\<ignitionProbability\>\"", "->", 
            "ignitionProbability"}], ",", 
           RowBox[{"\"\<windSpeed\>\"", "->", "windSpeed"}], ",", 
           RowBox[{"\"\<windDirection\>\"", "->", "windDirection"}], ",", 
           RowBox[{"\"\<moisture\>\"", "->", "moisture"}], ",", 
           RowBox[{"\"\<numRows\>\"", "->", "numRows"}], ",", 
           RowBox[{"\"\<numCols\>\"", "->", "numCols"}], ",", 
           
           RowBox[{"\"\<interRegionSpreadProb\>\"", "->", 
            "interRegionSpreadProb"}], ",", 
           RowBox[{"\"\<uphillMultiplier\>\"", "->", "uphillMultiplier"}], ",", 
           
           RowBox[{"\"\<downhillMultiplier\>\"", "->", 
            "downhillMultiplier"}]}], "|>"}]}]}], "|>"}]}]}], "]"}]}], 
  "\n"}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, {3.9608823687401543`*^9, 3.9608823766538296`*^9}, {
   3.9608824979550247`*^9, 3.960882498579052*^9}, {3.960882550603531*^9, 
   3.9608825892607193`*^9}, {3.9608826200954094`*^9, 3.960882668139206*^9}, {
   3.9610800357627487`*^9, 3.9610800676855316`*^9}, 3.9610954506060543`*^9, {
   3.961146433585226*^9, 3.9611464342639084`*^9}, 3.96116137437595*^9, {
   3.961162030923668*^9, 3.9611620336377506`*^9}, {3.9641268953573513`*^9, 
   3.9641269476043816`*^9}},
 CellLabel->
  "In[141]:=",ExpressionUUID->"00849b26-e4fd-de48-afbd-c956f56704ab"],

Cell[BoxData[
 TemplateBox[{
  "Pattern", "patm", 
   "\"Too many (\\!\\(\\*RowBox[{\\\"14\\\"}]\\)) optional arguments required \
in \\!\\(\\*RowBox[{\\\"runFireSimulationWithEmbers\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \
\\\"[\\\", RowBox[{\\\"1\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"80\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"2\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"2\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"3\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"100\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"4\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"0.8`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"5\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"0.3`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"6\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{\\\"1\\\", \\\
\",\\\", \\\"0\\\"}], \\\"}\\\"}]}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"7\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"0.2`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"8\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"1\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"9\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"1\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"10\\\", \\\",\\\", \\\
\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"0.5`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"11\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"1.5`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"12\\\", \\\",\\\", \\\
\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"0.7`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"13\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"Automatic\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \
\\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"14\\\", \\\
\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"1.`\\\"}], \\\"]\\\"}]}], \
\\\"]\\\"}]\\).\"", 2, 141, 12, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{{3.964126948932255*^9, 3.9641269714367046`*^9}, 
   3.9641272033077335`*^9},
 CellLabel->
  "During evaluation of \
In[141]:=",ExpressionUUID->"ed10b3eb-ed2c-2b46-a421-139f8ff82e51"],

Cell[BoxData[
 TemplateBox[{
  "Pattern", "patm", 
   "\"Too many (\\!\\(\\*RowBox[{\\\"14\\\"}]\\)) optional arguments required \
in \\!\\(\\*RowBox[{\\\"runFireSimulationWithEmbers\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \
\\\"[\\\", RowBox[{\\\"1\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"80\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"2\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"2\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"3\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"100\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"4\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"0.8`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"5\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"0.3`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"6\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{\\\"1\\\", \\\
\",\\\", \\\"0\\\"}], \\\"}\\\"}]}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"7\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"0.2`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"8\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"1\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"9\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"1\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"10\\\", \\\",\\\", \\\
\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"0.5`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"11\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"1.5`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"12\\\", \\\",\\\", \\\
\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"0.7`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"13\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"Automatic\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \
\\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"14\\\", \\\
\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"1.`\\\"}], \\\"]\\\"}]}], \
\\\"]\\\"}]\\).\"", 2, 141, 13, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{{3.964126948932255*^9, 3.9641269714367046`*^9}, 
   3.964127203318783*^9},
 CellLabel->
  "During evaluation of \
In[141]:=",ExpressionUUID->"18445eba-bb37-5d42-a58c-360984024879"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"showBurnFireGrids", "[", 
   RowBox[{
   "firePoints_", ",", "terrainGrids_", ",", "elevationGrids_", ",", "fg_", ",",
     "numRows_", ",", "numCols_", ",", "gridSize_", ",", 
    "ignitionProbability_", ",", "windSpeed_", ",", "windDirection_", ",", 
    "moisture_", ",", "interRegionSpreadProb_", ",", "timeSteps_", ",", 
    "initialFires_", ",", "uphillMultiplier_", ",", "downhillMultiplier_", ",",
     "location_", ",", "rangeKM_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"fireGrids", "=", "fg"}], ",", "fireHistory", ",", 
      "animationFrames", ",", "finalFire", ",", "totalBurned", ",", 
      "totalBurning", ",", "totalUnburned", ",", "data", ",", 
      "threeDTerrainPlot", ",", "terrain", ",", "props"}], "}"}], ",", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"terrain", "=", 
         RowBox[{"terrainGrids", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1", ",", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"props", "=", 
         RowBox[{"getPatchProperties", "[", "terrain", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fireGrids", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1", ",", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "=", 
         RowBox[{"props", "[", "\"\<burnTime\>\"", "]"}]}], ";"}], ",", 
       RowBox[{"{", 
        RowBox[{"pos", ",", "firePoints"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[LineSeparator]", 
     RowBox[{"Echo", "[", 
      RowBox[{"plotAllFireRegions", "[", 
       RowBox[{
       "terrainGrids", ",", "fireGrids", ",", "numRows", ",", "numCols"}], 
       "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"numRows", "==", "1"}], "&&", 
        RowBox[{"numCols", "==", "1"}]}], ",", "\[IndentingNewLine]", 
       "\[LineSeparator]", 
       RowBox[{
        RowBox[{"Echo", "[", 
         RowBox[{"generate3DTerrain", "[", 
          RowBox[{"gridSize", ",", "location", ",", "rangeKM"}], "]"}], "]"}],
         ";"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"threeDTerrainPlot", "=", 
      RowBox[{"satelliteImagery", "[", 
       RowBox[{"gridSize", ",", "location", ",", "rangeKM"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fireHistory", "=", 
      RowBox[{"NestList", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"updateAllFireRegions", "[", 
          RowBox[{
          "terrainGrids", ",", "#", ",", "elevationGrids", ",", "gridSize", ",",
            "numRows", ",", "numCols", ",", "ignitionProbability", ",", 
           "windSpeed", ",", "windDirection", ",", "moisture", ",", 
           "interRegionSpreadProb", ",", "uphillMultiplier", ",", 
           "downhillMultiplier"}], "]"}], "&"}], ",", "fireGrids", ",", 
        "timeSteps"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"animationFrames", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"plotAllFireRegions", "[", 
         RowBox[{"terrainGrids", ",", 
          RowBox[{"fireHistory", "[", 
           RowBox[{"[", "t", "]"}], "]"}], ",", "numRows", ",", "numCols"}], 
         "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"Length", "[", "fireHistory", "]"}]}], "}"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"finalFire", "=", 
      RowBox[{"Last", "[", "fireHistory", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"totalBurned", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"countBurned", "[", 
         RowBox[{"finalFire", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "numRows"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"totalBurning", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"countBurning", "[", 
         RowBox[{"finalFire", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "numRows"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"totalUnburned", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"countUnburned", "[", 
         RowBox[{"finalFire", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "numRows"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{"countBurned", "[", 
             RowBox[{"fireHistory", "[", 
              RowBox[{"[", 
               RowBox[{"t", ",", "i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "numRows"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"Length", "[", "fireHistory", "]"}]}], "}"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<FireHistory\>\"", "->", "fireHistory"}], ",", 
       RowBox[{"\"\<Animation\>\"", "->", 
        RowBox[{"ListAnimate", "[", 
         RowBox[{"animationFrames", ",", 
          RowBox[{"AnimationRunning", "->", "True"}], ",", 
          RowBox[{"AnimationRate", "->", "2"}]}], "]"}]}], ",", 
       RowBox[{"\"\<TerrainGrids\>\"", "->", "terrainGrids"}], ",", 
       RowBox[{"\"\<ElevationGrids\>\"", "->", "elevationGrids"}], ",", 
       RowBox[{"\"\<Data\>\"", "->", "data"}], ",", 
       RowBox[{"\"\<FinalFire\>\"", "->", "finalFire"}], ",", 
       RowBox[{"\"\<3DPlot\>\"", "->", "threeDTerrainPlot"}], ",", 
       RowBox[{"\"\<Parameters\>\"", "->", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<gridSize\>\"", "->", "gridSize"}], ",", 
          RowBox[{"\"\<initialFires\>\"", "->", "initialFires"}], ",", 
          RowBox[{"\"\<timeSteps\>\"", "->", "timeSteps"}], ",", 
          
          RowBox[{"\"\<ignitionProbability\>\"", "->", 
           "ignitionProbability"}], ",", 
          RowBox[{"\"\<windSpeed\>\"", "->", "windSpeed"}], ",", 
          RowBox[{"\"\<windDirection\>\"", "->", "windDirection"}], ",", 
          RowBox[{"\"\<moisture\>\"", "->", "moisture"}], ",", 
          RowBox[{"\"\<numRows\>\"", "->", "numRows"}], ",", 
          RowBox[{"\"\<numCols\>\"", "->", "numCols"}], ",", 
          
          RowBox[{"\"\<interRegionSpreadProb\>\"", "->", 
           "interRegionSpreadProb"}], ",", 
          RowBox[{"\"\<uphillMultiplier\>\"", "->", "uphillMultiplier"}], ",", 
          
          RowBox[{"\"\<downhillMultiplier\>\"", "->", 
           "downhillMultiplier"}]}], "|>"}]}]}], "|>"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, {3.9608823687401543`*^9, 3.9608823766538296`*^9}, 
   3.9608824979550247`*^9, 3.9608888114359894`*^9, 3.961020702117777*^9, 
   3.9610535311369324`*^9, {3.961053616485199*^9, 3.9610536364047318`*^9}, {
   3.9610555715167694`*^9, 3.9610555720350246`*^9}, {3.961056812179535*^9, 
   3.961056817315378*^9}, 3.961058246972004*^9, {3.9610583493670406`*^9, 
   3.9610583531898174`*^9}, 3.9610782648551693`*^9, {3.9610799419548626`*^9, 
   3.9610799497203236`*^9}, 3.961079993103178*^9, {3.961095456704197*^9, 
   3.9610954691931095`*^9}, {3.961113296377268*^9, 3.961113332494068*^9}, 
   3.961150635190424*^9, {3.9611569494854393`*^9, 3.9611569649222755`*^9}, {
   3.9611570021762123`*^9, 3.9611570412806396`*^9}, {3.961157822473591*^9, 
   3.9611578264218025`*^9}, 3.9611603288708153`*^9, 3.9611604970756893`*^9, 
   3.961161383489002*^9, {3.9611620381136837`*^9, 3.961162056056553*^9}, {
   3.961163691530527*^9, 3.96116370751676*^9}, {3.9611651729529667`*^9, 
   3.961165180546465*^9}, {3.9611708903473186`*^9, 3.9611708948916054`*^9}, {
   3.962365924054616*^9, 3.962365929123822*^9}, {3.962368139511631*^9, 
   3.96236816525861*^9}},
 CellLabel->
  "In[142]:=",ExpressionUUID->"82b378e4-c56b-3240-8d52-fab3409fe3ef"],

Cell[BoxData[
 RowBox[{
  RowBox[{"timeSeriesPlot", "[", "]"}], " ", ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"frames", ",", " ", "history", ",", " ", "listOfBurnt"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"frames", " ", "=", " ", 
      RowBox[{"runFireSimulation", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"history", " ", "=", " ", 
      RowBox[{"frames", "[", "\"\<FireHistory\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"listOfBurnt", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"countBurned", "[", 
         RowBox[{"history", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "history", "]"}]}], " ", "}"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"Labeled", "[", 
      RowBox[{
       RowBox[{"BarChart", "[", 
        RowBox[{"listOfBurnt", ",", 
         RowBox[{"ColorFunction", "->", "\"\<SolarColors\>\""}], ",", 
         RowBox[{"ChartStyle", "->", "\"\<SolarColors\>\""}], ",", " ", 
         RowBox[{
         "PlotLabel", 
          "->", "\"\<Plotting Terrain Burnt Against Time Steps\>\""}]}], 
        "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Time Steps\>\"", ",", "\"\<Area Burnt\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Bottom", ",", "Left"}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, {3.9608823687401543`*^9, 3.9608823766538296`*^9}, 
   3.9608824979550247`*^9, 3.9608888114359894`*^9, 3.961020702117777*^9, 
   3.9610535311369324`*^9, {3.961053616485199*^9, 3.9610536364047318`*^9}, {
   3.9610555715167694`*^9, 3.9610555720350246`*^9}, {3.961056812179535*^9, 
   3.961056817315378*^9}, 3.961058246972004*^9, {3.9610583493670406`*^9, 
   3.9610583531898174`*^9}, 3.9610782648551693`*^9, {3.9610799419548626`*^9, 
   3.9610799497203236`*^9}, 3.961079993103178*^9, {3.961095456704197*^9, 
   3.9610954691931095`*^9}, {3.961113296377268*^9, 3.961113332494068*^9}, {
   3.961150635190424*^9, 3.961150651097946*^9}},
 CellLabel->
  "In[143]:=",ExpressionUUID->"4f35160a-8b1b-9842-b5b6-2a7819b9855b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"create3DTerrainArray", "[", 
   RowBox[{"elevationGrid_", ",", "terrainGrid_", ",", "gridSize_", ",", 
    RowBox[{"maxHeight_", ":", "50"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "array3D", ",", "scaledElevation", ",", "minElev", ",", "maxElev", ",", 
      " ", "height"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"minElev", "=", 
      RowBox[{"Min", "[", "elevationGrid", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"maxElev", "=", 
      RowBox[{"Max", "[", "elevationGrid", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"scaledElevation", "=", 
      RowBox[{"Rescale", "[", 
       RowBox[{"elevationGrid", ",", 
        RowBox[{"{", 
         RowBox[{"minElev", ",", "maxElev"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "maxHeight"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"array3D", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"maxHeight", ",", "gridSize", ",", "gridSize"}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"height", "=", 
         RowBox[{"Round", "[", 
          RowBox[{"scaledElevation", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"array3D", "[", 
            RowBox[{"[", 
             RowBox[{"h", ",", "i", ",", "j"}], "]"}], "]"}], "=", 
           RowBox[{"terrainGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"h", ",", "1", ",", "height"}], "}"}]}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "gridSize"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "gridSize"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "array3D"}]}], "]"}]}]], "Input",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{
  3.961019249469328*^9, 3.961019657527384*^9, 3.961019751519121*^9, {
   3.9610198236839256`*^9, 3.9610198566263523`*^9}, {3.9610198911239033`*^9, 
   3.961019922405594*^9}, 3.9610200476585865`*^9, {3.9610201487366695`*^9, 
   3.9610201624734936`*^9}, {3.9610202219768734`*^9, 3.9610203932842655`*^9}, 
   3.961020585568228*^9, {3.961020736032217*^9, 3.961020911755659*^9}, 
   3.961021175728647*^9, {3.9610568848952446`*^9, 3.961056891669256*^9}, {
   3.9610570345234985`*^9, 3.9610570414194393`*^9}, {3.9610572441077156`*^9, 
   3.961057264749264*^9}, {3.9610573409875813`*^9, 3.9610573416814632`*^9}, {
   3.9610573786627636`*^9, 3.9610575121603928`*^9}, {3.9610576005219173`*^9, 
   3.961057602644438*^9}, 3.9610639557984505`*^9, 3.961147618455822*^9, 
   3.961147945441929*^9},
 CellLabel->
  "In[144]:=",ExpressionUUID->"94af12e1-668e-b94a-b7dd-e83100516dfc"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mapFireTo3D", "[", 
    RowBox[{
    "array3D_", ",", "fireGrid_", ",", "terrainGrid_", ",", "elevGrid_", ",", 
     RowBox[{"maxH_", ":", "50"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"out", "=", "array3D"}], ",", 
       RowBox[{"minElev", "=", 
        RowBox[{"Min", "[", "elevGrid", "]"}]}], ",", 
       RowBox[{"maxElev", "=", 
        RowBox[{"Max", "[", "elevGrid", "]"}]}], ",", "scaledElevation", ",", 
       "h", ",", "f"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"scaledElevation", "=", 
       RowBox[{"Rescale", "[", 
        RowBox[{"elevGrid", ",", 
         RowBox[{"{", 
          RowBox[{"minElev", ",", "maxElev"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "maxH"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"h", "=", 
          RowBox[{"Round", "[", 
           RowBox[{"scaledElevation", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}]}], ";", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"true", " ", "top"}], "-", "of", "-", 
           RowBox[{"column", " ", "voxel"}]}], "*)"}], 
         RowBox[{"f", "=", 
          RowBox[{"fireGrid", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
         RowBox[{"(*", 
          RowBox[{"0", ",", 
           RowBox[{"1", "\[Ellipsis]10", " ", "or", " ", "11"}]}], "*)"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"f", ">", "0"}], ",", 
           RowBox[{"Which", "[", 
            RowBox[{
             RowBox[{"1", "<=", "f", "<=", "10"}], ",", 
             RowBox[{
              RowBox[{"out", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"1", ";;", "h"}], ",", "i", ",", "j"}], "]"}], "]"}],
               "=", 
              RowBox[{"20", "+", "f"}]}], ",", 
             RowBox[{"(*", 
              RowBox[{"21", "-", 
               RowBox[{"30", " ", "burning"}]}], "*)"}], 
             RowBox[{"f", "==", "11"}], ",", 
             RowBox[{
              RowBox[{"out", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"1", ";;", "h"}], ",", "i", ",", "j"}], "]"}], "]"}],
               "=", "35"}]}], "        ", 
            RowBox[{"(*", 
             RowBox[{"35", " ", "charred"}], "*)"}], "]"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "fireGrid", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "out"}]}], "]"}]}], "\n"}]], "Input",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{
  3.961019249469328*^9, 3.961019657527384*^9, 3.961019751519121*^9, {
   3.9610198236839256`*^9, 3.9610198566263523`*^9}, {3.9610198911239033`*^9, 
   3.961019922405594*^9}, 3.9610200476585865`*^9, {3.9610201487366695`*^9, 
   3.9610201624734936`*^9}, {3.9610202219768734`*^9, 3.9610203932842655`*^9}, 
   3.961020585568228*^9, {3.961020736032217*^9, 3.961020911755659*^9}, 
   3.961021175728647*^9, {3.9610568848952446`*^9, 3.961056891669256*^9}, {
   3.9610570345234985`*^9, 3.9610570414194393`*^9}, {3.9610572441077156`*^9, 
   3.961057279369314*^9}, {3.9610576171366005`*^9, 3.9610577743823586`*^9}, 
   3.961064676722908*^9, 3.961148117316736*^9, {3.962346074332304*^9, 
   3.9623460771720953`*^9}, {3.963251245269903*^9, 3.963251250725692*^9}, {
   3.9633288619909477`*^9, 3.963328872598428*^9}, {3.9633292197938757`*^9, 
   3.9633292565393257`*^9}, {3.9633295482122803`*^9, 3.963329551168151*^9}, {
   3.963329635618353*^9, 3.96332974706528*^9}, 3.963329968726355*^9, 
   3.9633301332960167`*^9},
 CellLabel->
  "In[145]:=",ExpressionUUID->"20b72586-cbf3-c144-ab2a-8053ef8513e1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"visualize3DFire", "[", 
   RowBox[{"array3D_", ",", 
    RowBox[{"timeLabel_", ":", "\"\<\>\""}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "voxelData", ",", "colorFun", ",", "xMax", ",", "yMax", ",", "zMax"}], 
     "}"}], ",", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"terrain", " ", 
       RowBox[{"colours", ":", 
        RowBox[{"codes", " ", "1"}]}]}], "\[Dash]", 
      RowBox[{
      "14", " ", "already", " ", "live", " ", "in", " ", "$terrainLookup"}]}],
      "*)"}], 
    RowBox[{
     RowBox[{
      RowBox[{"colorFun", "[", "val_", "]"}], ":=", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"val", "==", "0"}], ",", "Nothing", ",", 
        RowBox[{"(*", 
         RowBox[{"empty", " ", "voxel"}], "*)"}], 
        RowBox[{"1", "<=", "val", "<=", "14"}], ",", 
        RowBox[{"$terrainLookup", "[", "val", "]"}], ",", 
        RowBox[{"(*", 
         RowBox[{"all", " ", "terrains"}], "*)"}], 
        RowBox[{"21", "<=", "val", "<=", "30"}], ",", 
        RowBox[{"Blend", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Orange", ",", "Red"}], "}"}], ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"val", "-", "21"}], ")"}], "/", "9"}]}], "]"}], ",", 
        RowBox[{"(*", "burning", "*)"}], 
        RowBox[{"val", "==", "35"}], ",", "Black", ",", 
        RowBox[{"(*", "charred", "*)"}], "True", ",", "Gray"}], 
       "                       ", 
       RowBox[{"(*", "fallback", "*)"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"zMax", ",", "yMax", ",", "xMax"}], "}"}], "=", 
      RowBox[{"Dimensions", "[", "array3D", "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{"note", " ", 
       RowBox[{"order", "!"}]}], "*)"}], 
     RowBox[{"voxelData", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"code", "=", 
            RowBox[{"array3D", "[", 
             RowBox[{"[", 
              RowBox[{"z", ",", "y", ",", "x"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"code", "=!=", "0"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"colorFun", "[", "code", "]"}], ",", 
              RowBox[{"Cuboid", "[", 
               RowBox[{"{", 
                RowBox[{"x", ",", "y", ",", "z"}], "}"}], "]"}]}], "}"}], ",",
             "Nothing"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"z", ",", "zMax"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "yMax"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "xMax"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Graphics3D", "[", 
      RowBox[{
       RowBox[{"Flatten", "[", "voxelData", "]"}], ",", 
       RowBox[{"Axes", "->", "True"}], ",", 
       RowBox[{"AxesLabel", "->", 
        RowBox[{"{", 
         RowBox[{"\"\<X\>\"", ",", "\"\<Y\>\"", ",", "\"\<Elevation\>\""}], 
         "}"}]}], ",", 
       RowBox[{"PlotLabel", "->", 
        RowBox[{"\"\<Fire Spread \>\"", "<>", "timeLabel"}]}], ",", 
       RowBox[{"ViewPoint", "->", 
        RowBox[{"{", 
         RowBox[{"2", ",", 
          RowBox[{"-", "2"}], ",", "1.5"}], "}"}]}], ",", 
       RowBox[{"Lighting", "->", "\"\<Neutral\>\""}], ",", 
       RowBox[{"ImageSize", "->", "Large"}]}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.963328312765808*^9, 3.9633283142734213`*^9}},
 CellLabel->
  "In[146]:=",ExpressionUUID->"138397f7-fbf8-ce4b-bac7-04126219fe5b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"visualize3DFireSurface", "[", 
   RowBox[{"elevGrid_", ",", "fireGrid_", ",", "terrainGrid_", ",", 
    RowBox[{"timeLabel_", ":", "\"\<\>\""}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"display", ",", "colorFun"}], "}"}], ",", 
    RowBox[{"(*", 
     RowBox[{
     "1", " ", "\[FilledRightTriangle]", " ", "build", " ", "the", " ", 
      "display", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"grid", "--"}], "--"}], "--"}], "--"}], "--"}], 
                    "--"}], "--"}], "--"}], "--"}], "--"}], "--"}], "--"}], 
             "--"}], "--"}], "--"}], "--"}], "--"}], "--"}], "--"}]}], "*)"}], 
    RowBox[{
     RowBox[{"display", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{"1", "<=", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "<=", "10"}], ",", 
          RowBox[{"20", "+", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
          RowBox[{"(*", 
           RowBox[{"20", "-", "30"}], "*)"}], 
          RowBox[{
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "11"}], ",", "35", ",", 
          RowBox[{"(*", "charred", "*)"}], "True", ",", 
          RowBox[{"terrainGrid", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "fireGrid", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "2", " ", "\[FilledRightTriangle]", " ", "single", " ", "colour", " ", 
       "function", " ", "used", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"everywhere", "--"}], "--"}], "--"}], "--"}], "--"}],
              "--"}], "--"}], "--"}], "--"}], "--"}], "--"}]}], "*)"}], 
     RowBox[{
      RowBox[{"colorFun", "[", "val_", "]"}], ":=", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"val", "==", "0"}], ",", "Nothing", ",", 
        RowBox[{"1", "<=", "val", "<=", "14"}], ",", 
        RowBox[{"$terrainLookup", "[", "val", "]"}], ",", 
        RowBox[{"20", "<=", "val", "<=", "30"}], ",", 
        RowBox[{"Blend", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Orange", ",", "Red"}], "}"}], ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"val", "-", "20"}], ")"}], "/", "10"}]}], "]"}], ",", 
        RowBox[{"val", "==", "35"}], ",", "Black", ",", "True", ",", "Gray"}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ListPlot3D", "[", 
      RowBox[{"elevGrid", ",", 
       RowBox[{"ColorFunction", "->", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"colorFun", "@", 
           RowBox[{"display", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"Round", "[", "#2", "]"}], ",", 
              RowBox[{"Round", "[", "#1", "]"}]}], "]"}], "]"}]}], "&"}], 
         ")"}]}], ",", 
       RowBox[{"ColorFunctionScaling", "->", "False"}], ",", 
       RowBox[{"Mesh", "->", "None"}], ",", 
       RowBox[{"PlotLabel", "->", 
        RowBox[{"\"\<Fire Spread on Terrain \>\"", "<>", "timeLabel"}]}], ",", 
       RowBox[{"AxesLabel", "->", 
        RowBox[{"{", 
         RowBox[{"\"\<X\>\"", ",", "\"\<Y\>\"", ",", "\"\<Elevation\>\""}], 
         "}"}]}], ",", 
       RowBox[{"ViewPoint", "->", 
        RowBox[{"{", 
         RowBox[{"2", ",", 
          RowBox[{"-", "2"}], ",", "1.5"}], "}"}]}], ",", 
       RowBox[{"PlotRange", "->", "All"}], ",", 
       RowBox[{"ImageSize", "->", "Large"}]}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.963313362117654*^9, 3.963313363737154*^9}},
 CellLabel->
  "In[147]:=",ExpressionUUID->"c1874823-8383-ed4b-acb7-52f574b48420"],

Cell[BoxData[
 RowBox[{
  RowBox[{"satelliteImagery", "[", 
   RowBox[{"gridSize_", ",", "location_", ",", 
    RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "satelliteImage", ",", " ", "range", ",", " ", "riverImage", ",", " ", 
      "fullSatelliteImage"}], "}"}], ",", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"range", "=", 
      RowBox[{"Quantity", "[", 
       RowBox[{"rangeKM", ",", " ", "\"\<Kilometers\>\""}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"satelliteImage", " ", "=", " ", 
      RowBox[{"GeoImage", "[", 
       RowBox[{
        RowBox[{"GeoPosition", "[", "location", "]"}], ",", " ", 
        RowBox[{"GeoRange", "->", "range"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"riverImage", " ", "=", " ", "\[IndentingNewLine]", 
      RowBox[{"Rasterize", "[", 
       RowBox[{"ImageRecolor", "[", 
        RowBox[{
         RowBox[{"Binarize", "[", 
          RowBox[{"ColorNegate", "[", 
           RowBox[{"GeoImage", "[", 
            RowBox[{"location", ",", " ", 
             RowBox[{"GeoRange", " ", "->", " ", "range"}]}], "]"}], "]"}], 
          "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"White", " ", "->", " ", 
            RowBox[{"RGBColor", "[", 
             RowBox[{"0", ",", " ", "0", ",", " ", 
              RowBox[{"Rational", "[", 
               RowBox[{"2", ",", " ", "3"}], "]"}], ",", " ", "0.5"}], 
             "]"}]}], ",", " ", 
           RowBox[{"Black", " ", "->", " ", 
            RowBox[{"RGBColor", "[", 
             RowBox[{"0.5", ",", " ", "0.5", ",", " ", "0.5", ",", " ", "0"}],
              "]"}]}]}], "}"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fullSatelliteImage", " ", "=", " ", 
      RowBox[{"ImageCompose", "[", 
       RowBox[{"satelliteImage", ",", " ", "riverImage"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ListPlot3D", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"QuantityMagnitude", "[", 
        RowBox[{"GeoElevationData", "[", 
         RowBox[{
          RowBox[{"GeoPosition", "[", "location", "]"}], ",", 
          RowBox[{"GeoRange", "->", "range"}]}], "]"}], "]"}], ",", " ", 
       RowBox[{"MeshFunctions", " ", "\[Rule]", " ", 
        RowBox[{"{", 
         RowBox[{"#3", " ", "&"}], "}"}]}], ",", " ", 
       RowBox[{"PlotRange", " ", "->", " ", "All"}], ",", " ", 
       RowBox[{"PlotStyle", " ", "->", " ", 
        RowBox[{"Texture", "[", 
         RowBox[{"ImageRotate", "[", 
          RowBox[{"fullSatelliteImage", ",", " ", 
           RowBox[{"3", " ", 
            RowBox[{"Pi", "/", "2"}]}]}], "]"}], "]"}]}], ",", " ", 
       RowBox[{"Filling", " ", "->", " ", "Bottom"}], ",", " ", 
       RowBox[{"FillingStyle", " ", "\[Rule]", " ", 
        RowBox[{"Opacity", "[", "1", "]"}]}], ",", " ", 
       RowBox[{"ImageSize", " ", "->", " ", "1000"}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{
  3.961019249469328*^9, 3.961019657527384*^9, 3.961019751519121*^9, {
   3.9610198236839256`*^9, 3.9610198566263523`*^9}, {3.9610198911239033`*^9, 
   3.961019922405594*^9}, 3.9610200476585865`*^9, {3.9610201487366695`*^9, 
   3.9610201624734936`*^9}, {3.9610202219768734`*^9, 3.9610203932842655`*^9}, 
   3.961020585568228*^9, {3.961020736032217*^9, 3.961020911755659*^9}, 
   3.961021175728647*^9, {3.9610568848952446`*^9, 3.961056891669256*^9}, {
   3.9610570345234985`*^9, 3.9610570414194393`*^9}, {3.9610572441077156`*^9, 
   3.9610572969849243`*^9}, {3.9610579271069527`*^9, 
   3.9610579608535137`*^9}, {3.961058013843725*^9, 3.96105813067153*^9}, {
   3.9610582718110104`*^9, 3.9610583179927464`*^9}, 3.961062284606779*^9, {
   3.961064789079359*^9, 3.9610648858194237`*^9}, {3.961080866263054*^9, 
   3.961080866924879*^9}, {3.9610954759921417`*^9, 3.961095512667198*^9}, 
   3.9611484725035076`*^9, {3.9611605332944603`*^9, 3.9611605495046024`*^9}, {
   3.96116209742968*^9, 3.9611621294562683`*^9}, {3.961164225649416*^9, 
   3.9611642305055676`*^9}, 3.9611644022873116`*^9, 3.9623619977457027`*^9, {
   3.962365505153241*^9, 3.962365517494182*^9}, {3.962365686383946*^9, 
   3.962365691189455*^9}, {3.9623680719788513`*^9, 3.962368088679596*^9}, {
   3.962369035975401*^9, 3.9623690505127106`*^9}},
 CellLabel->
  "In[148]:=",ExpressionUUID->"47e5a163-51ff-354d-8bbd-484bef6741a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generate3DTerrain", "[", 
   RowBox[{"gridSize_", ",", " ", "location_", ",", 
    RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "mappedTerrain", ",", "heightArray", ",", "terrainTypeArray", ",", 
      "threeDPlot"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mappedTerrain", "=", 
      RowBox[{"mapTerrainValues", "[", 
       RowBox[{"gridSize", ",", "location", ",", "rangeKM"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"heightArray", "=", 
      RowBox[{"mappedTerrain", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"terrainTypeArray", "=", 
      RowBox[{"mappedTerrain", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"threeDPlot", " ", "=", "\n", "\t\t", 
      RowBox[{"ListPlot3D", "[", 
       RowBox[{"heightArray", ",", " ", 
        RowBox[{"ColorFunction", "->", " ", 
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x", ",", "y", ",", "z"}], "}"}], ",", " ", 
           RowBox[{"$terrainLookup", "[", 
            RowBox[{"terrainTypeArray", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"Round", "[", "y", "]"}], ",", 
               RowBox[{"Round", "[", "x", "]"}]}], "]"}], "]"}], "]"}]}], 
          "]"}]}], ",", " ", 
        RowBox[{"ColorFunctionScaling", " ", "->", " ", "False"}], ",", " ", 
        RowBox[{"Mesh", "->", "None"}]}], "\n", "\t\t", "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{
  3.961019249469328*^9, 3.961019657527384*^9, 3.961019751519121*^9, {
   3.9610198236839256`*^9, 3.9610198566263523`*^9}, {3.9610198911239033`*^9, 
   3.961019922405594*^9}, 3.9610200476585865`*^9, {3.9610201487366695`*^9, 
   3.9610201624734936`*^9}, {3.9610202219768734`*^9, 3.9610203932842655`*^9}, 
   3.961020585568228*^9, {3.961020736032217*^9, 3.961020911755659*^9}, 
   3.961021175728647*^9, {3.9610568848952446`*^9, 3.961056891669256*^9}, {
   3.9610570345234985`*^9, 3.9610570414194393`*^9}, {3.9610572441077156`*^9, 
   3.9610572969849243`*^9}, {3.9610579271069527`*^9, 
   3.9610579608535137`*^9}, {3.961058013843725*^9, 3.96105813067153*^9}, {
   3.9610582718110104`*^9, 3.9610583179927464`*^9}, 3.961062284606779*^9, {
   3.961064789079359*^9, 3.9610648858194237`*^9}, {3.961080866263054*^9, 
   3.961080866924879*^9}, {3.9610954759921417`*^9, 3.961095512667198*^9}, 
   3.9611484725035076`*^9, {3.9611605332944603`*^9, 3.961160548318983*^9}, 
   3.9611610319674206`*^9, 3.961161465133753*^9, {3.9611621321229*^9, 
   3.9611621363964386`*^9}, {3.9611642395635586`*^9, 3.9611642411830673`*^9}, 
   3.961164407696329*^9, 3.9611656044775753`*^9, {3.962368304461649*^9, 
   3.9623683141279926`*^9}, {3.9623686405105133`*^9, 3.9623686432404785`*^9}},
 CellLabel->
  "In[149]:=",ExpressionUUID->"1b0cc37a-d65a-ec49-ad10-6316e1f26fc7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"run3DFireSimulation", "[", 
   RowBox[{
    RowBox[{"gridSize_", ":", "40"}], ",", 
    RowBox[{"initialFires_", ":", "2"}], ",", 
    RowBox[{"timeSteps_", ":", "20"}], ",", 
    RowBox[{"ignitionProbability_", ":", "0.8"}], ",", 
    RowBox[{"windSpeed_", ":", "0.3"}], ",", 
    RowBox[{"windDirection_", ":", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}]}], ",", 
    RowBox[{"moisture_", ":", "0.2"}], ",", 
    RowBox[{"uphillMultiplier_", ":", "1.5"}], ",", 
    RowBox[{"downhillMultiplier_", ":", "0.7"}], ",", 
    RowBox[{"location_", ":", "Automatic"}], ",", 
    RowBox[{"maxHeight_", ":", "30"}], ",", 
    RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "terrainAndElev", ",", "terrainGrid", ",", "elevationGrid", ",", 
      "fireGrid", ",", "actualLocation", ",", "firePoints", ",", "result", ",",
       "fireHistory", ",", "array3D", ",", "animation3D", ",", 
      "animationSurface", ",", "gridPos", ",", "terrain", ",", "props", ",", 
      "fire3D"}], "}"}], ",", 
    RowBox[{
     RowBox[{"actualLocation", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"location", "===", "Automatic"}], ",", 
        RowBox[{"getRandomEarthLocation", "[", "]"}], ",", "location"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"terrainAndElev", "=", 
      RowBox[{"initializeTerrainGrid", "[", 
       RowBox[{"gridSize", ",", "actualLocation", ",", "rangeKM"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"terrainGrid", "=", 
      RowBox[{"terrainAndElev", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"elevationGrid", "=", 
      RowBox[{"terrainAndElev", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fireGrid", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"gridSize", ",", "gridSize"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"array3D", "=", 
      RowBox[{"create3DTerrainArray", "[", 
       RowBox[{
       "elevationGrid", ",", "terrainGrid", ",", "gridSize", ",", 
        "maxHeight"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"result", "=", 
      RowBox[{"DialogInput", "[", 
       RowBox[{"DynamicModule", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"currentPoint", "=", 
            RowBox[{"{", 
             RowBox[{"15", ",", "15"}], "}"}]}], ",", 
           RowBox[{"selectedPoints", "=", 
            RowBox[{"{", "}"}]}]}], "}"}], ",", 
         RowBox[{"Column", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
            "Text", "[", "\"\<Click on the terrain to place fire starting \
points\>\"", "]"}], ",", 
            RowBox[{"Text", "[", 
             RowBox[{"Dynamic", "[", 
              RowBox[{"\"\<Points selected: \>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"Length", "[", "selectedPoints", "]"}], "]"}], 
               "<>", "\"\</\>\"", "<>", 
               RowBox[{"ToString", "[", "initialFires", "]"}]}], "]"}], "]"}],
             ",", 
            RowBox[{"LocatorPane", "[", 
             RowBox[{
              RowBox[{"Dynamic", "[", "currentPoint", "]"}], ",", 
              RowBox[{"plotTerrain", "[", 
               RowBox[{
               "terrainGrid", ",", "\"\<Select Fire Starting Points\>\""}], 
               "]"}], ",", 
              RowBox[{"Appearance", "->", 
               RowBox[{"Graphics", "[", 
                RowBox[{"{", 
                 RowBox[{"Red", ",", 
                  RowBox[{"PointSize", "[", "0.05", "]"}], ",", 
                  RowBox[{"Point", "[", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], "]"}]}], "}"}], "]"}]}]}],
              "]"}], ",", 
            RowBox[{"Row", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Add Fire Point\>\"", ",", 
                 RowBox[{
                  RowBox[{"gridPos", "=", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Clip", "[", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{"gridSize", "-", 
                    RowBox[{"currentPoint", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "gridSize"}], "}"}]}], "]"}], ",", 
                    RowBox[{"Clip", "[", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{"currentPoint", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "gridSize"}], "}"}]}], "]"}]}], "}"}]}],
                   ";", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"terrainGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "!=", 
                    "6"}], ",", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"selectedPoints", ",", "gridPos"}], "]"}], ",", 
                    RowBox[{
                    "MessageDialog", 
                    "[", "\"\<Cannot place fire on water!\>\"", "]"}]}], 
                   "]"}]}], ",", 
                 RowBox[{"Enabled", "->", 
                  RowBox[{"Dynamic", "[", 
                   RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], "<", 
                    "initialFires"}], "]"}]}]}], "]"}], ",", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Reset\>\"", ",", 
                 RowBox[{"selectedPoints", "=", 
                  RowBox[{"{", "}"}]}]}], "]"}], ",", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Run Simulation\>\"", ",", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], ">", 
                    "0"}], ",", 
                   RowBox[{"DialogReturn", "[", "selectedPoints", "]"}], ",", 
                   RowBox[{
                   "MessageDialog", 
                    "[", "\"\<Please select at least one fire point!\>\"", 
                    "]"}]}], "]"}], ",", 
                 RowBox[{"Enabled", "->", 
                  RowBox[{"Dynamic", "[", 
                   RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], ">", 
                    "0"}], "]"}]}]}], "]"}], ",", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Cancel\>\"", ",", 
                 RowBox[{"DialogReturn", "[", "$Canceled", "]"}]}], "]"}]}], 
              "}"}], "]"}]}], "}"}], "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"result", "===", "$Canceled"}], ",", 
       RowBox[{"Return", "[", "$Canceled", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"firePoints", "=", "result"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"terrain", "=", 
         RowBox[{"terrainGrid", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"props", "=", 
         RowBox[{"getPatchProperties", "[", "terrain", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fireGrid", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "=", 
         RowBox[{"props", "[", "\"\<burnTime\>\"", "]"}]}], ";"}], ",", 
       RowBox[{"{", 
        RowBox[{"pos", ",", "firePoints"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fireHistory", "=", 
      RowBox[{"NestList", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"fireSpreadRule", "[", 
          RowBox[{
          "terrainGrid", ",", "#", ",", "elevationGrid", ",", "gridSize", ",",
            "ignitionProbability", ",", "windSpeed", ",", "windDirection", ",",
            "moisture", ",", "uphillMultiplier", ",", "downhillMultiplier"}], 
          "]"}], "&"}], ",", "fireGrid", ",", "timeSteps"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"animation3D", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"fire3D", "=", 
          RowBox[{"mapFireTo3D", "[", 
           RowBox[{"array3D", ",", 
            RowBox[{"fireHistory", "[", 
             RowBox[{"[", "t", "]"}], "]"}], ",", "terrainGrid", ",", 
            "elevationGrid", ",", "maxHeight"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"visualize3DFire", "[", 
          RowBox[{"fire3D", ",", 
           RowBox[{"\"\<Time: \>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"t", "-", "1"}], "]"}]}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"Length", "[", "fireHistory", "]"}]}], "}"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"animationSurface", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"visualize3DFireSurface", "[", 
         RowBox[{"elevationGrid", ",", 
          RowBox[{"fireHistory", "[", 
           RowBox[{"[", "t", "]"}], "]"}], ",", "terrainGrid", ",", 
          RowBox[{"\"\<Time: \>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"t", "-", "1"}], "]"}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"Length", "[", "fireHistory", "]"}]}], "}"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<VoxelAnimation\>\"", "->", 
        RowBox[{"ListAnimate", "[", 
         RowBox[{"animation3D", ",", 
          RowBox[{"AnimationRunning", "->", "True"}], ",", 
          RowBox[{"AnimationRate", "->", "1"}]}], "]"}]}], ",", 
       RowBox[{"\"\<FireHistory\>\"", "->", "fireHistory"}], ",", 
       RowBox[{"\"\<TerrainGrid\>\"", "->", "terrainGrid"}], ",", 
       RowBox[{"\"\<ElevationGrid\>\"", "->", "elevationGrid"}], ",", 
       RowBox[{"\"\<Location\>\"", "->", "actualLocation"}], ",", 
       RowBox[{"\"\<FinalVoxelPlot\>\"", "->", 
        RowBox[{"Last", "[", "animation3D", "]"}]}], ",", 
       RowBox[{"\"\<FinalSurfacePlot\>\"", "->", 
        RowBox[{"Last", "[", "animationSurface", "]"}]}]}], "|>"}]}]}], 
   "]"}]}]], "Input",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{
  3.961019249469328*^9, 3.961019657527384*^9, 3.961019751519121*^9, {
   3.9610198236839256`*^9, 3.9610198566263523`*^9}, {3.9610198911239033`*^9, 
   3.961019922405594*^9}, 3.9610200476585865`*^9, {3.9610201487366695`*^9, 
   3.9610201624734936`*^9}, {3.9610202219768734`*^9, 3.9610203932842655`*^9}, 
   3.961020585568228*^9, {3.961020736032217*^9, 3.961020911755659*^9}, 
   3.961021175728647*^9, {3.9610568848952446`*^9, 3.961056891669256*^9}, {
   3.9610570345234985`*^9, 3.9610570414194393`*^9}, {3.9610572441077156`*^9, 
   3.9610572969849243`*^9}, {3.9610579271069527`*^9, 
   3.9610579608535137`*^9}, {3.961058013843725*^9, 3.96105813067153*^9}, {
   3.9610582718110104`*^9, 3.9610583179927464`*^9}, 3.961062284606779*^9, {
   3.961064789079359*^9, 3.9610648858194237`*^9}, 3.961080866263054*^9, 
   3.9610810281542835`*^9, 3.9610842765115337`*^9, {3.962337308401782*^9, 
   3.962337310825856*^9}, {3.9623683219370728`*^9, 3.9623683264609528`*^9}, {
   3.96236835719973*^9, 3.962368358205181*^9}},
 CellLabel->
  "In[150]:=",ExpressionUUID->"0b518be7-fd2c-f046-99b8-0818d2086fb3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"predictFireSpread", "[", 
   RowBox[{
   "terrainGrid_", ",", "elevationGrid_", ",", "windSpeed_", ",", 
    "windDirection_", ",", "moisture_", ",", "gridSize_", ",", 
    RowBox[{"predictionSteps_", ":", "10"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "riskMap", ",", "patchProps", ",", "windFactor", ",", "moistureFactor", ",",
       "slopeFactor", ",", "neighbors", ",", "avgRisk", ",", 
      "windAlignment"}], "}"}], ",", 
    RowBox[{
     RowBox[{"riskMap", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"0.0", ",", 
        RowBox[{"{", "gridSize", "}"}], ",", 
        RowBox[{"{", "gridSize", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"terrainGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "6"}], "||", 
          RowBox[{
           RowBox[{"terrainGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "3"}]}], ",", 
         RowBox[{
          RowBox[{"riskMap", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", "0"}], ",", 
         RowBox[{
          RowBox[{"patchProps", "=", 
           RowBox[{"getPatchProperties", "[", 
            RowBox[{"terrainGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"riskMap", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"7", "-", 
              RowBox[{"patchProps", "[", "\"\<flammability\>\"", "]"}]}], 
             ")"}], "/", "6.0"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"moistureFactor", "=", 
           RowBox[{"1", "-", "moisture"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"riskMap", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "*=", "moistureFactor"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"windFactor", "=", 
           RowBox[{"1", "+", 
            RowBox[{"windSpeed", "*", "2"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"neighbors", "=", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"i", "-", "1"}], ",", 
                 RowBox[{"j", "-", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"i", "-", "1"}], ",", "j"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"i", "-", "1"}], ",", 
                 RowBox[{"j", "+", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"j", "-", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"j", "+", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"i", "+", "1"}], ",", 
                 RowBox[{"j", "-", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"i", "+", "1"}], ",", "j"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"i", "+", "1"}], ",", 
                 RowBox[{"j", "+", "1"}]}], "}"}]}], "}"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"1", "<=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "<=", "gridSize"}], "&&", 
               RowBox[{"1", "<=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "<=", "gridSize"}]}], 
              "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"avgRisk", "=", 
           RowBox[{"Mean", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"terrainGrid", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"n", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"n", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "==", 
                  "6"}], "||", 
                 RowBox[{
                  RowBox[{"terrainGrid", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"n", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"n", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "==", 
                  "3"}]}], ",", "0", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"7", "-", 
                   RowBox[{
                    RowBox[{"getPatchProperties", "[", 
                    RowBox[{"terrainGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"n", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"n", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "\"\<flammability\>\"", "]"}], "]"}]}], 
                  ")"}], "/", "6.0"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", "neighbors"}], "}"}]}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"riskMap", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"0.7", "*", 
             RowBox[{"riskMap", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "+", 
            RowBox[{"0.3", "*", "avgRisk"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"windAlignment", "=", 
              RowBox[{"windDirection", ".", 
               RowBox[{"Normalize", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"n", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "i"}], ",", 
                  RowBox[{
                   RowBox[{"n", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "-", "j"}]}], "}"}], 
                "]"}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"windAlignment", ">", "0.5"}], ",", 
               RowBox[{
                RowBox[{"riskMap", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], "+=", 
                RowBox[{"0.2", "*", "windSpeed", "*", "windAlignment"}]}]}], 
              "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "neighbors"}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"slopeFactor", "=", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"elevationGrid", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"n", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"n", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "-", 
                RowBox[{"elevationGrid", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ")"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"slopeFactor", ">", "0"}], ",", 
               RowBox[{
                RowBox[{"riskMap", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], "*=", 
                RowBox[{"(", 
                 RowBox[{"1", "+", 
                  RowBox[{"0.3", "*", 
                   RowBox[{"Tanh", "[", 
                    RowBox[{"slopeFactor", "*", "10"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"riskMap", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], "*=", 
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  RowBox[{"0.2", "*", 
                   RowBox[{"Tanh", "[", 
                    RowBox[{
                    RowBox[{"Abs", "[", "slopeFactor", "]"}], "*", "10"}], 
                    "]"}]}]}], ")"}]}]}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "neighbors"}], "}"}]}], "]"}], ";"}]}], "]"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "gridSize"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "gridSize"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"riskMap", "=", 
      RowBox[{"Rescale", "[", 
       RowBox[{"riskMap", ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"Max", "[", "riskMap", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"riskMap", "=", 
      RowBox[{"riskMap", "^", "1.5"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"GaussianFilter", "[", 
      RowBox[{"riskMap", ",", "2"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.960736793277609*^9}, {
   3.9608256334891243`*^9, 3.9608257464847717`*^9}, {3.960825811866663*^9, 
   3.9608258224095097`*^9}, {3.960825880602461*^9, 3.960825883797512*^9}, 
   3.960882703980961*^9, {3.961066165303526*^9, 3.9610661781692963`*^9}, {
   3.961066216831787*^9, 3.961066220117161*^9}, {3.9610664685935383`*^9, 
   3.96106648910433*^9}, {3.9611011553447685`*^9, 3.961101164699402*^9}, 
   3.9611012119572296`*^9, 3.9611019017121086`*^9, {3.961103497677809*^9, 
   3.9611034983636284`*^9}, 3.9611431351609592`*^9, {3.9611432042830353`*^9, 
   3.96114324507963*^9}},
 CellLabel->
  "In[151]:=",ExpressionUUID->"10c034e5-3abc-e34a-ad04-dd32261cbf3d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"applyControlledBurnStrategy", "[", 
   RowBox[{
   "terrainGrid_", ",", "elevationGrid_", ",", "windSpeed_", ",", 
    "windDirection_", ",", "moisture_", ",", "gridSize_", ",", 
    RowBox[{"showVisualization_", ":", "True"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "riskMap", ",", "burnPatches", ",", "corridorBreaks", ",", 
      "modifiedTerrain", ",", "allBurnCells", ",", "patchBurnArea", ",", 
      "corridorBurnArea"}], "}"}], ",", 
    RowBox[{
     RowBox[{"riskMap", "=", 
      RowBox[{"predictFireSpread", "[", 
       RowBox[{
       "terrainGrid", ",", "elevationGrid", ",", "windSpeed", ",", 
        "windDirection", ",", "moisture", ",", "gridSize"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"showVisualization", ",", 
       RowBox[{"Grid", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ArrayPlot", "[", 
             RowBox[{"riskMap", ",", 
              RowBox[{"ColorFunction", "->", "\"\<TemperatureMap\>\""}], ",", 
              RowBox[{"PlotLabel", "->", "\"\<Fire Risk Map\>\""}], ",", 
              RowBox[{"ImageSize", "->", "300"}]}], "]"}], ",", 
            RowBox[{"ArrayPlot", "[", 
             RowBox[{"terrainGrid", ",", 
              RowBox[{"ColorRules", "->", "$terrainColorRules"}], ",", 
              RowBox[{"PlotLabel", "->", "\"\<Original Terrain\>\""}], ",", 
              RowBox[{"ImageSize", "->", "300"}]}], "]"}]}], "}"}], "}"}], ",", 
         RowBox[{"Frame", "->", "All"}], ",", 
         RowBox[{"FrameStyle", "->", "LightGray"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.960736793277609*^9}, {
   3.9608256334891243`*^9, 3.9608257464847717`*^9}, {3.960825811866663*^9, 
   3.9608258224095097`*^9}, {3.960825880602461*^9, 3.960825883797512*^9}, 
   3.960882703980961*^9, {3.961066165303526*^9, 3.9610661781692963`*^9}, {
   3.961066216831787*^9, 3.961066220117161*^9}, {3.9610664685935383`*^9, 
   3.96106648910433*^9}, {3.9611011553447685`*^9, 3.961101164699402*^9}, 
   3.9611012119572296`*^9, {3.961103323028406*^9, 3.9611033273105087`*^9}, {
   3.961103506573805*^9, 3.961103541995678*^9}, {3.9611431586557083`*^9, 
   3.9611431597676353`*^9}, {3.9611432493510227`*^9, 3.961143252117676*^9}, {
   3.9611434513929977`*^9, 3.9611434572628555`*^9}, {3.961143506686657*^9, 
   3.961143532319439*^9}, 3.961162207319044*^9},
 CellLabel->
  "In[152]:=",ExpressionUUID->"8120ab07-66b0-c442-92fe-cf8e1247ab77"],

Cell[BoxData[
 RowBox[{
  RowBox[{"visualizeRisks", "[", 
   RowBox[{
    RowBox[{"gridSize_", ":", "50"}], ",", " ", 
    RowBox[{"windSpeed_", ":", "0"}], ",", " ", 
    RowBox[{"windDirection_", ":", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}]}], ",", " ", 
    RowBox[{"moisture_", ":", "0"}], ",", 
    RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], " ", ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "location", ",", " ", "terrainAndElev", ",", " ", "terrainGrid", ",", 
      " ", "elevationGrid"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"location", "=", 
      RowBox[{"getRandomEarthLocation", "[", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"terrainAndElev", "=", 
      RowBox[{"initializeTerrainGrid", "[", 
       RowBox[{"50", ",", "location"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"terrainGrid", "=", 
      RowBox[{"terrainAndElev", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"elevationGrid", "=", 
      RowBox[{"terrainAndElev", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"applyControlledBurnStrategy", "[", 
      RowBox[{
      "terrainGrid", ",", " ", "elevationGrid", ",", "windSpeed", ",", " ", 
       "windDirection", ",", "moisture", ",", "gridSize"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.960736793277609*^9}, {
   3.9608256334891243`*^9, 3.9608257464847717`*^9}, {3.960825811866663*^9, 
   3.9608258224095097`*^9}, {3.960825880602461*^9, 3.960825883797512*^9}, 
   3.960882703980961*^9, {3.961066165303526*^9, 3.9610661781692963`*^9}, {
   3.961066216831787*^9, 3.961066220117161*^9}, {3.9610664685935383`*^9, 
   3.96106648910433*^9}, {3.9611011553447685`*^9, 3.961101164699402*^9}, 
   3.9611012119572296`*^9, {3.961103323028406*^9, 3.961103329648525*^9}, 
   3.961103606535824*^9, {3.9611432678526917`*^9, 3.9611434307843475`*^9}, {
   3.961143484972645*^9, 3.9611434866016903`*^9}, 3.961166537662548*^9, {
   3.9623683737997036`*^9, 3.962368378468233*^9}, 3.962411188264433*^9, 
   3.964127178661503*^9},
 CellLabel->
  "In[153]:=",ExpressionUUID->"3df064f5-061b-7347-b7d9-15358d146cec"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"run3DFireSimulationWithEmbers", "[", 
    RowBox[{
     RowBox[{"gridSize_", ":", "40"}], ",", 
     RowBox[{"initialFires_", ":", "2"}], ",", 
     RowBox[{"timeSteps_", ":", "20"}], ",", 
     RowBox[{"ignitionProbability_", ":", "0.8"}], ",", 
     RowBox[{"windSpeed_", ":", "0.3"}], ",", 
     RowBox[{"windDirection_", ":", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}]}], ",", 
     RowBox[{"moisture_", ":", "0.2"}], ",", 
     RowBox[{"uphillMultiplier_", ":", "1.5"}], ",", 
     RowBox[{"downhillMultiplier_", ":", "0.7"}], ",", 
     RowBox[{"location_", ":", "Automatic"}], ",", 
     RowBox[{"maxHeight_", ":", "30"}], ",", 
     RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "terrainAndElev", ",", "terrainGrid", ",", "elevationGrid", ",", 
       "fireGrid", ",", "emberGrid", ",", "actualLocation", ",", "firePoints",
        ",", "result", ",", "fireHistory", ",", "emberHistory", ",", 
       "array3D", ",", "animation3D", ",", "animationSurface", ",", "gridPos",
        ",", "terrain", ",", "props", ",", "fire3D", ",", "updated"}], "}"}], 
     ",", 
     RowBox[{"(*", 
      RowBox[{"Initialize", " ", "location", " ", "and", " ", "terrain"}], 
      "*)"}], 
     RowBox[{
      RowBox[{"actualLocation", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"location", "===", "Automatic"}], ",", 
         RowBox[{"getRandomEarthLocation", "[", "]"}], ",", "location"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"terrainAndElev", "=", 
       RowBox[{"initializeTerrainGrid", "[", 
        RowBox[{"gridSize", ",", "actualLocation", ",", "rangeKM"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"terrainGrid", "=", 
       RowBox[{"terrainAndElev", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"elevationGrid", "=", 
       RowBox[{"terrainAndElev", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Initialize", " ", "fire", " ", "and", " ", "ember", " ", "grids"}], 
       "*)"}], 
      RowBox[{"fireGrid", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"gridSize", ",", "gridSize"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"emberGrid", "=", 
       RowBox[{"initializeEmberGrid", "[", "gridSize", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Create", " ", "3", "D", " ", "terrain", " ", "array"}], 
       "*)"}], 
      RowBox[{"array3D", "=", 
       RowBox[{"create3DTerrainArray", "[", 
        RowBox[{
        "elevationGrid", ",", "terrainGrid", ",", "gridSize", ",", 
         "maxHeight"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Get", " ", "fire", " ", "starting", " ", "points", " ", "via", " ", 
        "dialog"}], "*)"}], 
      RowBox[{"result", "=", 
       RowBox[{"DialogInput", "[", 
        RowBox[{"DynamicModule", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"currentPoint", "=", 
             RowBox[{"{", 
              RowBox[{"15", ",", "15"}], "}"}]}], ",", 
            RowBox[{"selectedPoints", "=", 
             RowBox[{"{", "}"}]}]}], "}"}], ",", 
          RowBox[{"Column", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "Text", "[", "\"\<Click on the terrain to place fire starting \
points\>\"", "]"}], ",", 
             RowBox[{"Text", "[", 
              RowBox[{"Dynamic", "[", 
               RowBox[{"\"\<Points selected: \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"Length", "[", "selectedPoints", "]"}], "]"}], 
                "<>", "\"\</\>\"", "<>", 
                RowBox[{"ToString", "[", "initialFires", "]"}]}], "]"}], 
              "]"}], ",", 
             RowBox[{"LocatorPane", "[", 
              RowBox[{
               RowBox[{"Dynamic", "[", "currentPoint", "]"}], ",", 
               RowBox[{"plotTerrain", "[", 
                RowBox[{
                "terrainGrid", ",", "\"\<Select Fire Starting Points\>\""}], 
                "]"}], ",", 
               RowBox[{"Appearance", "->", 
                RowBox[{"Graphics", "[", 
                 RowBox[{"{", 
                  RowBox[{"Red", ",", 
                   RowBox[{"PointSize", "[", "0.05", "]"}], ",", 
                   RowBox[{"Point", "[", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], "]"}]}], "}"}], "]"}]}]}],
               "]"}], ",", 
             RowBox[{"Row", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Button", "[", 
                 RowBox[{"\"\<Add Fire Point\>\"", ",", 
                  RowBox[{
                   RowBox[{"gridPos", "=", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Clip", "[", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{"gridSize", "-", 
                    RowBox[{"currentPoint", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "gridSize"}], "}"}]}], "]"}], ",", 
                    RowBox[{"Clip", "[", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{"currentPoint", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "gridSize"}], "}"}]}], "]"}]}], "}"}]}],
                    ";", "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"terrainGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "!=", 
                    "6"}], ",", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"selectedPoints", ",", "gridPos"}], "]"}], ",", 
                    RowBox[{
                    "MessageDialog", 
                    "[", "\"\<Cannot place fire on water!\>\"", "]"}]}], 
                    "]"}]}], ",", 
                  RowBox[{"Enabled", "->", 
                   RowBox[{"Dynamic", "[", 
                    RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], "<", 
                    "initialFires"}], "]"}]}]}], "]"}], ",", 
                RowBox[{"Button", "[", 
                 RowBox[{"\"\<Reset\>\"", ",", 
                  RowBox[{"selectedPoints", "=", 
                   RowBox[{"{", "}"}]}]}], "]"}], ",", 
                RowBox[{"Button", "[", 
                 RowBox[{"\"\<Run Simulation\>\"", ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], ">", 
                    "0"}], ",", 
                    RowBox[{"DialogReturn", "[", "selectedPoints", "]"}], ",", 
                    RowBox[{
                    "MessageDialog", 
                    "[", "\"\<Please select at least one fire point!\>\"", 
                    "]"}]}], "]"}], ",", 
                  RowBox[{"Enabled", "->", 
                   RowBox[{"Dynamic", "[", 
                    RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], ">", 
                    "0"}], "]"}]}]}], "]"}], ",", 
                RowBox[{"Button", "[", 
                 RowBox[{"\"\<Cancel\>\"", ",", 
                  RowBox[{"DialogReturn", "[", "$Canceled", "]"}]}], "]"}]}], 
               "}"}], "]"}]}], "}"}], "]"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"result", "===", "$Canceled"}], ",", 
        RowBox[{"Return", "[", "$Canceled", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"firePoints", "=", "result"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Set", " ", "initial", " ", "fires"}], "*)"}], 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"terrain", "=", 
          RowBox[{"terrainGrid", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"pos", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"pos", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"props", "=", 
          RowBox[{"getPatchProperties", "[", "terrain", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"fireGrid", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"pos", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"pos", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "=", 
          RowBox[{"props", "[", "\"\<burnTime\>\"", "]"}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"pos", ",", "firePoints"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Run", " ", "simulation", " ", "with", " ", "ember", " ", "tracking"}],
        "*)"}], 
      RowBox[{"fireHistory", "=", 
       RowBox[{"{", "fireGrid", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"emberHistory", "=", 
       RowBox[{"{", "emberGrid", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{"(*", 
        RowBox[{
        "Use", " ", "the", " ", "enhanced", " ", "fire", " ", "spread", " ", 
         "with", " ", "embers"}], "*)"}], 
       RowBox[{
        RowBox[{
         RowBox[{"updated", "=", 
          RowBox[{"fireSpreadRuleWithEmbers", "[", 
           RowBox[{"terrainGrid", ",", 
            RowBox[{"Last", "[", "fireHistory", "]"}], ",", "elevationGrid", ",", 
            RowBox[{"Last", "[", "emberHistory", "]"}], ",", "gridSize", ",", 
            "ignitionProbability", ",", "windSpeed", ",", "windDirection", ",",
             "moisture", ",", "uphillMultiplier", ",", "downhillMultiplier"}],
            "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"fireHistory", ",", 
           RowBox[{"updated", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"emberHistory", ",", 
           RowBox[{"updated", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";"}], ",", 
        RowBox[{"{", "timeSteps", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Create", " ", "3", "D", " ", "animations", " ", "with", " ", "ember", 
        " ", "visualization"}], "*)"}], 
      RowBox[{"animation3D", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"fire3D", "=", 
           RowBox[{"mapFireTo3DWithEmbers", "[", 
            RowBox[{"array3D", ",", 
             RowBox[{"fireHistory", "[", 
              RowBox[{"[", "t", "]"}], "]"}], ",", 
             RowBox[{"emberHistory", "[", 
              RowBox[{"[", "t", "]"}], "]"}], ",", "terrainGrid", ",", 
             "elevationGrid", ",", "maxHeight"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"visualize3DFireWithEmbers", "[", 
           RowBox[{"fire3D", ",", 
            RowBox[{"emberHistory", "[", 
             RowBox[{"[", "t", "]"}], "]"}], ",", 
            RowBox[{"\"\<Time: \>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"t", "-", "1"}], "]"}]}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", 
           RowBox[{"Length", "[", "fireHistory", "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Surface", " ", "animations", " ", "with", " ", "ember", " ", 
        "overlay"}], "*)"}], 
      RowBox[{"animationSurface", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"visualize3DFireSurfaceWithEmbers", "[", 
          RowBox[{"elevationGrid", ",", 
           RowBox[{"fireHistory", "[", 
            RowBox[{"[", "t", "]"}], "]"}], ",", 
           RowBox[{"emberHistory", "[", 
            RowBox[{"[", "t", "]"}], "]"}], ",", "terrainGrid", ",", 
           RowBox[{"\"\<Time: \>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"t", "-", "1"}], "]"}]}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", 
           RowBox[{"Length", "[", "fireHistory", "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Return", " ", "enhanced", " ", "results"}], "*)"}], 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"\"\<VoxelAnimation\>\"", "->", 
         RowBox[{"ListAnimate", "[", 
          RowBox[{"animation3D", ",", 
           RowBox[{"AnimationRunning", "->", "True"}], ",", 
           RowBox[{"AnimationRate", "->", "1"}]}], "]"}]}], ",", 
        RowBox[{"\"\<SurfaceAnimation\>\"", "->", 
         RowBox[{"ListAnimate", "[", 
          RowBox[{"animationSurface", ",", 
           RowBox[{"AnimationRunning", "->", "True"}], ",", 
           RowBox[{"AnimationRate", "->", "1"}]}], "]"}]}], ",", 
        RowBox[{"\"\<FireHistory\>\"", "->", "fireHistory"}], ",", 
        RowBox[{"\"\<EmberHistory\>\"", "->", "emberHistory"}], ",", 
        RowBox[{"\"\<TerrainGrid\>\"", "->", "terrainGrid"}], ",", 
        RowBox[{"\"\<ElevationGrid\>\"", "->", "elevationGrid"}], ",", 
        RowBox[{"\"\<Location\>\"", "->", "actualLocation"}], ",", 
        RowBox[{"\"\<FinalVoxelPlot\>\"", "->", 
         RowBox[{"Last", "[", "animation3D", "]"}]}], ",", 
        RowBox[{"\"\<FinalSurfacePlot\>\"", "->", 
         RowBox[{"Last", "[", "animationSurface", "]"}]}], ",", 
        RowBox[{"\"\<SpotFires\>\"", "->", 
         RowBox[{"identifySpotFires", "[", 
          RowBox[{
           RowBox[{"{", "fireHistory", "}"}], ",", 
           RowBox[{"{", "emberHistory", "}"}]}], "]"}]}], ",", 
        RowBox[{"\"\<MaxEmberReach\>\"", "->", 
         RowBox[{"Max", "[", 
          RowBox[{"Flatten", "[", "emberHistory", "]"}], "]"}]}]}], 
       "|>"}]}]}], "]"}]}], "\n", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "3", "D", " ", "visualization", " ", "with", " ", "ember", " ", 
    "particles"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"mapFireTo3DWithEmbers", "[", 
    RowBox[{
    "array3D_", ",", "fireGrid_", ",", "emberGrid_", ",", "terrainGrid_", ",",
      "elevGrid_", ",", 
     RowBox[{"maxH_", ":", "50"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"out", "=", "array3D"}], ",", 
       RowBox[{"minElev", "=", 
        RowBox[{"Min", "[", "elevGrid", "]"}]}], ",", 
       RowBox[{"maxElev", "=", 
        RowBox[{"Max", "[", "elevGrid", "]"}]}], ",", "scaledElevation", ",", 
       "h", ",", "f", ",", "e"}], "}"}], ",", 
     RowBox[{
      RowBox[{"scaledElevation", "=", 
       RowBox[{"Rescale", "[", 
        RowBox[{"elevGrid", ",", 
         RowBox[{"{", 
          RowBox[{"minElev", ",", "maxElev"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "maxH"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"h", "=", 
          RowBox[{"Round", "[", 
           RowBox[{"scaledElevation", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"f", "=", 
          RowBox[{"fireGrid", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"e", "=", 
          RowBox[{"emberGrid", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Apply", " ", "fire", " ", "states"}], "*)"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"f", ">", "0"}], ",", 
           RowBox[{"Which", "[", 
            RowBox[{
             RowBox[{"1", "<=", "f", "<=", "10"}], ",", 
             RowBox[{
              RowBox[{"out", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"1", ";;", "h"}], ",", "i", ",", "j"}], "]"}], "]"}],
               "=", 
              RowBox[{"20", "+", "f"}]}], ",", 
             RowBox[{"(*", "burning", "*)"}], 
             RowBox[{"f", "==", "11"}], ",", 
             RowBox[{
              RowBox[{"out", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"1", ";;", "h"}], ",", "i", ",", "j"}], "]"}], "]"}],
               "=", "35"}]}], " ", 
            RowBox[{"(*", "charred", "*)"}], "]"}], ",", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"For", " ", "non"}], "-", 
             RowBox[{
             "burning", " ", "cells", " ", "with", " ", "significant", " ", 
              "ember", " ", "accumulation"}]}], "*)"}], 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"e", ">", "0.5"}], ",", 
             RowBox[{"(*", 
              RowBox[{
              "Mark", " ", "top", " ", "voxels", " ", "with", " ", "ember", " ",
                "indicator"}], "*)"}], 
             RowBox[{
              RowBox[{
               RowBox[{"out", "[", 
                RowBox[{"[", 
                 RowBox[{"h", ",", "i", ",", "j"}], "]"}], "]"}], "=", 
               RowBox[{"40", "+", 
                RowBox[{"Min", "[", 
                 RowBox[{"5", ",", 
                  RowBox[{"Round", "[", "e", "]"}]}], "]"}]}]}], ";"}]}], " ", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Codes", " ", "40"}], "-", 
              RowBox[{"45", " ", "for", " ", "embers"}]}], "*)"}], "]"}]}], 
          "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "fireGrid", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "out"}]}], "]"}]}], "\n", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Enhanced", " ", "3", "D", " ", "visualization", " ", "with", " ", "ember",
     " ", "particles"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"visualize3DFireWithEmbers", "[", 
    RowBox[{"array3D_", ",", "emberGrid_", ",", 
     RowBox[{"timeLabel_", ":", "\"\<\>\""}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "voxelData", ",", "colorFun", ",", "xMax", ",", "yMax", ",", "zMax", ",",
        "emberParticles"}], "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{
      "Extended", " ", "color", " ", "function", " ", "including", " ", 
       "ember", " ", "codes"}], "*)"}], 
     RowBox[{
      RowBox[{
       RowBox[{"colorFun", "[", "val_", "]"}], ":=", 
       RowBox[{"Which", "[", 
        RowBox[{
         RowBox[{"val", "==", "0"}], ",", "Nothing", ",", 
         RowBox[{"(*", 
          RowBox[{"empty", " ", "voxel"}], "*)"}], 
         RowBox[{"1", "<=", "val", "<=", "14"}], ",", 
         RowBox[{"$terrainLookup", "[", "val", "]"}], ",", 
         RowBox[{"(*", "terrain", "*)"}], 
         RowBox[{"21", "<=", "val", "<=", "30"}], ",", 
         RowBox[{"Blend", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Orange", ",", "Red"}], "}"}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"val", "-", "21"}], ")"}], "/", "9"}]}], "]"}], ",", 
         RowBox[{"(*", "burning", "*)"}], 
         RowBox[{"val", "==", "35"}], ",", "Black", ",", 
         RowBox[{"(*", "charred", "*)"}], 
         RowBox[{"40", "<=", "val", "<=", "45"}], ",", 
         RowBox[{"Blend", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Yellow", ",", "Orange"}], "}"}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"val", "-", "40"}], ")"}], "/", "5"}]}], "]"}], ",", 
         RowBox[{"(*", "embers", "*)"}], "True", ",", "Gray"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"zMax", ",", "yMax", ",", "xMax"}], "}"}], "=", 
       RowBox[{"Dimensions", "[", "array3D", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Generate", " ", "voxel", " ", "data"}], "*)"}], 
      RowBox[{"voxelData", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"code", "=", 
             RowBox[{"array3D", "[", 
              RowBox[{"[", 
               RowBox[{"z", ",", "y", ",", "x"}], "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"code", "=!=", "0"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"colorFun", "[", "code", "]"}], ",", 
               RowBox[{"Cuboid", "[", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "y", ",", "z"}], "}"}], "]"}]}], "}"}], ",",
              "Nothing"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"z", ",", "zMax"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"y", ",", "yMax"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "xMax"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Add", " ", "floating", " ", "ember", " ", "particles", " ", "above", " ",
         "high", " ", "ember", " ", "accumulation", " ", "areas"}], "*)"}], 
      RowBox[{"emberParticles", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"emberGrid", "[", 
             RowBox[{"[", 
              RowBox[{"y", ",", "x"}], "]"}], "]"}], ">", "1.0"}], ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Blend", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"Yellow", ",", "Orange", ",", "Red"}], "}"}], ",", 
                 RowBox[{"RandomReal", "[", "]"}]}], "]"}], ",", 
               RowBox[{"PointSize", "[", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"0.01", ",", "0.03"}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"Point", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"x", "+", 
                   RowBox[{"RandomReal", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "0.5"}], ",", "0.5"}], "}"}], "]"}]}], ",", 
                  RowBox[{"y", "+", 
                   RowBox[{"RandomReal", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "0.5"}], ",", "0.5"}], "}"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{"zMax", "/", "2"}], "+", 
                   RowBox[{"RandomReal", "[", 
                    RowBox[{"{", 
                    RowBox[{"5", ",", "15"}], "}"}], "]"}]}]}], "}"}], 
                "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"Round", "[", 
               RowBox[{"emberGrid", "[", 
                RowBox[{"[", 
                 RowBox[{"y", ",", "x"}], "]"}], "]"}], "]"}], "}"}]}], "]"}],
            ",", "Nothing"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"y", ",", "yMax"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "xMax"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Graphics3D", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Flatten", "[", "voxelData", "]"}], ",", 
          RowBox[{"Flatten", "[", "emberParticles", "]"}]}], "}"}], ",", 
        RowBox[{"Axes", "->", "True"}], ",", 
        RowBox[{"AxesLabel", "->", 
         RowBox[{"{", 
          RowBox[{"\"\<X\>\"", ",", "\"\<Y\>\"", ",", "\"\<Elevation\>\""}], 
          "}"}]}], ",", 
        RowBox[{"PlotLabel", "->", 
         RowBox[{"\"\<Fire Spread with Embers \>\"", "<>", "timeLabel"}]}], ",", 
        RowBox[{"ViewPoint", "->", 
         RowBox[{"{", 
          RowBox[{"2", ",", 
           RowBox[{"-", "2"}], ",", "1.5"}], "}"}]}], ",", 
        RowBox[{"Lighting", "->", "\"\<Neutral\>\""}], ",", 
        RowBox[{"ImageSize", "->", "Large"}]}], "]"}]}]}], "]"}]}], "\n", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Enhanced", " ", "surface", " ", "visualization", " ", "with", " ", 
    "ember", " ", "overlay"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"visualize3DFireSurfaceWithEmbers", "[", 
   RowBox[{
   "elevGrid_", ",", "fireGrid_", ",", "emberGrid_", ",", "terrainGrid_", ",", 
    RowBox[{"timeLabel_", ":", "\"\<\>\""}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"display", ",", "colorFun", ",", "emberOverlay"}], "}"}], ",", 
    RowBox[{"(*", 
     RowBox[{
     "Build", " ", "display", " ", "grid", " ", "combining", " ", "fire", " ",
       "and", " ", "terrain"}], "*)"}], 
    RowBox[{
     RowBox[{"display", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{"1", "<=", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "<=", "10"}], ",", 
          RowBox[{"20", "+", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "11"}], ",", "35", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"emberGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], ">", "0.5"}], "&&", 
           RowBox[{
            RowBox[{"fireGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "0"}]}], ",", 
          RowBox[{"40", "+", 
           RowBox[{"Min", "[", 
            RowBox[{"5", ",", 
             RowBox[{"Round", "[", 
              RowBox[{"emberGrid", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}]}], "]"}]}], ",", 
          "True", ",", 
          RowBox[{"terrainGrid", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "fireGrid", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Extended", " ", "color", " ", "function"}], "*)"}], 
     RowBox[{
      RowBox[{
       RowBox[{"colorFun", "[", "val_", "]"}], ":=", 
       RowBox[{"Which", "[", 
        RowBox[{
         RowBox[{"val", "==", "0"}], ",", "Nothing", ",", 
         RowBox[{"1", "<=", "val", "<=", "14"}], ",", 
         RowBox[{"$terrainLookup", "[", "val", "]"}], ",", 
         RowBox[{"20", "<=", "val", "<=", "30"}], ",", 
         RowBox[{"Blend", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Orange", ",", "Red"}], "}"}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"val", "-", "20"}], ")"}], "/", "10"}]}], "]"}], ",", 
         RowBox[{"val", "==", "35"}], ",", "Black", ",", 
         RowBox[{"40", "<=", "val", "<=", "45"}], ",", 
         RowBox[{"Blend", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Yellow", ",", "Orange"}], "}"}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"val", "-", "40"}], ")"}], "/", "5"}]}], "]"}], ",", 
         "True", ",", "Gray"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Create", " ", "surface", " ", "plot", " ", "with", " ", "overlay"}], 
       "*)"}], 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"ListPlot3D", "[", 
         RowBox[{"elevGrid", ",", 
          RowBox[{"ColorFunction", "->", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"colorFun", "@", 
              RowBox[{"display", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"Round", "[", "#2", "]"}], ",", 
                 RowBox[{"Round", "[", "#1", "]"}]}], "]"}], "]"}]}], "&"}], 
            ")"}]}], ",", 
          RowBox[{"ColorFunctionScaling", "->", "False"}], ",", 
          RowBox[{"Mesh", "->", "None"}], ",", 
          RowBox[{"PlotLabel", "->", 
           RowBox[{"\"\<Fire & Embers on Terrain \>\"", "<>", "timeLabel"}]}],
           ",", 
          RowBox[{"AxesLabel", "->", 
           RowBox[{"{", 
            RowBox[{"\"\<X\>\"", ",", "\"\<Y\>\"", ",", "\"\<Elevation\>\""}],
             "}"}]}], ",", 
          RowBox[{"ViewPoint", "->", 
           RowBox[{"{", 
            RowBox[{"2", ",", 
             RowBox[{"-", "2"}], ",", "1.5"}], "}"}]}], ",", 
          RowBox[{"PlotRange", "->", "All"}], ",", 
          RowBox[{"ImageSize", "->", "Large"}]}], "]"}], ",", 
        RowBox[{"(*", 
         RowBox[{
         "Add", " ", "ember", " ", "particle", " ", "cloud", " ", 
          "visualization"}], "*)"}], 
        RowBox[{"Graphics3D", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"emberGrid", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], ">", "1.0"}], ",", 
             RowBox[{"{", 
              RowBox[{"Orange", ",", 
               RowBox[{"PointSize", "[", "0.02", "]"}], ",", 
               RowBox[{"Opacity", "[", "0.7", "]"}], ",", 
               RowBox[{"Point", "[", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "i", ",", 
                  RowBox[{
                   RowBox[{"elevGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], "+", 
                   RowBox[{"RandomReal", "[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}]}]}], "}"}], "]"}]}],
               "}"}], ",", "Nothing"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "emberGrid", "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"emberGrid", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "]"}]}], "]"}]}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.960736793277609*^9}, {
   3.9608256334891243`*^9, 3.9608257464847717`*^9}, {3.960825811866663*^9, 
   3.9608258224095097`*^9}, {3.960825880602461*^9, 3.960825883797512*^9}, 
   3.960882703980961*^9, {3.961066165303526*^9, 3.9610661781692963`*^9}, {
   3.961066216831787*^9, 3.961066220117161*^9}, {3.9610664685935383`*^9, 
   3.96106648910433*^9}, {3.9611011553447685`*^9, 3.961101164699402*^9}, 
   3.9611012119572296`*^9, {3.961103323028406*^9, 3.961103329648525*^9}, 
   3.961103606535824*^9, {3.9611432678526917`*^9, 3.9611434307843475`*^9}, {
   3.961143484972645*^9, 3.9611434866016903`*^9}, 3.961166537662548*^9, {
   3.9623683737997036`*^9, 3.962368378468233*^9}, 3.962411188264433*^9, {
   3.964127178661503*^9, 3.9641271972784386`*^9}, 
   3.964127234499626*^9},ExpressionUUID->"b0cb43d2-9f5b-974d-a996-\
528c978c75ec"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Analysis", " ", "function", " ", "to", " ", "identify", " ", "spot", " ", 
    "fires"}], "*)"}], 
  RowBox[{
   RowBox[{"identifySpotFires", "[", 
    RowBox[{"fireHistory_", ",", "emberHistory_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"spotFires", "=", 
        RowBox[{"{", "}"}]}], ",", "newFires", ",", "previousFires", ",", 
       "emberSites", ",", "t"}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"t", ">", "1"}], ",", 
          RowBox[{
           RowBox[{"previousFires", "=", 
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"fireHistory", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"t", "-", "1"}], ",", "1", ",", "1"}], "]"}], "]"}], 
              ",", 
              RowBox[{"x_", "/;", 
               RowBox[{"x", ">", "0"}]}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"newFires", "=", 
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"fireHistory", "[", 
               RowBox[{"[", 
                RowBox[{"t", ",", "1", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"x_", "/;", 
               RowBox[{"1", "<=", "x", "<=", "10"}]}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"emberSites", "=", 
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"emberHistory", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"t", "-", "1"}], ",", "1", ",", "1"}], "]"}], "]"}], 
              ",", 
              RowBox[{"x_", "/;", 
               RowBox[{"x", ">", "0.5"}]}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Find", " ", "new", " ", "fires", " ", "that", " ", 
             RowBox[{"aren", "'"}], "t", " ", "adjacent", " ", "to", " ", 
             "previous", " ", "fires"}], "*)"}], 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"!", 
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"previousFires", ",", "fire"}], "]"}]}], "&&", 
                 RowBox[{
                  RowBox[{"MinimalBy", "[", 
                   RowBox[{"previousFires", ",", 
                    RowBox[{
                    RowBox[{"EuclideanDistance", "[", 
                    RowBox[{"#", ",", "fire"}], "]"}], "&"}]}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "//", 
                RowBox[{
                 RowBox[{
                  RowBox[{"EuclideanDistance", "[", 
                   RowBox[{"#", ",", "fire"}], "]"}], "&"}], ">", "1.5"}]}], ",", 
               RowBox[{"(*", 
                RowBox[{
                "This", " ", "is", " ", "likely", " ", "a", " ", "spot", " ", 
                 "fire"}], "*)"}], 
               RowBox[{"AppendTo", "[", 
                RowBox[{"spotFires", ",", 
                 RowBox[{"{", 
                  RowBox[{"t", ",", "fire"}], "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"fire", ",", "newFires"}], "}"}]}], "]"}], ";"}]}], 
         "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", "2", ",", 
          RowBox[{"Length", "[", "fireHistory", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "spotFires"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.960736793277609*^9}, {
   3.9608256334891243`*^9, 3.9608257464847717`*^9}, {3.960825811866663*^9, 
   3.9608258224095097`*^9}, {3.960825880602461*^9, 3.960825883797512*^9}, 
   3.960882703980961*^9, {3.961066165303526*^9, 3.9610661781692963`*^9}, {
   3.961066216831787*^9, 3.961066220117161*^9}, {3.9610664685935383`*^9, 
   3.96106648910433*^9}, {3.9611011553447685`*^9, 3.961101164699402*^9}, 
   3.9611012119572296`*^9, {3.961103323028406*^9, 3.961103329648525*^9}, 
   3.961103606535824*^9, {3.9611432678526917`*^9, 3.9611434307843475`*^9}, {
   3.961143484972645*^9, 3.9611434866016903`*^9}, 3.961166537662548*^9, {
   3.9623683737997036`*^9, 3.962368378468233*^9}, 3.962411188264433*^9, {
   3.964127178661503*^9, 3.9641271972784386`*^9}, {3.964127234499626*^9, 
   3.9641272380157566`*^9}},ExpressionUUID->"b84177c3-04a0-8d46-a817-\
dd2ab4a22c10"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"yap", " ", "=", " ", 
  RowBox[{"run3DFireSimulationWithEmbers", "[", "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.960736793277609*^9}, {
   3.9608256334891243`*^9, 3.9608257464847717`*^9}, {3.960825811866663*^9, 
   3.9608258224095097`*^9}, {3.960825880602461*^9, 3.960825883797512*^9}, 
   3.960882703980961*^9, {3.961066165303526*^9, 3.9610661781692963`*^9}, {
   3.961066216831787*^9, 3.961066220117161*^9}, {3.9610664685935383`*^9, 
   3.96106648910433*^9}, {3.9611011553447685`*^9, 3.961101164699402*^9}, 
   3.9611012119572296`*^9, {3.961103323028406*^9, 3.961103329648525*^9}, 
   3.961103606535824*^9, {3.9611432678526917`*^9, 3.9611434307843475`*^9}, {
   3.961143484972645*^9, 3.9611434866016903`*^9}, 3.961166537662548*^9, {
   3.9623683737997036`*^9, 3.962368378468233*^9}, 3.962411188264433*^9, {
   3.964127178661503*^9, 3.9641271972784386`*^9}, {3.964127234499626*^9, 
   3.9641272724099064`*^9}},
 CellLabel->
  "In[159]:=",ExpressionUUID->"3e0d5385-5418-f346-ad4b-d79403726512"],

Cell[BoxData[
 TemplateBox[{
  "GeoServer", "notauth", 
   "\"Unable to authenticate with Wolfram Cloud server. Please try \
authenticating again.\"", 2, 159, 14, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.9641272776126175`*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"665f45a3-bdc3-8b46-9f96-2ce31dbe9412"],

Cell[BoxData[
 TemplateBox[{
  "GeoImage", "urls", 
   "\"Cannot construct tile URLs for the given geo server.\"", 2, 159, 15, 
   29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.96412727770224*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"8d20b686-ff7f-814c-a07e-67b6d407c1b9"],

Cell[BoxData[
 TemplateBox[{
  "ImageResize", "imginv", 
   "\"Expecting an image or graphics instead of \\!\\(\\*RowBox[{\\\"GeoImage\
\\\", \\\"[\\\", RowBox[{RowBox[{\\\"GeoPosition\\\", \\\"[\\\", \
RowBox[{\\\"{\\\", RowBox[{\\\"53.54757348631631`\\\", \\\",\\\", \
RowBox[{\\\"-\\\", \\\"124.58935398113442`\\\"}]}], \\\"}\\\"}], \\\"]\\\"}], \
\\\",\\\", RowBox[{\\\"GeoRange\\\", \\\"\[Rule]\\\", \
TemplateBox[List[\\\"1.`\\\", \\\"\\\\\\\"km\\\\\\\"\\\", \\\"kilometers\\\", \
\\\"\\\\\\\"Kilometers\\\\\\\"\\\"], \\\"Quantity\\\", Rule[SyntaxForm, \
Mod]]}]}], \\\"]\\\"}]\\).\"", 2, 159, 16, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.964127277726572*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"95832a71-4e00-7747-b37f-7a7d4c878e8c"],

Cell[BoxData[
 TemplateBox[{
  "ImageData", "imginv", 
   "\"Expecting an image or graphics instead of \
\\!\\(\\*RowBox[{\\\"ImageResize\\\", \\\"[\\\", RowBox[{RowBox[{\\\"GeoImage\
\\\", \\\"[\\\", RowBox[{RowBox[{\\\"GeoPosition\\\", \\\"[\\\", \
RowBox[{\\\"{\\\", RowBox[{\\\"53.54757348631631`\\\", \\\",\\\", \
RowBox[{\\\"-\\\", \\\"124.58935398113442`\\\"}]}], \\\"}\\\"}], \\\"]\\\"}], \
\\\",\\\", RowBox[{\\\"GeoRange\\\", \\\"\[Rule]\\\", \
TemplateBox[List[\\\"1.`\\\", \\\"\\\\\\\"km\\\\\\\"\\\", \\\"kilometers\\\", \
\\\"\\\\\\\"Kilometers\\\\\\\"\\\"], \\\"Quantity\\\", Rule[SyntaxForm, \
Mod]]}]}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{\\\"40\\\", \
\\\",\\\", \\\"40\\\"}], \\\"}\\\"}]}], \\\"]\\\"}]\\).\"", 2, 159, 17, 
   29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.964127277750656*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"a1e51c0d-eff9-884a-a0d8-eb4518687954"],

Cell[BoxData[
 TemplateBox[{
  "Nearest", "neard", 
   "\"The default distance function does not give a real numeric distance \
when applied to the point pair \\!\\(\\*RowBox[{\\\"RGBColor\\\", \\\"[\\\", \
RowBox[{\\\"GeoImage\\\", \\\"[\\\", RowBox[{RowBox[{\\\"GeoPosition\\\", \
\\\"[\\\", RowBox[{\\\"{\\\", RowBox[{\\\"53.54757348631631`\\\", \\\",\\\", \
RowBox[{\\\"-\\\", \\\"124.58935398113442`\\\"}]}], \\\"}\\\"}], \\\"]\\\"}], \
\\\",\\\", RowBox[{\\\"GeoRange\\\", \\\"\[Rule]\\\", \
TemplateBox[List[\\\"1.`\\\", \\\"\\\\\\\"km\\\\\\\"\\\", \\\"kilometers\\\", \
\\\"\\\\\\\"Kilometers\\\\\\\"\\\"], \\\"Quantity\\\", Rule[SyntaxForm, \
Mod]]}]}], \\\"]\\\"}], \\\"]\\\"}]\\) and \
\\!\\(\\*TemplateBox[Association[Rule[\\\"color\\\", RGBColor[0.39`, 0.71`, \
0.34`]]], \\\"RGBColorSwatchTemplate\\\"]\\).\"", 2, 159, 18, 
   29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.964127277842203*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"f0b135d4-b236-5946-9f89-212564f96a88"],

Cell[BoxData[
 TemplateBox[{
  "Nearest", "neard", 
   "\"The default distance function does not give a real numeric distance \
when applied to the point pair \\!\\(\\*RowBox[{\\\"RGBColor\\\", \\\"[\\\", \
RowBox[{\\\"{\\\", RowBox[{\\\"40\\\", \\\",\\\", \\\"40\\\"}], \\\"}\\\"}], \
\\\"]\\\"}]\\) and \\!\\(\\*TemplateBox[Association[Rule[\\\"color\\\", \
RGBColor[0.39`, 0.71`, 0.34`]]], \\\"RGBColorSwatchTemplate\\\"]\\).\"", 2, 
   159, 19, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.9641272778612423`*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"44bee841-40b8-2649-8543-80de2723ba6a"],

Cell[BoxData[
 TemplateBox[{
  "Part", "partw", 
   "\"Part \\!\\(\\*RowBox[{\\\"3\\\"}]\\) of \
\\!\\(\\*RowBox[{\\\"ImageResize\\\", \\\"[\\\", RowBox[{RowBox[{\\\"GeoImage\
\\\", \\\"[\\\", RowBox[{RowBox[{\\\"GeoPosition\\\", \\\"[\\\", \
RowBox[{\\\"{\\\", RowBox[{\\\"53.54757348631631`\\\", \\\",\\\", \
RowBox[{\\\"-\\\", \\\"124.58935398113442`\\\"}]}], \\\"}\\\"}], \\\"]\\\"}], \
\\\",\\\", RowBox[{\\\"GeoRange\\\", \\\"\[Rule]\\\", \
TemplateBox[List[\\\"1.`\\\", \\\"\\\\\\\"km\\\\\\\"\\\", \\\"kilometers\\\", \
\\\"\\\\\\\"Kilometers\\\\\\\"\\\"], \\\"Quantity\\\", Rule[SyntaxForm, \
Mod]]}]}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{\\\"40\\\", \
\\\",\\\", \\\"40\\\"}], \\\"}\\\"}]}], \\\"]\\\"}]\\) does not exist.\"", 2, 
   159, 20, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.964127277875782*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"a91e4bb6-109e-604c-8fd4-9dde09aa386a"],

Cell[BoxData[
 TemplateBox[{
  "Nearest", "neard", 
   "\"The default distance function does not give a real numeric distance \
when applied to the point pair \\!\\(\\*RowBox[{\\\"RGBColor\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"ImageData\\\", \\\"[\\\", RowBox[{\\\"ImageResize\\\", \\\
\"[\\\", RowBox[{RowBox[{\\\"GeoImage\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"GeoPosition\\\", \\\"[\\\", RowBox[{\\\"{\\\", RowBox[{\\\
\"53.54757348631631`\\\", \\\",\\\", RowBox[{\\\"-\\\", \
\\\"124.58935398113442`\\\"}]}], \\\"}\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"GeoRange\\\", \\\"\[Rule]\\\", TemplateBox[List[\\\"1.`\\\", \\\"\
\\\\\\\"km\\\\\\\"\\\", \\\"kilometers\\\", \
\\\"\\\\\\\"Kilometers\\\\\\\"\\\"], \\\"Quantity\\\", Rule[SyntaxForm, \
Mod]]}]}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{\\\"40\\\", \
\\\",\\\", \\\"40\\\"}], \\\"}\\\"}]}], \\\"]\\\"}], \\\"]\\\"}], \\\"\
\[LeftDoubleBracket]\\\", RowBox[{\\\"1\\\", \\\",\\\", \\\"3\\\"}], \\\"\
\[RightDoubleBracket]\\\"}], \\\"]\\\"}]\\) and \
\\!\\(\\*TemplateBox[Association[Rule[\\\"color\\\", RGBColor[0.39`, 0.71`, \
0.34`]]], \\\"RGBColorSwatchTemplate\\\"]\\).\"", 2, 159, 21, 
   29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.9641272778933163`*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"fe046907-c6be-0248-8162-1fe7b7025048"],

Cell[BoxData[
 TemplateBox[{
  "General", "stop", 
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"Nearest\\\", \
\\\"::\\\", \\\"neard\\\"}], \\\"MessageName\\\"]\\) will be suppressed \
during this calculation.\"", 2, 159, 22, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.964127277946432*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"b19cfc5e-a010-3144-aa4b-c16ddd8954bf"],

Cell[BoxData[
 TemplateBox[{
  "Part", "partw", 
   "\"Part \\!\\(\\*RowBox[{\\\"4\\\"}]\\) of \
\\!\\(\\*RowBox[{\\\"ImageResize\\\", \\\"[\\\", RowBox[{RowBox[{\\\"GeoImage\
\\\", \\\"[\\\", RowBox[{RowBox[{\\\"GeoPosition\\\", \\\"[\\\", \
RowBox[{\\\"{\\\", RowBox[{\\\"53.54757348631631`\\\", \\\",\\\", \
RowBox[{\\\"-\\\", \\\"124.58935398113442`\\\"}]}], \\\"}\\\"}], \\\"]\\\"}], \
\\\",\\\", RowBox[{\\\"GeoRange\\\", \\\"\[Rule]\\\", \
TemplateBox[List[\\\"1.`\\\", \\\"\\\\\\\"km\\\\\\\"\\\", \\\"kilometers\\\", \
\\\"\\\\\\\"Kilometers\\\\\\\"\\\"], \\\"Quantity\\\", Rule[SyntaxForm, \
Mod]]}]}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{\\\"40\\\", \
\\\",\\\", \\\"40\\\"}], \\\"}\\\"}]}], \\\"]\\\"}]\\) does not exist.\"", 2, 
   159, 23, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.9641272779574585`*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"0ad071e2-e3dd-a04e-aeb5-975415a2a225"],

Cell[BoxData[
 TemplateBox[{
  "Part", "partw", 
   "\"Part \\!\\(\\*RowBox[{\\\"5\\\"}]\\) of \
\\!\\(\\*RowBox[{\\\"ImageResize\\\", \\\"[\\\", RowBox[{RowBox[{\\\"GeoImage\
\\\", \\\"[\\\", RowBox[{RowBox[{\\\"GeoPosition\\\", \\\"[\\\", \
RowBox[{\\\"{\\\", RowBox[{\\\"53.54757348631631`\\\", \\\",\\\", \
RowBox[{\\\"-\\\", \\\"124.58935398113442`\\\"}]}], \\\"}\\\"}], \\\"]\\\"}], \
\\\",\\\", RowBox[{\\\"GeoRange\\\", \\\"\[Rule]\\\", \
TemplateBox[List[\\\"1.`\\\", \\\"\\\\\\\"km\\\\\\\"\\\", \\\"kilometers\\\", \
\\\"\\\\\\\"Kilometers\\\\\\\"\\\"], \\\"Quantity\\\", Rule[SyntaxForm, \
Mod]]}]}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{\\\"40\\\", \
\\\",\\\", \\\"40\\\"}], \\\"}\\\"}]}], \\\"]\\\"}]\\) does not exist.\"", 2, 
   159, 24, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.964127277968973*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"b81fe5e7-ab92-c943-ace7-f23b0b439a1b"],

Cell[BoxData[
 TemplateBox[{
  "General", "stop", 
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"Part\\\", \\\"::\\\", \
\\\"partw\\\"}], \\\"MessageName\\\"]\\) will be suppressed during this \
calculation.\"", 2, 159, 25, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.964127277980509*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"6c3085e9-431a-1640-8602-f0223f288377"],

Cell[BoxData[
 TemplateBox[{
  "GeoServer", "styleres", "\"Cannot download vector style resources.\"", 2, 
   159, 26, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.964127278422077*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"dd78a8f8-cbcb-e34b-9574-7926f7f9e946"],

Cell[BoxData[
 TemplateBox[{
  "GeoElevationData", "etiles", 
   "\"Unable to download \\!\\(\\*RowBox[{\\\"12\\\"}]\\) tiles of geo \
elevation data.\"", 2, 159, 27, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.9641272790334473`*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"32610703-3f0a-5140-bd46-f745fe83d03a"],

Cell[BoxData[
 TemplateBox[{
  "ArrayResample", "noarr", 
   "\"\\!\\(\\*RowBox[{\\\"0\\\"}]\\) is not a regular array.\"", 2, 159, 28, 
   29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.964127279101372*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"fb88fc62-9964-4f43-a98a-0658a382e64e"],

Cell[BoxData[
 TemplateBox[{
  "Part", "partd", 
   "\"Part specification \\!\\(\\*RowBox[{\\\"1\\\", \\\"\[LeftDoubleBracket]\
\\\", RowBox[{\\\"1\\\", \\\",\\\", \\\"1\\\"}], \
\\\"\[RightDoubleBracket]\\\"}]\\) is longer than depth of object.\"", 2, 159,
    29, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.964127279168268*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"cb25fd5c-cc32-ea49-8a91-a422ae977f0e"],

Cell[BoxData[
 TemplateBox[{
  "Table", "iterb", 
   "\"Iterator \\!\\(\\*RowBox[{\\\"{\\\", RowBox[{\\\"h\\\", \\\",\\\", \
\\\"1\\\", \\\",\\\", RowBox[{\\\"Round\\\", \\\"[\\\", RowBox[{\\\"1\\\", \\\
\"\[LeftDoubleBracket]\\\", RowBox[{\\\"1\\\", \\\",\\\", \\\"1\\\"}], \\\"\
\[RightDoubleBracket]\\\"}], \\\"]\\\"}]}], \\\"}\\\"}]\\) does not have \
appropriate bounds.\"", 2, 159, 30, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.9641272793407116`*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"796c1383-6f49-734b-a7cb-750521100327"],

Cell[BoxData[
 TemplateBox[{
  "Table", "iterb", 
   "\"Iterator \\!\\(\\*RowBox[{\\\"{\\\", RowBox[{\\\"h\\\", \\\",\\\", \
\\\"1\\\", \\\",\\\", RowBox[{\\\"Round\\\", \\\"[\\\", RowBox[{\\\"1\\\", \\\
\"\[LeftDoubleBracket]\\\", RowBox[{\\\"1\\\", \\\",\\\", \\\"1\\\"}], \\\"\
\[RightDoubleBracket]\\\"}], \\\"]\\\"}]}], \\\"}\\\"}]\\) does not have \
appropriate bounds.\"", 2, 159, 31, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.9641272793657455`*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"66d58698-bc14-764a-919e-836000969660"],

Cell[BoxData[
 TemplateBox[{
  "Part", "partd", 
   "\"Part specification \\!\\(\\*RowBox[{\\\"1\\\", \\\"\[LeftDoubleBracket]\
\\\", RowBox[{\\\"1\\\", \\\",\\\", \\\"2\\\"}], \
\\\"\[RightDoubleBracket]\\\"}]\\) is longer than depth of object.\"", 2, 159,
    32, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.964127279388302*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"94a7e5c2-b688-fc42-b053-a55d2102bee9"],

Cell[BoxData[
 TemplateBox[{
  "Table", "iterb", 
   "\"Iterator \\!\\(\\*RowBox[{\\\"{\\\", RowBox[{\\\"h\\\", \\\",\\\", \
\\\"1\\\", \\\",\\\", RowBox[{\\\"Round\\\", \\\"[\\\", RowBox[{\\\"1\\\", \\\
\"\[LeftDoubleBracket]\\\", RowBox[{\\\"1\\\", \\\",\\\", \\\"2\\\"}], \\\"\
\[RightDoubleBracket]\\\"}], \\\"]\\\"}]}], \\\"}\\\"}]\\) does not have \
appropriate bounds.\"", 2, 159, 33, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.964127279412998*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"39382294-cf65-ae4a-adef-1aab9fc0f863"],

Cell[BoxData[
 TemplateBox[{
  "General", "stop", 
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"Table\\\", \\\"::\\\", \
\\\"iterb\\\"}], \\\"MessageName\\\"]\\) will be suppressed during this \
calculation.\"", 2, 159, 34, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.964127279439562*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"0af32ad9-3d92-e046-94b0-e08e4d4bee30"],

Cell[BoxData[
 TemplateBox[{
  "Part", "partd", 
   "\"Part specification \\!\\(\\*RowBox[{\\\"1\\\", \\\"\[LeftDoubleBracket]\
\\\", RowBox[{\\\"1\\\", \\\",\\\", \\\"3\\\"}], \
\\\"\[RightDoubleBracket]\\\"}]\\) is longer than depth of object.\"", 2, 159,
    35, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.964127279459608*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"46643281-eaf6-434f-91ce-1f3aaae45bc1"],

Cell[BoxData[
 TemplateBox[{
  "General", "stop", 
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"Part\\\", \\\"::\\\", \
\\\"partd\\\"}], \\\"MessageName\\\"]\\) will be suppressed during this \
calculation.\"", 2, 159, 36, 29974286065833443463, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.9641272794766445`*^9},
 CellLabel->
  "During evaluation of \
In[159]:=",ExpressionUUID->"6da4955f-1eef-4041-98fa-c3a258cc5e7f"],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{3.9641273418541584`*^9},
 CellLabel->
  "Out[159]=",ExpressionUUID->"3b701301-12f6-d84c-ab45-aeb38f039d1a"]
}, Open  ]]
},
WindowSize->{960, 568},
WindowMargins->{{-5.5, Automatic}, {Automatic, -5.5}},
Magnification:>0.6 Inherited,
FrontEndVersion->"14.2 for Microsoft Windows (64-bit) (March 14, 2025)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"bc151290-28ca-9f4d-81e8-845c8d232426"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[554, 20, 4709, 108, 96, "Input",ExpressionUUID->"ec872261-498c-8745-a3f8-cb83eb805c15"],
Cell[5266, 130, 1208, 33, 19, "Input",ExpressionUUID->"3096bf60-9e56-cd40-b74c-b96ccafc3a04"],
Cell[6477, 165, 7896, 227, 131, "Input",ExpressionUUID->"e7078143-e7d5-0c4b-9ecd-4fd8e55d41ab"],
Cell[14376, 394, 1431, 28, 62, "Input",ExpressionUUID->"5c708908-e4dd-a040-bb40-0a18c6c525a0"],
Cell[15810, 424, 886, 25, 19, "Input",ExpressionUUID->"e2fd2e29-d6ab-3b42-99f1-4e629672631d"],
Cell[16699, 451, 1555, 42, 51, "Input",ExpressionUUID->"707ae6fe-563c-744a-89d5-7463c13bcb30"],
Cell[18257, 495, 1852, 48, 62, "Input",ExpressionUUID->"ec1eceb4-c53f-5c46-a622-04f53923f1eb"],
Cell[20112, 545, 2316, 51, 74, "Input",ExpressionUUID->"7acbf94e-f5b9-4749-9b68-60bc17f9e244"],
Cell[22431, 598, 3465, 82, 119, "Input",ExpressionUUID->"db6a00bb-150a-4946-b664-4f0d96327d47"],
Cell[25899, 682, 3224, 69, 176, "Input",ExpressionUUID->"8dbef89e-d692-6f49-b071-d7d38c73c568"],
Cell[29126, 753, 6210, 131, 188, "Input",ExpressionUUID->"8ecbfd1b-0aa8-3940-9388-fa3a3005ad16"],
Cell[35339, 886, 1824, 42, 51, "Input",ExpressionUUID->"b5fa2306-2b5b-df40-a334-11a80f71b061"],
Cell[37166, 930, 11772, 263, 313, "Input",ExpressionUUID->"02f9d060-2b92-3645-928e-2c404b6a5751"],
Cell[48941, 1195, 2955, 61, 85, "Input",ExpressionUUID->"ae2d832c-59aa-014d-a0a1-132ab3c0d118"],
Cell[51899, 1258, 1044, 19, 28, "Input",ExpressionUUID->"d87f1353-4342-de40-9863-ebf7a79690d3"],
Cell[52946, 1279, 2549, 60, 51, "Input",ExpressionUUID->"2ea035cc-b2d6-3749-93c6-fcd8fadf2038"],
Cell[55498, 1341, 1919, 44, 62, "Input",ExpressionUUID->"1e55fdb2-fd20-894b-97ad-c9b4ab13f4b6"],
Cell[57420, 1387, 1189, 26, 39, "Input",ExpressionUUID->"2283654e-e278-d946-a977-15c2ee13fbd4"],
Cell[58612, 1415, 1497, 33, 39, "Input",ExpressionUUID->"8e222a23-4365-a841-8c5c-7478fc5ec5a0"],
Cell[60112, 1450, 2265, 54, 51, "Input",ExpressionUUID->"223bbd27-b475-324a-a29b-cfddc3b2d168"],
Cell[62380, 1506, 3039, 73, 85, "Input",ExpressionUUID->"3d57b8e4-f5fe-db43-adf7-8b5e633c5dfd"],
Cell[65422, 1581, 1061, 19, 19, "Input",ExpressionUUID->"a979d1d7-5bcf-d746-911c-be8b98ed540b"],
Cell[66486, 1602, 11457, 261, 256, "Input",ExpressionUUID->"1fcc9f02-132b-3f42-9c86-354d15febb11"],
Cell[77946, 1865, 4958, 115, 131, "Input",ExpressionUUID->"7540be41-7e27-2343-974c-efb6768d1272"],
Cell[CellGroupData[{
Cell[82929, 1984, 12918, 287, 359, "Input",ExpressionUUID->"f97df745-1b35-0645-8e96-b5d659be6eb4"],
Cell[95850, 2273, 4210, 61, 37, "Message",ExpressionUUID->"9557876c-88e1-ff43-a57f-df32c6139751"],
Cell[100063, 2336, 4212, 61, 37, "Message",ExpressionUUID->"8ea980ce-2fec-4443-a9ef-47897437a661"]
}, Open  ]],
Cell[104290, 2400, 1538, 27, 39, "Input",ExpressionUUID->"bcf4bdbd-b468-654a-ba10-ede5f21afbc8"],
Cell[105831, 2429, 3928, 86, 119, "Input",ExpressionUUID->"372c6aae-98f9-5a47-9cd8-f9171e99d78b"],
Cell[109762, 2517, 1829, 39, 28, "Input",ExpressionUUID->"6fe474f9-8575-ff44-ad90-69e7bff27625"],
Cell[111594, 2558, 5492, 134, 108, "Input",ExpressionUUID->"27325b19-05f6-354c-8d92-805d2a3b5872"],
Cell[CellGroupData[{
Cell[117111, 2696, 20896, 477, 621, "Input",ExpressionUUID->"00849b26-e4fd-de48-afbd-c956f56704ab"],
Cell[138010, 3175, 3281, 48, 37, "Message",ExpressionUUID->"ed10b3eb-ed2c-2b46-a421-139f8ff82e51"],
Cell[141294, 3225, 3279, 48, 37, "Message",ExpressionUUID->"18445eba-bb37-5d42-a58c-360984024879"]
}, Open  ]],
Cell[144588, 3276, 9180, 202, 302, "Input",ExpressionUUID->"82b378e4-c56b-3240-8d52-fab3409fe3ef"],
Cell[153771, 3480, 2567, 53, 85, "Input",ExpressionUUID->"4f35160a-8b1b-9842-b5b6-2a7819b9855b"],
Cell[156341, 3535, 3100, 72, 119, "Input",ExpressionUUID->"94af12e1-668e-b94a-b7dd-e83100516dfc"],
Cell[159444, 3609, 4099, 97, 85, "Input",ExpressionUUID->"20b72586-cbf3-c144-ab2a-8053ef8513e1"],
Cell[163546, 3708, 3667, 96, 74, "Input",ExpressionUUID->"138397f7-fbf8-ce4b-bac7-04126219fe5b"],
Cell[167216, 3806, 4746, 128, 85, "Input",ExpressionUUID->"c1874823-8383-ed4b-acb7-52f574b48420"],
Cell[171965, 3936, 4496, 92, 119, "Input",ExpressionUUID->"47e5a163-51ff-354d-8bbd-484bef6741a0"],
Cell[176464, 4030, 3198, 65, 108, "Input",ExpressionUUID->"1b0cc37a-d65a-ec49-ad10-6316e1f26fc7"],
Cell[179665, 4097, 12389, 281, 325, "Input",ExpressionUUID->"0b518be7-fd2c-f046-99b8-0818d2086fb3"],
Cell[192057, 4380, 10531, 256, 211, "Input",ExpressionUUID->"10c034e5-3abc-e34a-ad04-dd32261cbf3d"],
Cell[202591, 4638, 2689, 55, 96, "Input",ExpressionUUID->"8120ab07-66b0-c442-92fe-cf8e1247ab77"],
Cell[205283, 4695, 2301, 48, 96, "Input",ExpressionUUID->"3df064f5-061b-7347-b7d9-15358d146cec"],
Cell[207587, 4745, 32479, 780, 873, "Input",ExpressionUUID->"b0cb43d2-9f5b-974d-a996-528c978c75ec"],
Cell[240069, 5527, 4552, 105, 96, "Input",ExpressionUUID->"b84177c3-04a0-8d46-a817-dd2ab4a22c10"],
Cell[CellGroupData[{
Cell[244646, 5636, 1040, 16, 19, "Input",ExpressionUUID->"3e0d5385-5418-f346-ad4b-d79403726512"],
Cell[245689, 5654, 398, 10, 16, "Message",ExpressionUUID->"665f45a3-bdc3-8b46-9f96-2ce31dbe9412"],
Cell[246090, 5666, 363, 10, 16, "Message",ExpressionUUID->"8d20b686-ff7f-814c-a07e-67b6d407c1b9"],
Cell[246456, 5678, 837, 16, 16, "Message",ExpressionUUID->"95832a71-4e00-7747-b37f-7a7d4c878e8c"],
Cell[247296, 5696, 994, 19, 16, "Message",ExpressionUUID->"a1e51c0d-eff9-884a-a0d8-eb4518687954"],
Cell[248293, 5717, 1074, 20, 16, "Message",ExpressionUUID->"f0b135d4-b236-5946-9f89-212564f96a88"],
Cell[249370, 5739, 684, 14, 16, "Message",ExpressionUUID->"44bee841-40b8-2649-8543-80de2723ba6a"],
Cell[250057, 5755, 1001, 19, 16, "Message",ExpressionUUID->"a91e4bb6-109e-604c-8fd4-9dde09aa386a"],
Cell[251061, 5776, 1402, 25, 16, "Message",ExpressionUUID->"fe046907-c6be-0248-8162-1fe7b7025048"],
Cell[252466, 5803, 468, 11, 16, "Message",ExpressionUUID->"b19cfc5e-a010-3144-aa4b-c16ddd8954bf"],
Cell[252937, 5816, 1003, 19, 16, "Message",ExpressionUUID->"0ad071e2-e3dd-a04e-aeb5-975415a2a225"],
Cell[253943, 5837, 1001, 19, 16, "Message",ExpressionUUID->"b81fe5e7-ab92-c943-ace7-f23b0b439a1b"],
Cell[254947, 5858, 465, 11, 16, "Message",ExpressionUUID->"6c3085e9-431a-1640-8602-f0223f288377"],
Cell[255415, 5871, 352, 9, 16, "Message",ExpressionUUID->"dd78a8f8-cbcb-e34b-9574-7926f7f9e946"],
Cell[255770, 5882, 402, 10, 16, "Message",ExpressionUUID->"32610703-3f0a-5140-bd46-f745fe83d03a"],
Cell[256175, 5894, 373, 10, 16, "Message",ExpressionUUID->"fb88fc62-9964-4f43-a98a-0658a382e64e"],
Cell[256551, 5906, 499, 12, 16, "Message",ExpressionUUID->"cb25fd5c-cc32-ea49-8a91-a422ae977f0e"],
Cell[257053, 5920, 627, 13, 16, "Message",ExpressionUUID->"796c1383-6f49-734b-a7cb-750521100327"],
Cell[257683, 5935, 627, 13, 16, "Message",ExpressionUUID->"66d58698-bc14-764a-919e-836000969660"],
Cell[258313, 5950, 499, 12, 16, "Message",ExpressionUUID->"94a7e5c2-b688-fc42-b053-a55d2102bee9"],
Cell[258815, 5964, 625, 13, 16, "Message",ExpressionUUID->"39382294-cf65-ae4a-adef-1aab9fc0f863"],
Cell[259443, 5979, 466, 11, 16, "Message",ExpressionUUID->"0af32ad9-3d92-e046-94b0-e08e4d4bee30"],
Cell[259912, 5992, 499, 12, 16, "Message",ExpressionUUID->"46643281-eaf6-434f-91ce-1f3aaae45bc1"],
Cell[260414, 6006, 467, 11, 16, "Message",ExpressionUUID->"6da4955f-1eef-4041-98fa-c3a258cc5e7f"],
Cell[260884, 6019, 162, 3, 30, "Output",ExpressionUUID->"3b701301-12f6-d84c-ab45-aeb38f039d1a"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)

