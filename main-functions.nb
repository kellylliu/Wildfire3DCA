(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Wolfram 14.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       154,          7]
NotebookDataLength[    158385,       3648]
NotebookOptionsPosition[    154535,       3596]
NotebookOutlinePosition[    154957,       3613]
CellTagsIndexPosition[    154914,       3610]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$patchTypes", "=", 
    RowBox[{"<|", 
     RowBox[{
      RowBox[{"0", "->", "\"\<Empty/Burned\>\""}], ",", 
      RowBox[{"1", "->", "\"\<Grass\>\""}], ",", 
      RowBox[{"2", "->", "\"\<Sand\>\""}], ",", 
      RowBox[{"3", "->", "\"\<Rock/Concrete\>\""}], ",", 
      RowBox[{"4", "->", "\"\<Forest\>\""}], ",", 
      RowBox[{"5", "->", "\"\<Swamp\>\""}], ",", 
      RowBox[{"6", "->", "\"\<Lakes/Rivers\>\""}], ",", 
      RowBox[{"7", "->", "\"\<Clay\>\""}], ",", 
      RowBox[{"8", "->", "\"\<Dry grass\>\""}], ",", 
      RowBox[{"9", "->", "\"\<Shrubland\>\""}], ",", 
      RowBox[{"10", "->", "\"\<Agricultural crops\>\""}], ",", 
      RowBox[{"11", "->", "\"\<Urban area\>\""}], ",", 
      RowBox[{"12", "->", "\"\<Road\>\""}], ",", 
      RowBox[{"13", "->", "\"\<Snow/Ice\>\""}], ",", 
      RowBox[{"14", "->", "\"\<Burned soil\>\""}]}], "|>"}]}], ";"}], "  ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"old", " ", "fire", " ", "scar"}], ",", 
    RowBox[{
     RowBox[{"not", " ", "the", " ", "live"}], "-", 
     RowBox[{"burn", " ", "state"}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"$terrainLookup", "=", 
    RowBox[{"<|", 
     RowBox[{
      RowBox[{"0", "->", "Black"}], ",", 
      RowBox[{"1", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.39", ",", "0.71", ",", "0.34"}], "]"}]}], ",", 
      RowBox[{"(*", "grass", "*)"}], 
      RowBox[{"2", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.93", ",", "0.79", ",", "0.69"}], "]"}]}], ",", 
      RowBox[{"(*", "sand", "*)"}], 
      RowBox[{"3", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.60", ",", "0.60", ",", "0.60"}], "]"}]}], ",", 
      RowBox[{"(*", 
       RowBox[{"rock", "/", "concrete"}], "*)"}], 
      RowBox[{"4", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.13", ",", "0.55", ",", "0.13"}], "]"}]}], ",", 
      RowBox[{"(*", "forest", "*)"}], 
      RowBox[{"5", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.31", ",", "0.46", ",", "0.33"}], "]"}]}], ",", 
      RowBox[{"(*", "swamp", "*)"}], 
      RowBox[{"6", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.00", ",", "0.55", ",", "0.85"}], "]"}]}], ",", 
      RowBox[{"(*", "water", "*)"}], 
      RowBox[{"7", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.80", ",", "0.45", ",", "0.34"}], "]"}]}], ",", 
      RowBox[{"(*", "clay", "*)"}], 
      RowBox[{"8", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.85", ",", "0.70", ",", "0.30"}], "]"}]}], ",", 
      RowBox[{"(*", 
       RowBox[{"dry", " ", "grass"}], "*)"}], 
      RowBox[{"9", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.42", ",", "0.55", ",", "0.16"}], "]"}]}], ",", 
      RowBox[{"(*", "shrubland", "*)"}], 
      RowBox[{"10", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.80", ",", "0.72", ",", "0.48"}], "]"}]}], ",", 
      RowBox[{"(*", "crops", "*)"}], 
      RowBox[{"11", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.70", ",", "0.70", ",", "0.70"}], "]"}]}], ",", 
      RowBox[{"(*", "urban", "*)"}], 
      RowBox[{"12", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.30", ",", "0.30", ",", "0.30"}], "]"}]}], ",", 
      RowBox[{"(*", "road", "*)"}], 
      RowBox[{"13", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.95", ",", "0.95", ",", "0.95"}], "]"}]}], ",", 
      RowBox[{"(*", 
       RowBox[{"snow", "/", "ice"}], "*)"}], 
      RowBox[{"14", "->", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0.20", ",", "0.20", ",", "0.20"}], "]"}]}]}], "           ", 
     
     RowBox[{"(*", 
      RowBox[{"old", " ", "burn", " ", "scar"}], "*)"}], "|>"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$terrainColorRules", "=", 
   RowBox[{"Normal", "[", "$terrainLookup", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.9607312972333164`*^9, 3.9607313129091167`*^9}, {
   3.960731353996256*^9, 3.9607313564877243`*^9}, {3.96073140213863*^9, 
   3.9607314167015686`*^9}, {3.9607321818480606`*^9, 
   3.9607322350213394`*^9}, {3.960732298035309*^9, 3.9607323184353733`*^9}, {
   3.960732396009285*^9, 3.9607324027871494`*^9}, {3.960733382536829*^9, 
   3.9607334200994473`*^9}, {3.960881490300865*^9, 3.9608814966926174`*^9}, {
   3.960972173230324*^9, 3.960972199275589*^9}, {3.961024934371357*^9, 
   3.9610249414439926`*^9}, 3.9610251115021324`*^9, {3.9610649465948296`*^9, 
   3.961064950341486*^9}, {3.961161153352501*^9, 3.9611611810871735`*^9}, 
   3.9611617329997463`*^9, 3.96325091309204*^9, 3.963250949453389*^9},
 CellLabel->"In[85]:=",ExpressionUUID->"768da140-46fd-fc4d-b7f7-0aa72e58ae79"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$firePlotColorRules", "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"KeyDrop", "[", 
      RowBox[{"$terrainColorRules", ",", "0"}], "]"}], ",", 
     RowBox[{"(*", "terrain", "*)"}], 
     RowBox[{"AssociationThread", "[", 
      RowBox[{
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"20", ",", "30"}], "]"}], ",", 
         RowBox[{"{", "35", "}"}]}], "]"}], "->", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Blend", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Orange", ",", "Red"}], "}"}], ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"k", "-", "20"}], ")"}], "/", "10"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"k", ",", "20", ",", "30"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", "Black", "}"}]}], "]"}]}], "]"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.963250992426346*^9, 3.963250992429545*^9}, 
   3.963251212343421*^9, 3.963314236831297*^9},
 CellLabel->"In[88]:=",ExpressionUUID->"38863809-cbbb-476e-bfa9-9f8a470bb97f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getRandomEarthLocation", "[", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "continentalBoxes", ",", " ", "continentNames", ",", "selectedBox", ",", 
      " ", "lat", ",", "lon"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"continentalBoxes", "=", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"15", ",", "30"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "5"}], ",", "15"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"5", ",", "15"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "10"}], ",", "25"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"15", ",", "35"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "30"}], ",", 
            RowBox[{"-", "20"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"20", ",", "30"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"35", ",", "45"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "115"}], ",", 
            RowBox[{"-", "95"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"40", ",", "48"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "100"}], ",", 
            RowBox[{"-", "75"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"25", ",", "30"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "110"}], ",", 
            RowBox[{"-", "95"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"50", ",", "58"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "130"}], ",", 
            RowBox[{"-", "115"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "15"}], ",", 
            RowBox[{"-", "5"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "70"}], ",", 
            RowBox[{"-", "55"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "25"}], ",", 
            RowBox[{"-", "15"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "60"}], ",", 
            RowBox[{"-", "48"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "35"}], ",", 
            RowBox[{"-", "25"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "70"}], ",", 
            RowBox[{"-", "60"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"45", ",", "52"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "5"}], ",", "10"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"48", ",", "55"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"10", ",", "25"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"40", ",", "45"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "5"}], ",", "5"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"55", ",", "60"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"10", ",", "25"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"30", ",", "40"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"70", ",", "85"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"35", ",", "45"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"50", ",", "65"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"20", ",", "35"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"95", ",", "110"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"30", ",", "40"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"110", ",", "120"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"45", ",", "55"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"85", ",", "115"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"35", ",", "40"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"125", ",", "130"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "35"}], ",", 
            RowBox[{"-", "25"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"135", ",", "145"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "25"}], ",", 
            RowBox[{"-", "15"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"130", ",", "140"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "35"}], ",", 
            RowBox[{"-", "30"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"115", ",", "120"}], "}"}]}], "}"}]}], " ", "}"}]}], ";", 
     "\n", 
     RowBox[{"selectedBox", "=", 
      RowBox[{"RandomChoice", "[", "continentalBoxes", "]"}]}], ";", "\n", 
     RowBox[{"lat", "=", 
      RowBox[{"RandomReal", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"selectedBox", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"selectedBox", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "}"}], "]"}]}], ";", "\n", 
     RowBox[{"lon", "=", 
      RowBox[{"RandomReal", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"selectedBox", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"selectedBox", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "}"}], "]"}]}], ";", "\n", 
     RowBox[{"{", 
      RowBox[{"lat", ",", "lon"}], "}"}]}]}], "\n", "]"}]}]], "Input",
 CellChangeTimes->{{3.9607312972333164`*^9, 3.9607313129091167`*^9}, {
   3.960731353996256*^9, 3.9607313564877243`*^9}, {3.96073140213863*^9, 
   3.9607314167015686`*^9}, {3.9607321818480606`*^9, 
   3.9607322350213394`*^9}, {3.960732298035309*^9, 3.9607323184353733`*^9}, {
   3.960732396009285*^9, 3.960732416705759*^9}, {3.9608813134197807`*^9, 
   3.9608813184413586`*^9}, {3.9609763131541862`*^9, 
   3.9609764146850758`*^9}, {3.9610250074793015`*^9, 3.961025116894905*^9}, 
   3.961054587180338*^9, {3.961054621733692*^9, 3.9610546232368984`*^9}, 
   3.961055412356045*^9, 3.9611614093744183`*^9, {3.9611617387078342`*^9, 
   3.961161810822857*^9}, {3.961163262198103*^9, 3.9611632648128586`*^9}, 
   3.963314240316221*^9},
 CellLabel->"In[89]:=",ExpressionUUID->"0666a3dd-7178-704d-b657-fc28c92475a3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"calculateGeoRange", "[", 
    RowBox[{"rangeKM", ":", " ", "1.0"}], "]"}], " ", ":=", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"range", "=", 
      RowBox[{"gridSize", "*", "0.01"}]}], ";"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Quantity", "[", 
    RowBox[{"rangeKM", ",", " ", "\"\<Kilometers\>\""}], "]"}]}], 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.9607312972333164`*^9, 3.9607313129091167`*^9}, {
   3.960731353996256*^9, 3.9607313564877243`*^9}, {3.96073140213863*^9, 
   3.9607314167015686`*^9}, {3.9607321818480606`*^9, 
   3.9607322350213394`*^9}, {3.960732298035309*^9, 3.9607323184353733`*^9}, {
   3.960732396009285*^9, 3.960732416705759*^9}, {3.9608813134197807`*^9, 
   3.9608813184413586`*^9}, {3.9609763131541862`*^9, 
   3.9609764146850758`*^9}, {3.9610250074793015`*^9, 3.961025116894905*^9}, 
   3.961054587180338*^9, {3.961054621733692*^9, 3.9610546221468487`*^9}, 
   3.961055465134651*^9, {3.9610556246698112`*^9, 3.961055628388954*^9}, 
   3.9611614272838783`*^9, {3.9611618146794815`*^9, 3.9611618177373314`*^9}, {
   3.9623622250750504`*^9, 3.962362275617817*^9}, {3.962365296266522*^9, 
   3.9623652975291843`*^9}, {3.9623653606618547`*^9, 3.9623653651459303`*^9}, 
   3.962365410840514*^9},
 CellLabel->"In[90]:=",ExpressionUUID->"d87ea8f4-d142-5048-bc62-77f02a01d10c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"build", " ", "once"}], "\[Dash]", "rules", ",", 
    RowBox[{"NOT", " ", "an", " ", "Association"}]}], "*)"}], 
  RowBox[{
   RowBox[{"nearestRules", "=", 
    RowBox[{"Thread", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Values", "[", "$terrainLookup", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ";;"}], "]"}], "]"}], "   ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"skip", " ", "code"}], "-", 
        RowBox[{"0", " ", "black"}]}], "*)"}], "->", 
      RowBox[{"Range", "[", 
       RowBox[{"1", ",", 
        RowBox[{
         RowBox[{"Length", "[", "$terrainLookup", "]"}], "-", "1"}]}], 
       "]"}]}], "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.9632511600668163`*^9, 3.963251161270218*^9}},
 CellLabel->"In[91]:=",ExpressionUUID->"a4b8d42e-0feb-4466-8d8c-c31d4e2e7047"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"assignTerrain", "[", 
    RowBox[{"location_", ",", "gridSize_", ",", 
     RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"range", ",", "imgRGB"}], "}"}], ",", 
     RowBox[{
      RowBox[{"range", "=", 
       RowBox[{"Quantity", "[", 
        RowBox[{"rangeKM", ",", "\"\<Kilometers\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"imgRGB", "=", 
       RowBox[{"ImageData", "@", 
        RowBox[{"ImageResize", "[", 
         RowBox[{
          RowBox[{"GeoImage", "[", 
           RowBox[{
            RowBox[{"GeoPosition", "[", "location", "]"}], ",", 
            RowBox[{"GeoRange", "->", "range"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"gridSize", ",", "gridSize"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"First", "@", 
         RowBox[{"Nearest", "[", 
          RowBox[{"nearestRules", ",", 
           RowBox[{"RGBColor", "@", 
            RowBox[{"imgRGB", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "gridSize"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "gridSize"}], "}"}]}], "]"}]}]}], "]"}]}], 
  "\n"}]], "Input",
 CellChangeTimes->{{3.963251178157927*^9, 3.963251182671644*^9}},
 CellLabel->"In[92]:=",ExpressionUUID->"d76a9bca-33ec-420d-b24b-3b4c2dd62d59"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getRealElevationData", "[", 
   RowBox[{"location_", ",", "gridSize_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "elevData", ",", "range", ",", "normalizedElev", ",", "resampled"}], 
     "}"}], ",", 
    RowBox[{
     RowBox[{"range", "=", 
      RowBox[{"gridSize", "*", "0.01"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"elevData", "=", 
      RowBox[{"QuantityMagnitude", "[", 
       RowBox[{"GeoElevationData", "[", 
        RowBox[{"GeoRange", "->", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"GeoPosition", "[", 
            RowBox[{"location", "-", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"range", ",", "range"}], "}"}], "/", "2"}]}], "]"}], ",", 
           RowBox[{"GeoPosition", "[", 
            RowBox[{"location", "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"range", ",", "range"}], "}"}], "/", "2"}]}], "]"}]}], 
          "}"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"normalizedElev", "=", 
      RowBox[{"Rescale", "[", 
       RowBox[{"elevData", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Min", "[", "elevData", "]"}], ",", 
          RowBox[{"Max", "[", "elevData", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"resampled", "=", 
      RowBox[{"ArrayResample", "[", 
       RowBox[{"normalizedElev", ",", 
        RowBox[{"{", 
         RowBox[{"gridSize", ",", "gridSize"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "resampled"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.962389536642228*^9, 3.962389536644046*^9}},
 CellLabel->"In[93]:=",ExpressionUUID->"cffd2813-845a-40f2-b83c-dd67e18b914f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mapTerrainValues", "[", 
   RowBox[{"gridSize_", ",", 
    RowBox[{"location_", ":", "Automatic"}], ",", " ", 
    RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "terrainAndElev", ",", "terrainGrid", ",", "elevationHeights", ",", 
      "newArray"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"terrainAndElev", "=", 
      RowBox[{"initializeTerrainGrid", "[", 
       RowBox[{"gridSize", ",", "location", ",", " ", "rangeKM"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"terrainGrid", "=", 
      RowBox[{"terrainAndElev", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"elevationHeights", "=", 
      RowBox[{"terrainAndElev", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"newArray", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"elevationHeights", "[", 
           RowBox[{"[", 
            RowBox[{"x", ",", "y"}], "]"}], "]"}], ",", 
          RowBox[{"terrainGrid", "[", 
           RowBox[{"[", 
            RowBox[{"x", ",", "y"}], "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "gridSize"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "gridSize"}], "}"}]}], "]"}]}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.9607312972333164`*^9, 3.9607313129091167`*^9}, {
   3.960731353996256*^9, 3.9607313564877243`*^9}, {3.96073140213863*^9, 
   3.9607314167015686`*^9}, {3.9607321818480606`*^9, 
   3.9607322350213394`*^9}, {3.960732298035309*^9, 3.9607323184353733`*^9}, {
   3.960732396009285*^9, 3.960732416705759*^9}, {3.9608813134197807`*^9, 
   3.9608813184413586`*^9}, {3.9609763131541862`*^9, 3.9609764543840504`*^9}, 
   3.9609765106269207`*^9, {3.961025160876356*^9, 3.9610251741719456`*^9}, 
   3.9610545939473534`*^9, 3.9611614212568607`*^9, {3.961161897657299*^9, 
   3.961161904513279*^9}, {3.961164841789873*^9, 3.9611648434981194`*^9}, {
   3.9623682141937466`*^9, 3.9623682494116974`*^9}, {3.96236858811434*^9, 
   3.9623685963667927`*^9}},
 CellLabel->"In[94]:=",ExpressionUUID->"7187de4f-acf5-c241-8ca3-53da990091ff"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"identifyWater", "[", 
    RowBox[{"loc_", ",", "n_", ",", "rangeKM_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"waterColor", "=", 
        RowBox[{"RGBColor", "[", 
         RowBox[{"0.6", ",", ".8078", ",", "1"}], "]"}]}], ",", "range", ",", 
       "originalGeo", ",", "graphics", ",", "img", ",", "mask", ",", "grid"}],
       "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{"1", " ", "\[RightPointer]", " ", "fetch", " ", "map"}], "*)"}], 
     RowBox[{
      RowBox[{"range", "=", 
       RowBox[{"Quantity", "[", 
        RowBox[{"rangeKM", ",", " ", "\"\<Kilometers\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"originalGeo", "=", 
       RowBox[{"GeoGraphics", "[", 
        RowBox[{
         RowBox[{"GeoCenter", "->", 
          RowBox[{"GeoPosition", "[", "loc", "]"}]}], ",", 
         RowBox[{"GeoRange", "->", "range"}], ",", 
         RowBox[{"GeoBackground", "->", "\"\<VectorMinimal\>\""}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"graphics", "=", 
       RowBox[{"Normal", "[", "originalGeo", "]"}]}], ";", 
      RowBox[{"graphics", "=", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{"graphics", ",", "_Text", ",", "\[Infinity]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Echo", "[", "graphics", "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "2", " ", "\[RightPointer]", " ", "rasterise", " ", "at", " ", 
        "higher", " ", "resolution", " ", "to", " ", "avoid", " ", 
        "aliasing"}], "*)"}], 
      RowBox[{"img", "=", 
       RowBox[{"Rasterize", "[", 
        RowBox[{"graphics", ",", 
         RowBox[{"RasterSize", "->", 
          RowBox[{"10", "n"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "3", " ", "\[RightPointer]", " ", "mask", " ", "everything", " ", 
        "close", " ", "to", " ", "waterColor"}], "*)"}], 
      RowBox[{"mask", "=", 
       RowBox[{"Binarize", "[", 
        RowBox[{
         RowBox[{"ColorDistance", "[", 
          RowBox[{"img", ",", "waterColor"}], "]"}], ",", "0.05"}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Echo", "[", "mask", "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"ImageResize", "[", 
        RowBox[{"mask", ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"N", "[", 
       RowBox[{"1", "-", 
        RowBox[{"ImageData", "[", "grid", "]"}]}], "]"}]}]}], 
    "               ", "]"}]}], "\n"}]], "Input",
 CellChangeTimes->{{3.9623683177309933`*^9, 3.962368317734364*^9}, {
   3.962368381647605*^9, 3.962368418425329*^9}, {3.96236845177631*^9, 
   3.962368520123461*^9}, {3.9623687989490833`*^9, 3.962368808789357*^9}, {
   3.962368853854206*^9, 3.962368900999669*^9}, {3.962369054118259*^9, 
   3.9623690543511047`*^9}, {3.962369203738324*^9, 3.96236923135912*^9}, {
   3.962382996414213*^9, 3.962383051864419*^9}, 3.962389246498955*^9, {
   3.962389837976549*^9, 3.962389839951273*^9}, {3.9623898907032537`*^9, 
   3.962389919266252*^9}, {3.9623907314890957`*^9, 3.9623907400102777`*^9}},
 CellLabel->"In[95]:=",ExpressionUUID->"8efdc0f2-844d-4199-9238-e642a8a87cd2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"initializeTerrainGrid", "[", 
   RowBox[{"gridSize_", ",", 
    RowBox[{"location_", ":", "Automatic"}], ",", 
    RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "actualLocation", ",", "terrain", ",", "waterMask", ",", "elevation", ",",
       "i", ",", "j"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"actualLocation", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"location", "===", "Automatic"}], ",", "\[IndentingNewLine]", 
        
        RowBox[{"getRandomEarthLocation", "[", "]"}], ",", 
        "\[IndentingNewLine]", "location"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"terrain", "=", 
      RowBox[{"assignTerrain", "[", 
       RowBox[{"actualLocation", ",", "gridSize", ",", "rangeKM"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"waterMask", "=", 
      RowBox[{"identifyWater", "[", 
       RowBox[{"actualLocation", ",", "gridSize", ",", "rangeKM"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"terrain", " ", "=", " ", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Which", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"waterMask", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "1"}], ",", "6", ",",
           "True", ",", 
          RowBox[{"terrain", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}]}], " ", 
         "\[IndentingNewLine]", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "gridSize"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "gridSize"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"elevation", "=", 
      RowBox[{"getRealElevationData", "[", 
       RowBox[{"actualLocation", ",", "gridSize"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"terrain", ",", "elevation"}], "}"}]}]}], "\[IndentingNewLine]",
    "]"}]}]], "Input",
 CellChangeTimes->{{3.9607312972333164`*^9, 3.9607313129091167`*^9}, {
   3.960731353996256*^9, 3.9607313564877243`*^9}, {3.96073140213863*^9, 
   3.9607314167015686`*^9}, {3.9607321818480606`*^9, 
   3.9607322350213394`*^9}, {3.960732298035309*^9, 3.9607323184353733`*^9}, {
   3.960732396009285*^9, 3.960732416705759*^9}, {3.9608813134197807`*^9, 
   3.9608813184413586`*^9}, {3.9609763131541862`*^9, 
   3.9609764543840504`*^9}, {3.9609765106269207`*^9, 3.960976585656376*^9}, {
   3.961025320535204*^9, 3.961025335556656*^9}, 3.961144573650751*^9, {
   3.962309353182472*^9, 3.9623093533045006`*^9}, {3.9623095691751137`*^9, 
   3.9623095848981113`*^9}, 3.9623096197150993`*^9, {3.9623098523241787`*^9, 
   3.9623098594188385`*^9}, {3.9623368488988943`*^9, 3.962336854389511*^9}, {
   3.9623623875916862`*^9, 3.9623624185703583`*^9}, 3.962389961785133*^9, {
   3.9623904877100153`*^9, 3.9623904899830723`*^9}, 3.9623905404607553`*^9, {
   3.962390722198144*^9, 3.962390725429488*^9}},
 CellLabel->"In[96]:=",ExpressionUUID->"15a996ff-97ba-fe4f-ba42-7a8539a08c4c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"getPatchProperties", "[", "code_", "]"}], ":=", 
   RowBox[{"Switch", "[", 
    RowBox[{"code", ",", "1", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "2"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "2"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "2"}]}], "|>"}], ",", 
     RowBox[{"(*", "grass", "*)"}], "2", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "5"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "3"}]}], "|>"}], ",", 
     RowBox[{"(*", "sand", "*)"}], "3", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "5"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "5"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "4"}]}], "|>"}], ",", 
     RowBox[{"(*", "rock", "*)"}], "4", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "1"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "1"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "1"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "1"}]}], "|>"}], ",", 
     RowBox[{"(*", "forest", "*)"}], "5", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "5"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "2"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "2"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "5"}]}], "|>"}], ",", 
     RowBox[{"(*", "swamp", "*)"}], "6", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "1"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "6"}]}], "|>"}], ",", 
     RowBox[{"(*", "water", "*)"}], "7", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "3"}]}], "|>"}], ",", 
     RowBox[{"(*", "clay", "*)"}], "8", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "2"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "5"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "2"}]}], "|>"}], ",", 
     RowBox[{"(*", 
      RowBox[{"dry", " ", "grass"}], "*)"}], "9", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "2"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "5"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "3"}]}], "|>"}], ",", 
     RowBox[{"(*", "shrubland", "*)"}], "10", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "5"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "3"}]}], "|>"}], ",", 
     RowBox[{"(*", "crops", "*)"}], "11", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "1"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "4"}]}], "|>"}], ",", 
     RowBox[{"(*", "urban", "*)"}], "12", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "4"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "1"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "4"}]}], "|>"}], ",", 
     RowBox[{"(*", "road", "*)"}], "13", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "0"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "6"}]}], "|>"}], ",", 
     RowBox[{"(*", 
      RowBox[{"snow", "/", "ice"}], "*)"}], "14", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "0"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "6"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "6"}]}], "|>"}], ",", 
     RowBox[{"(*", 
      RowBox[{"old", " ", "burn", " ", "scar"}], "*)"}], "_", ",", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<emberProduction\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<heatResistance\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<flammability\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<burnTime\>\"", "->", "3"}], ",", 
       RowBox[{"\"\<radiationStrength\>\"", "->", "3"}]}], "|>"}]}], "]"}]}], 
  "\n"}]], "Input",
 CellChangeTimes->{{3.963250976442923*^9, 3.963250976446097*^9}},
 CellLabel->"In[97]:=",ExpressionUUID->"1bcc62c0-2646-4f2b-adb5-69ebbb3730ad"],

Cell[BoxData[
 RowBox[{
  RowBox[{"calculateSlopeFactor", "[", 
   RowBox[{
   "currentElev_", ",", "neighborElev_", ",", "uphillMultiplier_", ",", 
    "downhillMultiplier_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"slope", ",", "factor"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"slope", "=", 
      RowBox[{"neighborElev", "-", "currentElev"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Which", "[", 
      RowBox[{
       RowBox[{"slope", ">", "0"}], ",", 
       RowBox[{"1", "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"uphillMultiplier", "-", "1"}], ")"}], "*", 
         RowBox[{"Tanh", "[", 
          RowBox[{"slope", "*", "10"}], "]"}]}]}], ",", 
       RowBox[{"slope", "<", "0"}], ",", 
       RowBox[{"1", "-", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "-", "downhillMultiplier"}], ")"}], "*", 
         RowBox[{"Tanh", "[", 
          RowBox[{
           RowBox[{"Abs", "[", "slope", "]"}], "*", "10"}], "]"}]}]}], ",", 
       "True", ",", "1.0"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607312972333164`*^9, 3.9607313129091167`*^9}, {
   3.960731353996256*^9, 3.9607313564877243`*^9}, {3.96073140213863*^9, 
   3.9607314167015686`*^9}, {3.9607321818480606`*^9, 
   3.9607322350213394`*^9}, {3.960732298035309*^9, 3.9607323184353733`*^9}, {
   3.960732396009285*^9, 3.960732416705759*^9}, {3.9608813134197807`*^9, 
   3.9608813184413586`*^9}, {3.9610794855878716`*^9, 3.961079509457304*^9}, {
   3.9610797121795464`*^9, 3.961079730922962*^9}, {3.961113243295084*^9, 
   3.9611132451408253`*^9}, 3.961161248057001*^9, {3.961161925120142*^9, 
   3.9611619253812065`*^9}},
 CellLabel->"In[98]:=",ExpressionUUID->"a4fce2ce-228f-1c43-9b68-d5e7ac4ba401"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"buildEmberKernel", "[", 
     RowBox[{"windDir_", ",", 
      RowBox[{"R_", ":", "8"}], ",", 
      RowBox[{"p_", ":", "2"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"wd", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Norm", "[", "windDir", "]"}], ">", "0"}], ",", 
           RowBox[{"Normalize", "[", "windDir", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"1.", ",", "0."}], "}"}]}], "]"}]}], ",", "ker"}], "}"}], 
      ",", 
      RowBox[{
       RowBox[{"ker", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Module", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"d", "=", 
               RowBox[{"{", 
                RowBox[{"dx", ",", "dy"}], "}"}]}], ",", "dist", ",", 
              "align"}], "}"}], ",", 
            RowBox[{
             RowBox[{"dist", "=", 
              RowBox[{"Norm", "[", "d", "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"align", "=", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"dist", "==", "0."}], ",", "0.", ",", 
                RowBox[{"Max", "[", 
                 RowBox[{"0.", ",", 
                  RowBox[{"wd", ".", 
                   RowBox[{"(", 
                    RowBox[{"d", "/", "dist"}], ")"}]}]}], "]"}]}], "]"}]}], ";", 
             RowBox[{"(*", 
              RowBox[{"downwind", " ", "only"}], "*)"}], 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"dist", "==", "0."}], ",", "0.", ",", 
               RowBox[{"align", "/", 
                RowBox[{"(", 
                 RowBox[{"1", "+", 
                  RowBox[{"dist", "^", "p"}]}], ")"}]}]}], "]"}]}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"dy", ",", 
            RowBox[{"-", "R"}], ",", "R"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"dx", ",", 
            RowBox[{"-", "R"}], ",", "R"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ker", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"R", "+", "1"}], ",", 
           RowBox[{"R", "+", "1"}]}], "]"}], "]"}], "=", "0."}], ";", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"no", " ", "self"}], "-", "contribution"}], "*)"}], 
       "ker"}]}], "]"}]}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"emberHeatField", "[", 
    RowBox[{
    "terrainGrid_", ",", "fireGrid_", ",", "windDir_", ",", "windSpeed_", ",", 
     RowBox[{"R_", ":", "8"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"E", ",", "burningMask", ",", "ker"}], "}"}], ",", 
     RowBox[{
      RowBox[{"E", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"getPatchProperties", "[", "#", "]"}], 
           "[", "\"\<emberProduction\>\"", "]"}], "&"}], ",", "terrainGrid", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"burningMask", "=", 
       RowBox[{"Unitize", "@", 
        RowBox[{"Clip", "[", 
         RowBox[{"fireGrid", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "10"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ker", "=", 
       RowBox[{"buildEmberKernel", "[", 
        RowBox[{"windDir", ",", "R", ",", "2"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"windSpeed", "*", 
       RowBox[{"ListCorrelate", "[", 
        RowBox[{"ker", ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"7", "-", "E"}], ")"}], "*", "burningMask"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}], ",", "0"}], "]"}]}]}]}], "]"}]}], 
  ";"}], "\n"}], "Input",
 CellChangeTimes->{{3.9641529860547113`*^9, 3.964152986056855*^9}},
 CellLabel->"In[99]:=",ExpressionUUID->"dfc5ae06-a454-4aa6-a3af-7868802cee2d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fireSpreadRuleWithEmbers", "[", 
     RowBox[{
     "terrainGrid_", ",", "fireGrid_", ",", "elevationGrid_", ",", 
      "gridSize_", ",", "ignitionProbability_", ",", "windSpeed_", ",", 
      "windDirection_", ",", "moisture_", ",", "uphillMultiplier_", ",", 
      "downhillMultiplier_", ",", "emberField_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"newGrid", "=", "fireGrid"}], ",", "cappedNormalize", ",", 
        "neighborsRadius", ",", "windDir"}], "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"cappedNormalize", "[", "v_List", "]"}], ":=", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"nv", "=", 
            RowBox[{"Norm", "[", "v", "]"}]}], "}"}], ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"nv", "==", "0."}], ",", "v", ",", 
            RowBox[{"v", "/", "nv"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"neighborsRadius", "[", 
         RowBox[{"ii_", ",", "jj_", ",", "nmax_", ",", 
          RowBox[{"r_", ":", "2"}]}], "]"}], ":=", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", "cand", "}"}], ",", 
          RowBox[{
           RowBox[{"cand", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i", ",", "j"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", 
                  RowBox[{"Max", "[", 
                   RowBox[{"1", ",", 
                    RowBox[{"ii", "-", "r"}]}], "]"}], ",", 
                  RowBox[{"Min", "[", 
                   RowBox[{"nmax", ",", 
                    RowBox[{"ii", "+", "r"}]}], "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", 
                  RowBox[{"Max", "[", 
                   RowBox[{"1", ",", 
                    RowBox[{"jj", "-", "r"}]}], "]"}], ",", 
                  RowBox[{"Min", "[", 
                   RowBox[{"nmax", ",", 
                    RowBox[{"jj", "+", "r"}]}], "]"}]}], "}"}]}], "]"}], ",", 
              "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Select", "[", 
            RowBox[{"cand", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "!=", "ii"}], "||", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "!=", "jj"}]}], ")"}], "&&", 
               RowBox[{
                RowBox[{"Norm", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "ii"}], ",", 
                   RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "-", "jj"}]}], "}"}], 
                 "]"}], "<=", 
                RowBox[{"r", "+", 
                 RowBox[{"10", "^", 
                  RowBox[{"-", "9"}]}]}]}]}], "&"}]}], "]"}]}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"windDir", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Norm", "[", "windDirection", "]"}], ">", "0"}], ",", 
          RowBox[{"Normalize", "[", "windDirection", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"0.", ",", "0."}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "currentTerrain", ",", "currentFire", ",", "currentElev", ",", 
             "patchProps", ",", "neighbors", ",", "localHeat", ",", 
             "totalHeat"}], "}"}], ",", 
           RowBox[{
            RowBox[{"currentTerrain", "=", 
             RowBox[{"terrainGrid", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"currentFire", "=", 
             RowBox[{"fireGrid", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"currentElev", "=", 
             RowBox[{"elevationGrid", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"patchProps", "=", 
             RowBox[{"getPatchProperties", "[", "currentTerrain", "]"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"Which", "[", 
             RowBox[{"(*", 
              RowBox[{"non", "-", "burnables"}], "*)"}], 
             RowBox[{
              RowBox[{
               RowBox[{"currentTerrain", "==", "6"}], "||", 
               RowBox[{"currentTerrain", "==", "3"}]}], ",", "Null", ",", 
              RowBox[{"(*", 
               RowBox[{"burning", " ", "countdown"}], "*)"}], 
              RowBox[{"0", "<", "currentFire", "<=", "10"}], ",", 
              RowBox[{
               RowBox[{"newGrid", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
               RowBox[{"With", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"t", "=", 
                   RowBox[{"currentFire", "-", "1"}]}], "}"}], ",", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"t", "<=", "0"}], ",", "11", ",", "t"}], "]"}]}], 
                "]"}]}], ",", 
              RowBox[{"(*", 
               RowBox[{"already", " ", "charred"}], "*)"}], 
              RowBox[{"currentFire", "==", "11"}], ",", "Null", ",", 
              RowBox[{"(*", 
               RowBox[{"unburned", ":", 
                RowBox[{
                 RowBox[{"local", " ", "radiation"}], "+", 
                 RowBox[{"global", " ", "ember", " ", "field"}]}]}], "*)"}], 
              RowBox[{"currentFire", "==", "0"}], ",", 
              RowBox[{
               RowBox[{"neighbors", "=", 
                RowBox[{"neighborsRadius", "[", 
                 RowBox[{"i", ",", "j", ",", "gridSize", ",", "2"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{"local", " ", "radiation", " ", "part", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"no", " ", "side"}], "-", "effects"}], ")"}]}], 
                "*)"}], 
               RowBox[{"localHeat", "=", 
                RowBox[{"Total", "@", 
                 RowBox[{"Map", "[", 
                  RowBox[{
                   RowBox[{"Function", "[", 
                    RowBox[{
                    RowBox[{"{", "p", "}"}], ",", 
                    RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "ni", ",", "nj", ",", "nTerrain", ",", "nFire", ",", 
                    "nElev", ",", "nProps", ",", "dist", ",", "slopeFactor", ",",
                     "radiationStr"}], "}"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"ni", ",", "nj"}], "}"}], "=", "p"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"nTerrain", "=", 
                    RowBox[{"terrainGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{"ni", ",", "nj"}], "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"nFire", "=", 
                    RowBox[{"fireGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{"ni", ",", "nj"}], "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"0", "<", "nFire", "<=", "10"}], ",", 
                    RowBox[{
                    RowBox[{"nElev", "=", 
                    RowBox[{"elevationGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{"ni", ",", "nj"}], "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"nProps", "=", 
                    RowBox[{"getPatchProperties", "[", "nTerrain", "]"}]}], ";",
                     "\[IndentingNewLine]", 
                    RowBox[{"dist", "=", 
                    RowBox[{"Norm", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"nj", "-", "j"}], ",", 
                    RowBox[{"ni", "-", "i"}]}], "}"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"slopeFactor", "=", 
                    RowBox[{"calculateSlopeFactor", "[", 
                    RowBox[{
                    "currentElev", ",", "nElev", ",", "uphillMultiplier", ",",
                     "downhillMultiplier"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"radiationStr", "=", 
                    RowBox[{"7", "-", 
                    RowBox[{
                    "nProps", "[", "\"\<radiationStrength\>\"", "]"}]}]}], ";",
                     "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"radiationStr", "*", "slopeFactor"}], ")"}], "/", 
                    
                    RowBox[{"(", 
                    RowBox[{"1", "+", "dist"}], ")"}]}]}], ",", "0"}], 
                    "]"}]}]}], "]"}]}], "]"}], ",", "neighbors"}], "]"}]}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"add", " ", "long"}], "-", 
                 RowBox[{
                 "range", " ", "ember", " ", "contribution", " ", 
                  "precomputed", " ", "by", " ", "convolution"}]}], "*)"}], 
               RowBox[{"totalHeat", "=", 
                RowBox[{"localHeat", "+", 
                 RowBox[{"emberField", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"totalHeat", ">", "0"}], ",", 
                 RowBox[{"Module", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    "flammability", ",", "heatResistance", ",", 
                    "moistureEffect", ",", "ignitionChance"}], "}"}], ",", 
                   RowBox[{
                    RowBox[{"flammability", "=", 
                    RowBox[{"7", "-", 
                    RowBox[{
                    "patchProps", "[", "\"\<flammability\>\"", "]"}]}]}], ";",
                     "\[IndentingNewLine]", 
                    RowBox[{"heatResistance", "=", 
                    RowBox[{
                    "patchProps", "[", "\"\<heatResistance\>\"", "]"}]}], ";",
                     "\[IndentingNewLine]", 
                    RowBox[{"moistureEffect", "=", 
                    RowBox[{"1", "-", "moisture"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"ignitionChance", "=", 
                    RowBox[{"Min", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    "totalHeat", "*", "flammability", "*", "moistureEffect", "*",
                     "ignitionProbability"}], ")"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"heatResistance", "*", "8"}], ")"}]}], ",", 
                    "0.9"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"RandomReal", "[", "]"}], "<", "ignitionChance"}],
                     ",", 
                    RowBox[{
                    RowBox[{"newGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
                    RowBox[{"patchProps", "[", "\"\<burnTime\>\"", "]"}]}]}], 
                    "]"}], ";"}]}], "]"}]}], "]"}]}]}], "]"}]}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "gridSize"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "gridSize"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "newGrid"}]}], "]"}]}], ";"}], "\n"}]], "Input",\

 CellChangeTimes->{{3.964152993611517*^9, 3.9641529936137247`*^9}},
 CellLabel->
  "In[101]:=",ExpressionUUID->"b3948862-fc5b-450a-abca-be01d1beed51"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plotTerrain", "[", 
   RowBox[{"terrainGrid_", ",", 
    RowBox[{"title_", ":", "\"\<\>\""}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"ArrayPlot", "[", 
   RowBox[{"terrainGrid", ",", 
    RowBox[{"ColorRules", "->", "$terrainColorRules"}], ",", 
    RowBox[{"Mesh", "->", "False"}], ",", 
    RowBox[{"ImageSize", "->", "200"}], ",", 
    RowBox[{"PlotLabel", "->", "title"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, 3.9608824257727604`*^9, 
   3.9610568691381607`*^9, {3.9610570265792694`*^9, 3.961057030013502*^9}, {
   3.961059462398344*^9, 3.96105951470018*^9}, 3.9611613290315094`*^9},
 CellLabel->
  "In[102]:=",ExpressionUUID->"25564546-6bba-864e-b3ce-ae78c09daf74"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"plotFire", "[", 
    RowBox[{"fireGrid_", ",", "terrainGrid_", ",", 
     RowBox[{"title_", ":", "\"\<\>\""}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "display", "}"}], ",", 
     RowBox[{
      RowBox[{"display", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Which", "[", 
          RowBox[{
           RowBox[{"1", "<=", 
            RowBox[{"fireGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "<=", "10"}], ",", 
           RowBox[{"20", "+", 
            RowBox[{"fireGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
           RowBox[{"(*", 
            RowBox[{"20", "-", "30"}], "*)"}], 
           RowBox[{
            RowBox[{"fireGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "11"}], ",", "35", 
           ",", 
           RowBox[{"(*", "charred", "*)"}], "True", ",", 
           RowBox[{"terrainGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "fireGrid", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"fireGrid", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ArrayPlot", "[", 
       RowBox[{"display", ",", 
        RowBox[{"ColorRules", "->", "$firePlotColorRules"}], ",", 
        RowBox[{"Mesh", "->", "False"}], ",", 
        RowBox[{"ImageSize", "->", "400"}], ",", 
        RowBox[{"PlotLabel", "->", "title"}]}], "]"}]}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, 3.9608824257727604`*^9, 
   3.9610568691381607`*^9, {3.9610570265792694`*^9, 3.961057030013502*^9}, {
   3.961059462398344*^9, 3.9610594808719406`*^9}, 3.9610953904857044`*^9, {
   3.9611571910689354`*^9, 3.961157195129633*^9}, 3.9611613361552563`*^9, 
   3.9632512308381567`*^9},
 CellLabel->
  "In[103]:=",ExpressionUUID->"b7ebc6ff-7b15-5e46-9415-d17d2acb89f7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plotAllFireRegions", "[", 
   RowBox[{
   "terrainGrids_", ",", "fireGrids_", ",", "numRows_", ",", "numCols_"}], 
   "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "plots", "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"plots", " ", "=", " ", 
      RowBox[{"Table", "[", "\n", 
       RowBox[{
        RowBox[{"plotFire", "[", 
         RowBox[{
          RowBox[{"fireGrids", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
          RowBox[{"terrainGrids", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
          RowBox[{"\"\<Region(\>\"", "<>", 
           RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<,\>\"", "<>", 
           RowBox[{"ToString", "[", "j", "]"}], "<>", "\"\<)\>\""}]}], "]"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "numRows"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Grid", "[", 
      RowBox[{"plots", ",", 
       RowBox[{"Spacings", "->", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}]}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, 3.9608824257727604`*^9, 
   3.9610568691381607`*^9, {3.9610570265792694`*^9, 3.961057030013502*^9}, {
   3.961059462398344*^9, 3.9610594808719406`*^9}, 3.9610953904857044`*^9, {
   3.9611571910689354`*^9, 3.9611571914774647`*^9}, 3.961161341893038*^9},
 CellLabel->
  "In[104]:=",ExpressionUUID->"4939bdab-b121-3b4e-9dcc-952c421ac91d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"getUnburnedPositions", "[", "fireGrid_", "]"}], ":=", 
   RowBox[{"Position", "[", 
    RowBox[{"fireGrid", ",", "0"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"getBurningPositions", "[", "fireGrid_", "]"}], ":=", 
   RowBox[{"Position", "[", 
    RowBox[{"fireGrid", ",", 
     RowBox[{"y_", "/;", 
      RowBox[{"1", "<=", "y", "<=", "10"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"getBurnedPositions", "[", "fireGrid_", "]"}], ":=", 
   RowBox[{"Position", "[", 
    RowBox[{"fireGrid", ",", "11"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, {3.960882428063238*^9, 
   3.9608824586046505`*^9}, 3.960882500531225*^9, {3.9610793033353176`*^9, 
   3.961079379380127*^9}, 3.961161275076906*^9},
 CellLabel->
  "In[105]:=",ExpressionUUID->"db3623ff-0adc-1a45-9a39-330368b9cab0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"countUnburned", "[", "fireGrid_", "]"}], ":=", 
   RowBox[{"Count", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", "fireGrid", "]"}], ",", "0"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"countBurning", "[", "fireGrid_", "]"}], ":=", 
   RowBox[{"Count", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", "fireGrid", "]"}], ",", 
     RowBox[{"y_", "/;", 
      RowBox[{"1", "<=", "y", "<=", "10"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"countBurned", "[", "fireGrid_", "]"}], ":=", 
   RowBox[{"Count", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", "fireGrid", "]"}], ",", "11"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, 3.960882367449951*^9, {3.960882428063238*^9, 
   3.9608824586046505`*^9}, 3.960882500531225*^9, {3.9610793033353176`*^9, 
   3.961079441345209*^9}, 3.9610995579307327`*^9, 3.9610998217466946`*^9, 
   3.961099991019785*^9, 3.9611511163739376`*^9, {3.9611612688435955`*^9, 
   3.961161270968628*^9}, {3.961161960540848*^9, 3.961161960764654*^9}},
 CellLabel->
  "In[108]:=",ExpressionUUID->"a7c6b6b1-599e-4e4e-8a73-b13435879e7c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"runFireSimulation", "[", 
   RowBox[{
    RowBox[{"gridSize_", ":", "80"}], ",", 
    RowBox[{"initialFires_", ":", "2"}], ",", 
    RowBox[{"timeSteps_", ":", "100"}], ",", 
    RowBox[{"ignitionProbability_", ":", "0.8"}], ",", 
    RowBox[{"windSpeed_", ":", "0.3"}], ",", 
    RowBox[{"windDirection_", ":", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}]}], ",", 
    RowBox[{"moisture_", ":", "0.2"}], ",", 
    RowBox[{"numRows_", ":", "1"}], ",", 
    RowBox[{"numCols_", ":", "1"}], ",", 
    RowBox[{"interRegionSpreadProb_", ":", "0.5"}], ",", 
    RowBox[{"uphillMultiplier_", ":", "1.5"}], ",", 
    RowBox[{"downhillMultiplier_", ":", "0.7"}], ",", 
    RowBox[{"location_", ":", "Automatic"}], ",", 
    RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "terrainGrids", ",", "elevationGrids", ",", "fireGrids", ",", 
      "unburnedPositions", ",", 
      RowBox[{"firePoints", "=", 
       RowBox[{"{", "}"}]}], ",", "terrainAndElev", ",", "actualLocation", ",",
       "result", ",", "gridPos"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"actualLocation", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"location", "===", "Automatic"}], ",", 
        RowBox[{"getRandomEarthLocation", "[", "]"}], ",", "location"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"terrainGrids", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"elevationGrids", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"terrainAndElev", "=", 
         RowBox[{"initializeTerrainGrid", "[", 
          RowBox[{"gridSize", ",", "actualLocation", ",", "rangeKM"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"terrainGrids", ",", 
          RowBox[{"terrainAndElev", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"elevationGrids", ",", 
          RowBox[{"terrainAndElev", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "numRows"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"terrainGrids", "=", 
      RowBox[{"ArrayReshape", "[", 
       RowBox[{"terrainGrids", ",", 
        RowBox[{"{", 
         RowBox[{
         "numRows", ",", "numCols", ",", "gridSize", ",", "gridSize"}], 
         "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"elevationGrids", "=", 
      RowBox[{"ArrayReshape", "[", 
       RowBox[{"elevationGrids", ",", 
        RowBox[{"{", 
         RowBox[{
         "numRows", ",", "numCols", ",", "gridSize", ",", "gridSize"}], 
         "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fireGrids", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"gridSize", ",", "gridSize"}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "numRows"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"unburnedPositions", "=", 
      RowBox[{"getUnburnedPositions", "[", 
       RowBox[{"fireGrids", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"unburnedPositions", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"unburnedPositions", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"terrainGrids", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "!=", "6"}], 
         "&"}]}], "]"}]}], ";", 
     RowBox[{"result", "=", 
      RowBox[{"DialogInput", "[", 
       RowBox[{"DynamicModule", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"currentPoint", "=", 
            RowBox[{"{", 
             RowBox[{"15", ",", "15"}], "}"}]}], ",", 
           RowBox[{"selectedPoints", "=", 
            RowBox[{"{", "}"}]}]}], "}"}], ",", 
         RowBox[{"Column", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
            "Text", "[", "\"\<Click on the terrain to place fire starting \
points\>\"", "]"}], ",", 
            RowBox[{"Text", "[", 
             RowBox[{"Dynamic", "[", 
              RowBox[{"\"\<Points selected: \>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"Length", "[", "selectedPoints", "]"}], "]"}], 
               "<>", "\"\</\>\"", "<>", 
               RowBox[{"ToString", "[", "initialFires", "]"}]}], "]"}], "]"}],
             ",", 
            RowBox[{"LocatorPane", "[", 
             RowBox[{
              RowBox[{"Dynamic", "[", "currentPoint", "]"}], ",", 
              RowBox[{"plotAllFireRegions", "[", 
               RowBox[{
               "terrainGrids", ",", "fireGrids", ",", "numRows", ",", 
                "numCols"}], "]"}], ",", 
              RowBox[{"Appearance", "->", 
               RowBox[{"Graphics", "[", 
                RowBox[{"{", 
                 RowBox[{"Red", ",", 
                  RowBox[{"PointSize", "[", "0.05", "]"}], ",", 
                  RowBox[{"Point", "[", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], "]"}]}], "}"}], "]"}]}]}],
              "]"}], ",", 
            RowBox[{"Row", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Add Fire Point\>\"", ",", 
                 RowBox[{
                  RowBox[{"gridPos", "=", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Clip", "[", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{"gridSize", "-", 
                    RowBox[{"currentPoint", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "gridSize"}], "}"}]}], "]"}], ",", 
                    RowBox[{"Clip", "[", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{"currentPoint", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "gridSize"}], "}"}]}], "]"}]}], "}"}]}],
                   ";", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"terrainGrids", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1", ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "!=", 
                    "6"}], "&&", 
                    RowBox[{
                    RowBox[{"terrainGrids", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1", ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "!=", 
                    "3"}]}], ",", 
                    RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"selectedPoints", ",", "gridPos"}], "]"}], ";"}], 
                    ",", 
                    RowBox[{
                    "MessageDialog", 
                    "[", "\"\<Cannot place fire on water!\>\"", "]"}]}], 
                   "]"}]}], ",", 
                 RowBox[{"Enabled", "->", 
                  RowBox[{"Dynamic", "[", 
                   RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], "<", 
                    "initialFires"}], "]"}]}]}], "]"}], ",", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Reset\>\"", ",", 
                 RowBox[{"selectedPoints", "=", 
                  RowBox[{"{", "}"}]}]}], "]"}], ",", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Run Simulation\>\"", ",", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], ">", 
                    "0"}], ",", 
                   RowBox[{"DialogReturn", "[", "selectedPoints", "]"}], ",", 
                   
                   RowBox[{
                   "MessageDialog", 
                    "[", "\"\<Please select at least one fire point!\>\"", 
                    "]"}]}], "]"}], ",", 
                 RowBox[{"Enabled", "->", 
                  RowBox[{"Dynamic", "[", 
                   RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], ">", 
                    "0"}], "]"}]}]}], "]"}], ",", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Cancel\>\"", ",", 
                 RowBox[{"DialogReturn", "[", "$Canceled", "]"}]}], "]"}]}], 
              "}"}], "]"}]}], "}"}], "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"result", "===", "$Canceled"}], ",", 
       RowBox[{
        RowBox[{"Echo", "[", "\"\<Simulation canceled by user.\>\"", "]"}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "$Canceled", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "result", "]"}], "==", "0"}], ",", 
       RowBox[{
        RowBox[{"Echo", "[", "\"\<No fire points selected.\>\"", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"firePoints", "=", "result"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Echo", "[", 
      RowBox[{"{", 
       RowBox[{"\"\<Starting simulation with \>\"", ",", 
        RowBox[{"Length", "[", "firePoints", "]"}], 
        ",", "\"\< fire points at: \>\"", ",", "firePoints"}], "}"}], "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"showBurnFireGrids", "[", 
      RowBox[{
      "firePoints", ",", "terrainGrids", ",", "elevationGrids", ",", 
       "fireGrids", ",", "numRows", ",", "numCols", ",", "gridSize", ",", 
       "ignitionProbability", ",", "windSpeed", ",", "windDirection", ",", 
       "moisture", ",", "interRegionSpreadProb", ",", "timeSteps", ",", 
       "initialFires", ",", "uphillMultiplier", ",", "downhillMultiplier", ",",
        "actualLocation", ",", "rangeKM"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, {3.9608823687401543`*^9, 3.9608823766538296`*^9}, {
   3.9608824979550247`*^9, 3.960882498579052*^9}, 3.960882550603531*^9, 
   3.9609741155886116`*^9, 3.9610535090859127`*^9, {3.961055558796732*^9, 
   3.961055559991287*^9}, {3.9610557112636375`*^9, 3.961055745647846*^9}, 
   3.961058588091799*^9, {3.9610606024089317`*^9, 3.961060648068531*^9}, 
   3.961078275949913*^9, {3.9610954066951866`*^9, 3.961095443284231*^9}, 
   3.9611009698623714`*^9, {3.9611574860470314`*^9, 3.961157486150364*^9}, 
   3.9611606772820854`*^9, 3.9611613945502415`*^9, {3.9611619806772175`*^9, 
   3.961162026992628*^9}, 3.961163652467371*^9, {3.961165097552368*^9, 
   3.9611650982630424`*^9}, {3.9611652771644154`*^9, 
   3.9611653019519176`*^9}, {3.961170857695324*^9, 3.961170886261444*^9}, {
   3.962362055247761*^9, 3.9623620711064453`*^9}, {3.9623624322774105`*^9, 
   3.962362460774046*^9}, {3.9623626973702164`*^9, 3.9623627218169193`*^9}, {
   3.962362753719263*^9, 3.962362773246792*^9}, {3.962363071822918*^9, 
   3.9623631218902073`*^9}, {3.9623646329692163`*^9, 3.962364635062722*^9}, 
   3.962365071828312*^9, {3.962365380910968*^9, 3.96236538651917*^9}, {
   3.9623678178476315`*^9, 3.962367866326542*^9}, {3.9623690718316956`*^9, 
   3.962369072737461*^9}, {3.963314340103853*^9, 3.9633143462170267`*^9}},
 CellLabel->
  "In[111]:=",ExpressionUUID->"433b8f1f-f250-b441-a8db-15ef350cdd16"],

Cell[BoxData[
 TemplateBox[{
  "Pattern", "patm", 
   "\"Too many (\\!\\(\\*RowBox[{\\\"14\\\"}]\\)) optional arguments required \
in \\!\\(\\*RowBox[{\\\"runFireSimulation\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \
\\\"[\\\", RowBox[{\\\"1\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"80\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"2\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"2\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"3\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"100\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"4\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"0.8`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"5\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"0.3`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"6\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{\\\"1\\\", \\\
\",\\\", \\\"0\\\"}], \\\"}\\\"}]}], \\\"]\\\"}], \\\",\\\", RowBox[{RowBox[{\
\\\"\[LeftSkeleton]\\\", \\\"8\\\", \\\"\[RightSkeleton]\\\"}], \\\"[\\\", \
RowBox[{\\\"\[LeftSkeleton]\\\", \\\"1\\\", \\\"\[RightSkeleton]\\\"}], \\\"]\
\\\"}], \\\",\\\", RowBox[{\\\"\[LeftSkeleton]\\\", \\\"1\\\", \\\"\
\[RightSkeleton]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"\[LeftSkeleton]\\\", \\\"1\\\", \
\\\"\[RightSkeleton]\\\"}], \\\",\\\", \\\"1\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"10\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"0.5`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"11\\\", \\\",\\\", \\\
\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"1.5`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"12\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"0.7`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"13\\\", \\\",\\\", \\\
\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"Automatic\\\"}], \\\"]\\\"}], \
\\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\
\", \\\"[\\\", RowBox[{\\\"14\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\
\\\", \\\"1.`\\\"}], \\\"]\\\"}]}], \\\"]\\\"}]\\).\"", 2, 111, 13, 
   25868236474181491932, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{
  3.9623678699529305`*^9, 3.9623686642971306`*^9, {3.9623690739988766`*^9, 
   3.9623690847223988`*^9}, 3.9623695961164284`*^9, 3.9623700341548805`*^9, 
   3.962382636260741*^9, 3.96238305726261*^9, 3.9623892228668423`*^9, 
   3.962389564265596*^9, 3.962389873589664*^9, 3.962389924324864*^9, 
   3.9623899674578753`*^9, 3.9623904624773903`*^9, 3.962390783125682*^9, 
   3.962398039470965*^9, 3.9623984985057716`*^9, 3.9624111652147713`*^9, 
   3.9624876621731243`*^9, 3.962639738512211*^9, 3.963250999522291*^9, 
   3.963251365516972*^9, 3.963294715087214*^9, 3.9632952342897587`*^9, 
   3.9633133706826878`*^9, 3.963313579928974*^9, 3.9633143498689737`*^9, 
   3.9633143977733793`*^9, 3.9633146038008623`*^9, 3.96332797166319*^9, 
   3.963328121889558*^9, 3.963328335926527*^9, 3.963328906593665*^9, 
   3.963329260807644*^9, 3.963329395973377*^9, 3.963329787328619*^9, 
   3.963329835444066*^9, 3.963329972445209*^9, 3.963330141206808*^9, 
   3.964126743247167*^9, 3.964153499504356*^9, 3.964153754423341*^9, 
   3.964154154943095*^9},
 CellLabel->
  "During evaluation of \
In[111]:=",ExpressionUUID->"a655a2b6-7409-4cca-84ef-adb85307ad5e"],

Cell[BoxData[
 TemplateBox[{
  "Pattern", "patm", 
   "\"Too many (\\!\\(\\*RowBox[{\\\"14\\\"}]\\)) optional arguments required \
in \\!\\(\\*RowBox[{\\\"runFireSimulation\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \
\\\"[\\\", RowBox[{\\\"1\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"80\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"2\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"2\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"3\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"100\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"4\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"0.8`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"5\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"0.3`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"6\\\", \\\",\\\", \
\\\"_\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{\\\"1\\\", \\\
\",\\\", \\\"0\\\"}], \\\"}\\\"}]}], \\\"]\\\"}], \\\",\\\", RowBox[{RowBox[{\
\\\"\[LeftSkeleton]\\\", \\\"8\\\", \\\"\[RightSkeleton]\\\"}], \\\"[\\\", \
RowBox[{\\\"\[LeftSkeleton]\\\", \\\"1\\\", \\\"\[RightSkeleton]\\\"}], \\\"]\
\\\"}], \\\",\\\", RowBox[{\\\"\[LeftSkeleton]\\\", \\\"1\\\", \\\"\
\[RightSkeleton]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"\[LeftSkeleton]\\\", \\\"1\\\", \
\\\"\[RightSkeleton]\\\"}], \\\",\\\", \\\"1\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"10\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"0.5`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"11\\\", \\\",\\\", \\\
\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"1.5`\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\
\", RowBox[{\\\"12\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\\\", \
\\\"0.7`\\\"}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Pattern\\\", \\\"[\\\", RowBox[{\\\"13\\\", \\\",\\\", \\\
\"_\\\"}], \\\"]\\\"}], \\\",\\\", \\\"Automatic\\\"}], \\\"]\\\"}], \
\\\",\\\", RowBox[{\\\"Optional\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Pattern\\\
\", \\\"[\\\", RowBox[{\\\"14\\\", \\\",\\\", \\\"_\\\"}], \\\"]\\\"}], \\\",\
\\\", \\\"1.`\\\"}], \\\"]\\\"}]}], \\\"]\\\"}]\\).\"", 2, 111, 14, 
   25868236474181491932, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{
  3.9623678699529305`*^9, 3.9623686642971306`*^9, {3.9623690739988766`*^9, 
   3.9623690847223988`*^9}, 3.9623695961164284`*^9, 3.9623700341548805`*^9, 
   3.962382636260741*^9, 3.96238305726261*^9, 3.9623892228668423`*^9, 
   3.962389564265596*^9, 3.962389873589664*^9, 3.962389924324864*^9, 
   3.9623899674578753`*^9, 3.9623904624773903`*^9, 3.962390783125682*^9, 
   3.962398039470965*^9, 3.9623984985057716`*^9, 3.9624111652147713`*^9, 
   3.9624876621731243`*^9, 3.962639738512211*^9, 3.963250999522291*^9, 
   3.963251365516972*^9, 3.963294715087214*^9, 3.9632952342897587`*^9, 
   3.9633133706826878`*^9, 3.963313579928974*^9, 3.9633143498689737`*^9, 
   3.9633143977733793`*^9, 3.9633146038008623`*^9, 3.96332797166319*^9, 
   3.963328121889558*^9, 3.963328335926527*^9, 3.963328906593665*^9, 
   3.963329260807644*^9, 3.963329395973377*^9, 3.963329787328619*^9, 
   3.963329835444066*^9, 3.963329972445209*^9, 3.963330141206808*^9, 
   3.964126743247167*^9, 3.964153499504356*^9, 3.964153754423341*^9, 
   3.964154154945644*^9},
 CellLabel->
  "During evaluation of \
In[111]:=",ExpressionUUID->"97d98cb2-826f-409c-bbf6-5ff63ae27cc0"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"interRegionFireSpread", "[", 
   RowBox[{
   "terrainGrids_", ",", "fireGrids_", ",", "gridSize_", ",", "numRows_", ",",
     "numCols_", ",", "interRegionSpreadProb_", ",", "windSpeed_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"updatedFireGrids", "=", "fireGrids"}], "}"}], ",", 
    "\[IndentingNewLine]", "updatedFireGrids"}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, {3.9608823687401543`*^9, 3.9608823766538296`*^9}, {
   3.9608824979550247`*^9, 3.960882498579052*^9}, 3.960882550603531*^9, 
   3.9609741155886116`*^9, 3.9610535090859127`*^9, {3.961055558796732*^9, 
   3.961055559991287*^9}, {3.9610557112636375`*^9, 3.961055745647846*^9}, 
   3.961058588091799*^9, {3.9610606024089317`*^9, 3.961060648068531*^9}, 
   3.961078275949913*^9, {3.9610954066951866`*^9, 3.961095443284231*^9}, 
   3.9611009698623714`*^9, {3.9611574860470314`*^9, 3.961157486150364*^9}, 
   3.9611606772820854`*^9, 3.9611613945502415`*^9, {3.9611619806772175`*^9, 
   3.961162026992628*^9}, {3.961163652467371*^9, 3.9611636558065033`*^9}, 
   3.961163811226879*^9},
 CellLabel->
  "In[112]:=",ExpressionUUID->"864aa9b8-02af-4548-98b3-87d5a98f48f6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"updateAllFireRegions", "[", 
     RowBox[{
     "terrainGrids_", ",", "fireGrids_", ",", "elevationGrids_", ",", 
      "gridSize_", ",", "numRows_", ",", "numCols_", ",", 
      "ignitionProbability_", ",", "windSpeed_", ",", "windDirection_", ",", 
      "moisture_", ",", "interRegionSpreadProb_", ",", "uphillMultiplier_", ",",
       "downhillMultiplier_", ",", 
      RowBox[{"emberRadius_", ":", "8"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"updatedGrids", ",", "emberField"}], "}"}], ",", 
      RowBox[{
       RowBox[{"updatedGrids", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"emberField", "=", 
            RowBox[{"emberHeatField", "[", 
             RowBox[{
              RowBox[{"terrainGrids", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
              RowBox[{"fireGrids", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", "windDirection", ",",
               "windSpeed", ",", "emberRadius"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"fireSpreadRuleWithEmbers", "[", 
            RowBox[{
             RowBox[{"terrainGrids", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
             RowBox[{"fireGrids", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
             RowBox[{"elevationGrids", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", "gridSize", ",", 
             "ignitionProbability", ",", "windSpeed", ",", "windDirection", ",",
              "moisture", ",", "uphillMultiplier", ",", "downhillMultiplier", 
             ",", "emberField"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "numRows"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"interRegionFireSpread", "[", 
        RowBox[{
        "terrainGrids", ",", "updatedGrids", ",", "gridSize", ",", "numRows", 
         ",", "numCols", ",", "interRegionSpreadProb", ",", "windSpeed"}], 
        "]"}]}]}], "]"}]}], ";"}], "\n"}]], "Input",
 CellChangeTimes->{{3.964153007608007*^9, 3.964153007610579*^9}},
 CellLabel->
  "In[113]:=",ExpressionUUID->"e02be539-e7e9-4b36-a325-ddabfb0e00bb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"showBurnFireGrids", "[", 
   RowBox[{
   "firePoints_", ",", "terrainGrids_", ",", "elevationGrids_", ",", "fg_", ",",
     "numRows_", ",", "numCols_", ",", "gridSize_", ",", 
    "ignitionProbability_", ",", "windSpeed_", ",", "windDirection_", ",", 
    "moisture_", ",", "interRegionSpreadProb_", ",", "timeSteps_", ",", 
    "initialFires_", ",", "uphillMultiplier_", ",", "downhillMultiplier_", ",",
     "location_", ",", "rangeKM_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"fireGrids", "=", "fg"}], ",", "fireHistory", ",", 
      "animationFrames", ",", "finalFire", ",", "totalBurned", ",", 
      "totalBurning", ",", "totalUnburned", ",", "data", ",", 
      "threeDTerrainPlot", ",", "terrain", ",", "props"}], "}"}], ",", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"terrain", "=", 
         RowBox[{"terrainGrids", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1", ",", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"props", "=", 
         RowBox[{"getPatchProperties", "[", "terrain", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fireGrids", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1", ",", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "=", 
         RowBox[{"props", "[", "\"\<burnTime\>\"", "]"}]}], ";"}], ",", 
       RowBox[{"{", 
        RowBox[{"pos", ",", "firePoints"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[LineSeparator]", 
     RowBox[{"Echo", "[", 
      RowBox[{"plotAllFireRegions", "[", 
       RowBox[{
       "terrainGrids", ",", "fireGrids", ",", "numRows", ",", "numCols"}], 
       "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"numRows", "==", "1"}], "&&", 
        RowBox[{"numCols", "==", "1"}]}], ",", "\[IndentingNewLine]", 
       "\[LineSeparator]", 
       RowBox[{
        RowBox[{"Echo", "[", 
         RowBox[{"generate3DTerrain", "[", 
          RowBox[{"gridSize", ",", "location", ",", "rangeKM"}], "]"}], "]"}],
         ";"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"threeDTerrainPlot", "=", 
      RowBox[{"satelliteImagery", "[", 
       RowBox[{"gridSize", ",", "location", ",", "rangeKM"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fireHistory", "=", 
      RowBox[{"NestList", "[", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{"fireG", ",", 
          RowBox[{"Module", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"tg4", ",", "eg4", ",", "fg4", ",", "upd"}], "}"}], ",", 
            
            RowBox[{
             RowBox[{"tg4", "=", 
              RowBox[{"{", 
               RowBox[{"{", "terrainGrid", "}"}], "}"}]}], ";", 
             RowBox[{"(*", 
              RowBox[{"1", "\[Times]", "1", " ", "region", " ", "wrap"}], 
              "*)"}], 
             RowBox[{"eg4", "=", 
              RowBox[{"{", 
               RowBox[{"{", "elevationGrid", "}"}], "}"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"fg4", "=", 
              RowBox[{"{", 
               RowBox[{"{", "fireG", "}"}], "}"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"upd", "=", 
              RowBox[{"updateAllFireRegions", "[", 
               RowBox[{
               "tg4", ",", "fg4", ",", "eg4", ",", "gridSize", ",", "1", ",", 
                "1", ",", "ignitionProbability", ",", "windSpeed", ",", 
                "windDirection", ",", "moisture", ",", "0.0", ",", 
                RowBox[{"(*", 
                 RowBox[{"interRegionSpreadProb", " ", 
                  RowBox[{"(", 
                   RowBox[{"unused", " ", "for", " ", "1", "\[Times]", "1"}], 
                   ")"}]}], "*)"}], "uphillMultiplier", ",", 
                "downhillMultiplier"}], "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "emberRadius", " ", "uses", " ", "default", " ", "8"}], 
                "*)"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"upd", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], 
           "                      ", 
           RowBox[{"(*", 
            RowBox[{"unwrap", " ", "back", " ", "to", " ", "2", "D"}], "*)"}],
            "]"}]}], "]"}], ",", "fireGrid", ",", "timeSteps"}], "]"}]}], ";",
      "\n", "\[IndentingNewLine]", 
     RowBox[{"animationFrames", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"plotAllFireRegions", "[", 
         RowBox[{"terrainGrids", ",", 
          RowBox[{"fireHistory", "[", 
           RowBox[{"[", "t", "]"}], "]"}], ",", "numRows", ",", "numCols"}], 
         "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"Length", "[", "fireHistory", "]"}]}], "}"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"finalFire", "=", 
      RowBox[{"Last", "[", "fireHistory", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"totalBurned", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"countBurned", "[", 
         RowBox[{"finalFire", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "numRows"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"totalBurning", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"countBurning", "[", 
         RowBox[{"finalFire", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "numRows"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"totalUnburned", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"countUnburned", "[", 
         RowBox[{"finalFire", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "numRows"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{"countBurned", "[", 
             RowBox[{"fireHistory", "[", 
              RowBox[{"[", 
               RowBox[{"t", ",", "i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "numRows"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "numCols"}], "}"}]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"Length", "[", "fireHistory", "]"}]}], "}"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<FireHistory\>\"", "->", "fireHistory"}], ",", 
       RowBox[{"\"\<Animation\>\"", "->", 
        RowBox[{"ListAnimate", "[", 
         RowBox[{"animationFrames", ",", 
          RowBox[{"AnimationRunning", "->", "True"}], ",", 
          RowBox[{"AnimationRate", "->", "2"}]}], "]"}]}], ",", 
       RowBox[{"\"\<TerrainGrids\>\"", "->", "terrainGrids"}], ",", 
       RowBox[{"\"\<ElevationGrids\>\"", "->", "elevationGrids"}], ",", 
       RowBox[{"\"\<Data\>\"", "->", "data"}], ",", 
       RowBox[{"\"\<FinalFire\>\"", "->", "finalFire"}], ",", 
       RowBox[{"\"\<3DPlot\>\"", "->", "threeDTerrainPlot"}], ",", 
       RowBox[{"\"\<Parameters\>\"", "->", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<gridSize\>\"", "->", "gridSize"}], ",", 
          RowBox[{"\"\<initialFires\>\"", "->", "initialFires"}], ",", 
          RowBox[{"\"\<timeSteps\>\"", "->", "timeSteps"}], ",", 
          
          RowBox[{"\"\<ignitionProbability\>\"", "->", 
           "ignitionProbability"}], ",", 
          RowBox[{"\"\<windSpeed\>\"", "->", "windSpeed"}], ",", 
          RowBox[{"\"\<windDirection\>\"", "->", "windDirection"}], ",", 
          RowBox[{"\"\<moisture\>\"", "->", "moisture"}], ",", 
          RowBox[{"\"\<numRows\>\"", "->", "numRows"}], ",", 
          RowBox[{"\"\<numCols\>\"", "->", "numCols"}], ",", 
          
          RowBox[{"\"\<interRegionSpreadProb\>\"", "->", 
           "interRegionSpreadProb"}], ",", 
          RowBox[{"\"\<uphillMultiplier\>\"", "->", "uphillMultiplier"}], ",", 
          
          RowBox[{"\"\<downhillMultiplier\>\"", "->", 
           "downhillMultiplier"}]}], "|>"}]}]}], "|>"}]}]}], "]"}]}]], "Input",\

 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, {3.9608823687401543`*^9, 3.9608823766538296`*^9}, 
   3.9608824979550247`*^9, 3.9608888114359894`*^9, 3.961020702117777*^9, 
   3.9610535311369324`*^9, {3.961053616485199*^9, 3.9610536364047318`*^9}, {
   3.9610555715167694`*^9, 3.9610555720350246`*^9}, {3.961056812179535*^9, 
   3.961056817315378*^9}, 3.961058246972004*^9, {3.9610583493670406`*^9, 
   3.9610583531898174`*^9}, 3.9610782648551693`*^9, {3.9610799419548626`*^9, 
   3.9610799497203236`*^9}, 3.961079993103178*^9, {3.961095456704197*^9, 
   3.9610954691931095`*^9}, {3.961113296377268*^9, 3.961113332494068*^9}, 
   3.961150635190424*^9, {3.9611569494854393`*^9, 3.9611569649222755`*^9}, {
   3.9611570021762123`*^9, 3.9611570412806396`*^9}, {3.961157822473591*^9, 
   3.9611578264218025`*^9}, 3.9611603288708153`*^9, 3.9611604970756893`*^9, 
   3.961161383489002*^9, {3.9611620381136837`*^9, 3.961162056056553*^9}, {
   3.961163691530527*^9, 3.96116370751676*^9}, {3.9611651729529667`*^9, 
   3.961165180546465*^9}, {3.9611708903473186`*^9, 3.9611708948916054`*^9}, {
   3.962365924054616*^9, 3.962365929123822*^9}, {3.962368139511631*^9, 
   3.96236816525861*^9}, {3.9641534109660788`*^9, 3.9641534300015306`*^9}, {
   3.964153468650812*^9, 3.964153487794647*^9}},
 CellLabel->
  "In[114]:=",ExpressionUUID->"1e9b58e1-29de-e840-b218-820a4b0d6c52"],

Cell[BoxData[
 RowBox[{
  RowBox[{"timeSeriesPlot", "[", "]"}], " ", ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"frames", ",", " ", "history", ",", " ", "listOfBurnt"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"frames", " ", "=", " ", 
      RowBox[{"runFireSimulation", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"history", " ", "=", " ", 
      RowBox[{"frames", "[", "\"\<FireHistory\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"listOfBurnt", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"countBurned", "[", 
         RowBox[{"history", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "history", "]"}]}], " ", "}"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"Labeled", "[", 
      RowBox[{
       RowBox[{"BarChart", "[", 
        RowBox[{"listOfBurnt", ",", 
         RowBox[{"ColorFunction", "->", "\"\<SolarColors\>\""}], ",", 
         RowBox[{"ChartStyle", "->", "\"\<SolarColors\>\""}], ",", " ", 
         RowBox[{
         "PlotLabel", 
          "->", "\"\<Plotting Terrain Burnt Against Time Steps\>\""}]}], 
        "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Time Steps\>\"", ",", "\"\<Area Burnt\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Bottom", ",", "Left"}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.9607367637069817`*^9}, {
   3.9608215289614925`*^9, 3.9608215296641026`*^9}, {3.960851012459898*^9, 
   3.960851014905298*^9}, {3.960853507953272*^9, 3.960853567474924*^9}, {
   3.960882069985775*^9, 3.9608820703017673`*^9}, {3.9608822893224125`*^9, 
   3.960882294561611*^9}, {3.9608823687401543`*^9, 3.9608823766538296`*^9}, 
   3.9608824979550247`*^9, 3.9608888114359894`*^9, 3.961020702117777*^9, 
   3.9610535311369324`*^9, {3.961053616485199*^9, 3.9610536364047318`*^9}, {
   3.9610555715167694`*^9, 3.9610555720350246`*^9}, {3.961056812179535*^9, 
   3.961056817315378*^9}, 3.961058246972004*^9, {3.9610583493670406`*^9, 
   3.9610583531898174`*^9}, 3.9610782648551693`*^9, {3.9610799419548626`*^9, 
   3.9610799497203236`*^9}, 3.961079993103178*^9, {3.961095456704197*^9, 
   3.9610954691931095`*^9}, {3.961113296377268*^9, 3.961113332494068*^9}, {
   3.961150635190424*^9, 3.961150651097946*^9}},
 CellLabel->
  "In[115]:=",ExpressionUUID->"e2ccba17-ac1c-c549-9317-d0b3d0fee38d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"create3DTerrainArray", "[", 
   RowBox[{"elevationGrid_", ",", "terrainGrid_", ",", "gridSize_", ",", 
    RowBox[{"maxHeight_", ":", "50"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "array3D", ",", "scaledElevation", ",", "minElev", ",", "maxElev", ",", 
      " ", "height"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"minElev", "=", 
      RowBox[{"Min", "[", "elevationGrid", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"maxElev", "=", 
      RowBox[{"Max", "[", "elevationGrid", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"scaledElevation", "=", 
      RowBox[{"Rescale", "[", 
       RowBox[{"elevationGrid", ",", 
        RowBox[{"{", 
         RowBox[{"minElev", ",", "maxElev"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "maxHeight"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"array3D", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"maxHeight", ",", "gridSize", ",", "gridSize"}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"height", "=", 
         RowBox[{"Round", "[", 
          RowBox[{"scaledElevation", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"array3D", "[", 
            RowBox[{"[", 
             RowBox[{"h", ",", "i", ",", "j"}], "]"}], "]"}], "=", 
           RowBox[{"terrainGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"h", ",", "1", ",", "height"}], "}"}]}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "gridSize"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "gridSize"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "array3D"}]}], "]"}]}]], "Input",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{
  3.961019249469328*^9, 3.961019657527384*^9, 3.961019751519121*^9, {
   3.9610198236839256`*^9, 3.9610198566263523`*^9}, {3.9610198911239033`*^9, 
   3.961019922405594*^9}, 3.9610200476585865`*^9, {3.9610201487366695`*^9, 
   3.9610201624734936`*^9}, {3.9610202219768734`*^9, 3.9610203932842655`*^9}, 
   3.961020585568228*^9, {3.961020736032217*^9, 3.961020911755659*^9}, 
   3.961021175728647*^9, {3.9610568848952446`*^9, 3.961056891669256*^9}, {
   3.9610570345234985`*^9, 3.9610570414194393`*^9}, {3.9610572441077156`*^9, 
   3.961057264749264*^9}, {3.9610573409875813`*^9, 3.9610573416814632`*^9}, {
   3.9610573786627636`*^9, 3.9610575121603928`*^9}, {3.9610576005219173`*^9, 
   3.961057602644438*^9}, 3.9610639557984505`*^9, 3.961147618455822*^9, 
   3.961147945441929*^9},
 CellLabel->
  "In[116]:=",ExpressionUUID->"df968b51-9824-0a4d-9a4d-5a2a460619c2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mapFireTo3D", "[", 
    RowBox[{
    "array3D_", ",", "fireGrid_", ",", "terrainGrid_", ",", "elevGrid_", ",", 
     
     RowBox[{"maxH_", ":", "50"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"out", "=", "array3D"}], ",", 
       RowBox[{"minElev", "=", 
        RowBox[{"Min", "[", "elevGrid", "]"}]}], ",", 
       RowBox[{"maxElev", "=", 
        RowBox[{"Max", "[", "elevGrid", "]"}]}], ",", "scaledElevation", ",", 
       "h", ",", "f"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"scaledElevation", "=", 
       RowBox[{"Rescale", "[", 
        RowBox[{"elevGrid", ",", 
         RowBox[{"{", 
          RowBox[{"minElev", ",", "maxElev"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "maxH"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"h", "=", 
          RowBox[{"Round", "[", 
           RowBox[{"scaledElevation", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}]}], ";", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"true", " ", "top"}], "-", "of", "-", 
           RowBox[{"column", " ", "voxel"}]}], "*)"}], 
         RowBox[{"f", "=", 
          RowBox[{"fireGrid", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
         RowBox[{"(*", 
          RowBox[{"0", ",", 
           RowBox[{"1", "\[Ellipsis]10", " ", "or", " ", "11"}]}], "*)"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"f", ">", "0"}], ",", 
           RowBox[{"Which", "[", 
            RowBox[{
             RowBox[{"1", "<=", "f", "<=", "10"}], ",", 
             RowBox[{
              RowBox[{"out", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"1", ";;", "h"}], ",", "i", ",", "j"}], "]"}], "]"}],
               "=", 
              RowBox[{"20", "+", "f"}]}], ",", 
             RowBox[{"(*", 
              RowBox[{"21", "-", 
               RowBox[{"30", " ", "burning"}]}], "*)"}], 
             RowBox[{"f", "==", "11"}], ",", 
             RowBox[{
              RowBox[{"out", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"1", ";;", "h"}], ",", "i", ",", "j"}], "]"}], "]"}],
               "=", "35"}]}], "        ", 
            RowBox[{"(*", 
             RowBox[{"35", " ", "charred"}], "*)"}], "]"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "fireGrid", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "out"}]}], "]"}]}], "\n"}]], "Input",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{
  3.961019249469328*^9, 3.961019657527384*^9, 3.961019751519121*^9, {
   3.9610198236839256`*^9, 3.9610198566263523`*^9}, {3.9610198911239033`*^9, 
   3.961019922405594*^9}, 3.9610200476585865`*^9, {3.9610201487366695`*^9, 
   3.9610201624734936`*^9}, {3.9610202219768734`*^9, 3.9610203932842655`*^9}, 
   3.961020585568228*^9, {3.961020736032217*^9, 3.961020911755659*^9}, 
   3.961021175728647*^9, {3.9610568848952446`*^9, 3.961056891669256*^9}, {
   3.9610570345234985`*^9, 3.9610570414194393`*^9}, {3.9610572441077156`*^9, 
   3.961057279369314*^9}, {3.9610576171366005`*^9, 3.9610577743823586`*^9}, 
   3.961064676722908*^9, 3.961148117316736*^9, {3.962346074332304*^9, 
   3.9623460771720953`*^9}, {3.963251245269903*^9, 3.963251250725692*^9}, {
   3.9633288619909477`*^9, 3.963328872598428*^9}, {3.9633292197938757`*^9, 
   3.9633292565393257`*^9}, {3.9633295482122803`*^9, 3.963329551168151*^9}, {
   3.963329635618353*^9, 3.96332974706528*^9}, 3.963329968726355*^9, 
   3.9633301332960167`*^9},
 CellLabel->
  "In[117]:=",ExpressionUUID->"9bbdbf82-3b0c-3442-ab88-24b71fac3113"],

Cell[BoxData[
 RowBox[{
  RowBox[{"visualize3DFire", "[", 
   RowBox[{"array3D_", ",", 
    RowBox[{"timeLabel_", ":", "\"\<\>\""}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "voxelData", ",", "colorFun", ",", "xMax", ",", "yMax", ",", "zMax"}], 
     "}"}], ",", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"terrain", " ", 
       RowBox[{"colours", ":", 
        RowBox[{"codes", " ", "1"}]}]}], "\[Dash]", 
      RowBox[{
      "14", " ", "already", " ", "live", " ", "in", " ", "$terrainLookup"}]}],
      "*)"}], 
    RowBox[{
     RowBox[{
      RowBox[{"colorFun", "[", "val_", "]"}], ":=", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"val", "==", "0"}], ",", "Nothing", ",", 
        RowBox[{"(*", 
         RowBox[{"empty", " ", "voxel"}], "*)"}], 
        RowBox[{"1", "<=", "val", "<=", "14"}], ",", 
        RowBox[{"$terrainLookup", "[", "val", "]"}], ",", 
        RowBox[{"(*", 
         RowBox[{"all", " ", "terrains"}], "*)"}], 
        RowBox[{"21", "<=", "val", "<=", "30"}], ",", 
        RowBox[{"Blend", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Orange", ",", "Red"}], "}"}], ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"val", "-", "21"}], ")"}], "/", "9"}]}], "]"}], ",", 
        RowBox[{"(*", "burning", "*)"}], 
        RowBox[{"val", "==", "35"}], ",", "Black", ",", 
        RowBox[{"(*", "charred", "*)"}], "True", ",", "Gray"}], 
       "                       ", 
       RowBox[{"(*", "fallback", "*)"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"{", 
       RowBox[{"zMax", ",", "yMax", ",", "xMax"}], "}"}], "=", 
      RowBox[{"Dimensions", "[", "array3D", "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{"note", " ", 
       RowBox[{"order", "!"}]}], "*)"}], 
     RowBox[{"voxelData", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"code", "=", 
            RowBox[{"array3D", "[", 
             RowBox[{"[", 
              RowBox[{"z", ",", "y", ",", "x"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"code", "=!=", "0"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"colorFun", "[", "code", "]"}], ",", 
              RowBox[{"Cuboid", "[", 
               RowBox[{"{", 
                RowBox[{"x", ",", "y", ",", "z"}], "}"}], "]"}]}], "}"}], ",",
             "Nothing"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"z", ",", "zMax"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "yMax"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "xMax"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Graphics3D", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"EdgeForm", "[", "None", "]"}], ",", 
          RowBox[{"Flatten", "[", "voxelData", "]"}]}], "}"}], "//", 
        "Flatten"}], ",", 
       RowBox[{"Axes", "->", "True"}], ",", 
       RowBox[{"AxesLabel", "->", 
        RowBox[{"{", 
         RowBox[{"\"\<X\>\"", ",", "\"\<Y\>\"", ",", "\"\<Elevation\>\""}], 
         "}"}]}], ",", 
       RowBox[{"PlotLabel", "->", 
        RowBox[{"\"\<Fire Spread \>\"", "<>", "timeLabel"}]}], ",", 
       RowBox[{"ViewPoint", "->", 
        RowBox[{"{", 
         RowBox[{"2", ",", 
          RowBox[{"-", "2"}], ",", "1.5"}], "}"}]}], ",", 
       RowBox[{"Lighting", "->", "\"\<Neutral\>\""}], ",", 
       RowBox[{"ImageSize", "->", "Large"}], ",", 
       RowBox[{"Boxed", "->", "False"}]}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.963328312765808*^9, 3.9633283142734213`*^9}, {
   3.96412664546509*^9, 3.964126650772501*^9}, 3.964126735508215*^9, {
   3.964153561844322*^9, 3.964153579396743*^9}, {3.9641536389627857`*^9, 
   3.964153647817565*^9}, {3.96415371629185*^9, 3.964153747502191*^9}},
 CellLabel->
  "In[118]:=",ExpressionUUID->"ae38ac6d-4925-4cd2-9f29-341233abbe96"],

Cell[BoxData[
 RowBox[{
  RowBox[{"visualize3DFireSurface", "[", 
   RowBox[{"elevGrid_", ",", "fireGrid_", ",", "terrainGrid_", ",", 
    RowBox[{"timeLabel_", ":", "\"\<\>\""}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"display", ",", "colorFun"}], "}"}], ",", 
    RowBox[{"(*", 
     RowBox[{
     "1", " ", "\[FilledRightTriangle]", " ", "build", " ", "the", " ", 
      "display", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"grid", "--"}], "--"}], "--"}], "--"}], "--"}], 
                    "--"}], "--"}], "--"}], "--"}], "--"}], "--"}], "--"}], 
             "--"}], "--"}], "--"}], "--"}], "--"}], "--"}], "--"}]}], "*)"}], 
    RowBox[{
     RowBox[{"display", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{"1", "<=", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "<=", "10"}], ",", 
          RowBox[{"20", "+", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
          RowBox[{"(*", 
           RowBox[{"20", "-", "30"}], "*)"}], 
          RowBox[{
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "11"}], ",", "35", ",", 
          RowBox[{"(*", "charred", "*)"}], "True", ",", 
          RowBox[{"terrainGrid", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "fireGrid", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"fireGrid", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "2", " ", "\[FilledRightTriangle]", " ", "single", " ", "colour", " ", 
       "function", " ", "used", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"everywhere", "--"}], "--"}], "--"}], "--"}], "--"}],
              "--"}], "--"}], "--"}], "--"}], "--"}], "--"}]}], "*)"}], 
     RowBox[{
      RowBox[{"colorFun", "[", "val_", "]"}], ":=", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"val", "==", "0"}], ",", "Nothing", ",", 
        RowBox[{"1", "<=", "val", "<=", "14"}], ",", 
        RowBox[{"$terrainLookup", "[", "val", "]"}], ",", 
        RowBox[{"20", "<=", "val", "<=", "30"}], ",", 
        RowBox[{"Blend", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Orange", ",", "Red"}], "}"}], ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"val", "-", "20"}], ")"}], "/", "10"}]}], "]"}], ",", 
        RowBox[{"val", "==", "35"}], ",", "Black", ",", "True", ",", "Gray"}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ListPlot3D", "[", 
      RowBox[{"elevGrid", ",", 
       RowBox[{"ColorFunction", "->", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"colorFun", "@", 
           RowBox[{"display", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"Round", "[", "#2", "]"}], ",", 
              RowBox[{"Round", "[", "#1", "]"}]}], "]"}], "]"}]}], "&"}], 
         ")"}]}], ",", 
       RowBox[{"ColorFunctionScaling", "->", "False"}], ",", 
       RowBox[{"Mesh", "->", "None"}], ",", 
       RowBox[{"PlotLabel", "->", 
        RowBox[{"\"\<Fire Spread on Terrain \>\"", "<>", "timeLabel"}]}], ",", 
       RowBox[{"AxesLabel", "->", 
        RowBox[{"{", 
         RowBox[{"\"\<X\>\"", ",", "\"\<Y\>\"", ",", "\"\<Elevation\>\""}], 
         "}"}]}], ",", 
       RowBox[{"ViewPoint", "->", 
        RowBox[{"{", 
         RowBox[{"2", ",", 
          RowBox[{"-", "2"}], ",", "1.5"}], "}"}]}], ",", 
       RowBox[{"PlotRange", "->", "All"}], ",", 
       RowBox[{"ImageSize", "->", "Large"}]}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.963313362117654*^9, 3.963313363737154*^9}},
 CellLabel->
  "In[119]:=",ExpressionUUID->"2802e3a5-c6db-4d98-9ab1-b11cc2da101e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"satelliteImagery", "[", 
   RowBox[{"gridSize_", ",", "location_", ",", 
    RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "satelliteImage", ",", " ", "range", ",", " ", "riverImage", ",", " ", 
      "fullSatelliteImage"}], "}"}], ",", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"range", "=", 
      RowBox[{"Quantity", "[", 
       RowBox[{"rangeKM", ",", " ", "\"\<Kilometers\>\""}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"satelliteImage", " ", "=", " ", 
      RowBox[{"GeoImage", "[", 
       RowBox[{
        RowBox[{"GeoPosition", "[", "location", "]"}], ",", " ", 
        RowBox[{"GeoRange", "->", "range"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"riverImage", " ", "=", " ", "\[IndentingNewLine]", 
      RowBox[{"Rasterize", "[", 
       RowBox[{"ImageRecolor", "[", 
        RowBox[{
         RowBox[{"Binarize", "[", 
          RowBox[{"ColorNegate", "[", 
           RowBox[{"GeoImage", "[", 
            RowBox[{"location", ",", " ", 
             RowBox[{"GeoRange", " ", "->", " ", "range"}]}], "]"}], "]"}], 
          "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"White", " ", "->", " ", 
            RowBox[{"RGBColor", "[", 
             RowBox[{"0", ",", " ", "0", ",", " ", 
              RowBox[{"Rational", "[", 
               RowBox[{"2", ",", " ", "3"}], "]"}], ",", " ", "0.5"}], 
             "]"}]}], ",", " ", 
           RowBox[{"Black", " ", "->", " ", 
            RowBox[{"RGBColor", "[", 
             RowBox[{"0.5", ",", " ", "0.5", ",", " ", "0.5", ",", " ", "0"}],
              "]"}]}]}], "}"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"fullSatelliteImage", " ", "=", " ", 
      RowBox[{"ImageCompose", "[", 
       RowBox[{"satelliteImage", ",", " ", "riverImage"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ListPlot3D", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"QuantityMagnitude", "[", 
        RowBox[{"GeoElevationData", "[", 
         RowBox[{
          RowBox[{"GeoPosition", "[", "location", "]"}], ",", 
          RowBox[{"GeoRange", "->", "range"}]}], "]"}], "]"}], ",", " ", 
       RowBox[{"MeshFunctions", " ", "\[Rule]", " ", 
        RowBox[{"{", 
         RowBox[{"#3", " ", "&"}], "}"}]}], ",", " ", 
       RowBox[{"PlotRange", " ", "->", " ", "All"}], ",", " ", 
       RowBox[{"PlotStyle", " ", "->", " ", 
        RowBox[{"Texture", "[", 
         RowBox[{"ImageRotate", "[", 
          RowBox[{"fullSatelliteImage", ",", " ", 
           RowBox[{"3", " ", 
            RowBox[{"Pi", "/", "2"}]}]}], "]"}], "]"}]}], ",", " ", 
       RowBox[{"Filling", " ", "->", " ", "Bottom"}], ",", " ", 
       RowBox[{"FillingStyle", " ", "\[Rule]", " ", 
        RowBox[{"Opacity", "[", "1", "]"}]}], ",", " ", 
       RowBox[{"ImageSize", " ", "->", " ", "1000"}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{
  3.961019249469328*^9, 3.961019657527384*^9, 3.961019751519121*^9, {
   3.9610198236839256`*^9, 3.9610198566263523`*^9}, {3.9610198911239033`*^9, 
   3.961019922405594*^9}, 3.9610200476585865`*^9, {3.9610201487366695`*^9, 
   3.9610201624734936`*^9}, {3.9610202219768734`*^9, 3.9610203932842655`*^9}, 
   3.961020585568228*^9, {3.961020736032217*^9, 3.961020911755659*^9}, 
   3.961021175728647*^9, {3.9610568848952446`*^9, 3.961056891669256*^9}, {
   3.9610570345234985`*^9, 3.9610570414194393`*^9}, {3.9610572441077156`*^9, 
   3.9610572969849243`*^9}, {3.9610579271069527`*^9, 
   3.9610579608535137`*^9}, {3.961058013843725*^9, 3.96105813067153*^9}, {
   3.9610582718110104`*^9, 3.9610583179927464`*^9}, 3.961062284606779*^9, {
   3.961064789079359*^9, 3.9610648858194237`*^9}, {3.961080866263054*^9, 
   3.961080866924879*^9}, {3.9610954759921417`*^9, 3.961095512667198*^9}, 
   3.9611484725035076`*^9, {3.9611605332944603`*^9, 3.9611605495046024`*^9}, {
   3.96116209742968*^9, 3.9611621294562683`*^9}, {3.961164225649416*^9, 
   3.9611642305055676`*^9}, 3.9611644022873116`*^9, 3.9623619977457027`*^9, {
   3.962365505153241*^9, 3.962365517494182*^9}, {3.962365686383946*^9, 
   3.962365691189455*^9}, {3.9623680719788513`*^9, 3.962368088679596*^9}, {
   3.962369035975401*^9, 3.9623690505127106`*^9}},
 CellLabel->
  "In[120]:=",ExpressionUUID->"599bf2ab-016f-2d4b-8f64-48159cb8d469"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generate3DTerrain", "[", 
   RowBox[{"gridSize_", ",", " ", "location_", ",", 
    RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "mappedTerrain", ",", "heightArray", ",", "terrainTypeArray", ",", 
      "threeDPlot"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mappedTerrain", "=", 
      RowBox[{"mapTerrainValues", "[", 
       RowBox[{"gridSize", ",", "location", ",", "rangeKM"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"heightArray", "=", 
      RowBox[{"mappedTerrain", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"terrainTypeArray", "=", 
      RowBox[{"mappedTerrain", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"threeDPlot", " ", "=", "\n", "\t\t", 
      RowBox[{"ListPlot3D", "[", 
       RowBox[{"heightArray", ",", " ", 
        RowBox[{"ColorFunction", "->", " ", 
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x", ",", "y", ",", "z"}], "}"}], ",", " ", 
           RowBox[{"$terrainLookup", "[", 
            RowBox[{"terrainTypeArray", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"Round", "[", "y", "]"}], ",", 
               RowBox[{"Round", "[", "x", "]"}]}], "]"}], "]"}], "]"}]}], 
          "]"}]}], ",", " ", 
        RowBox[{"ColorFunctionScaling", " ", "->", " ", "False"}], ",", " ", 
        RowBox[{"Mesh", "->", "None"}]}], "\n", "\t\t", "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{
  3.961019249469328*^9, 3.961019657527384*^9, 3.961019751519121*^9, {
   3.9610198236839256`*^9, 3.9610198566263523`*^9}, {3.9610198911239033`*^9, 
   3.961019922405594*^9}, 3.9610200476585865`*^9, {3.9610201487366695`*^9, 
   3.9610201624734936`*^9}, {3.9610202219768734`*^9, 3.9610203932842655`*^9}, 
   3.961020585568228*^9, {3.961020736032217*^9, 3.961020911755659*^9}, 
   3.961021175728647*^9, {3.9610568848952446`*^9, 3.961056891669256*^9}, {
   3.9610570345234985`*^9, 3.9610570414194393`*^9}, {3.9610572441077156`*^9, 
   3.9610572969849243`*^9}, {3.9610579271069527`*^9, 
   3.9610579608535137`*^9}, {3.961058013843725*^9, 3.96105813067153*^9}, {
   3.9610582718110104`*^9, 3.9610583179927464`*^9}, 3.961062284606779*^9, {
   3.961064789079359*^9, 3.9610648858194237`*^9}, {3.961080866263054*^9, 
   3.961080866924879*^9}, {3.9610954759921417`*^9, 3.961095512667198*^9}, 
   3.9611484725035076`*^9, {3.9611605332944603`*^9, 3.961160548318983*^9}, 
   3.9611610319674206`*^9, 3.961161465133753*^9, {3.9611621321229*^9, 
   3.9611621363964386`*^9}, {3.9611642395635586`*^9, 3.9611642411830673`*^9}, 
   3.961164407696329*^9, 3.9611656044775753`*^9, {3.962368304461649*^9, 
   3.9623683141279926`*^9}, {3.9623686405105133`*^9, 3.9623686432404785`*^9}},
 
 CellLabel->
  "In[121]:=",ExpressionUUID->"2ac75469-9924-d84d-ad47-42231ee57918"],

Cell[BoxData[
 RowBox[{
  RowBox[{"run3DFireSimulation", "[", 
   RowBox[{
    RowBox[{"gridSize_", ":", "40"}], ",", 
    RowBox[{"initialFires_", ":", "2"}], ",", 
    RowBox[{"timeSteps_", ":", "20"}], ",", 
    RowBox[{"ignitionProbability_", ":", "0.8"}], ",", 
    RowBox[{"windSpeed_", ":", "0.3"}], ",", 
    RowBox[{"windDirection_", ":", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}]}], ",", 
    RowBox[{"moisture_", ":", "0.2"}], ",", 
    RowBox[{"uphillMultiplier_", ":", "1.5"}], ",", 
    RowBox[{"downhillMultiplier_", ":", "0.7"}], ",", 
    RowBox[{"location_", ":", "Automatic"}], ",", 
    RowBox[{"maxHeight_", ":", "30"}], ",", 
    RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "terrainAndElev", ",", "terrainGrid", ",", "elevationGrid", ",", 
      "fireGrid", ",", "actualLocation", ",", "firePoints", ",", "result", ",",
       "fireHistory", ",", "array3D", ",", "animation3D", ",", 
      "animationSurface", ",", "gridPos", ",", "terrain", ",", "props", ",", 
      "fire3D"}], "}"}], ",", 
    RowBox[{
     RowBox[{"actualLocation", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"location", "===", "Automatic"}], ",", 
        RowBox[{"getRandomEarthLocation", "[", "]"}], ",", "location"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"terrainAndElev", "=", 
      RowBox[{"initializeTerrainGrid", "[", 
       RowBox[{"gridSize", ",", "actualLocation", ",", "rangeKM"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"terrainGrid", "=", 
      RowBox[{"terrainAndElev", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"elevationGrid", "=", 
      RowBox[{"terrainAndElev", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fireGrid", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"gridSize", ",", "gridSize"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"array3D", "=", 
      RowBox[{"create3DTerrainArray", "[", 
       RowBox[{
       "elevationGrid", ",", "terrainGrid", ",", "gridSize", ",", 
        "maxHeight"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"result", "=", 
      RowBox[{"DialogInput", "[", 
       RowBox[{"DynamicModule", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"currentPoint", "=", 
            RowBox[{"{", 
             RowBox[{"15", ",", "15"}], "}"}]}], ",", 
           RowBox[{"selectedPoints", "=", 
            RowBox[{"{", "}"}]}]}], "}"}], ",", 
         RowBox[{"Column", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
            "Text", "[", "\"\<Click on the terrain to place fire starting \
points\>\"", "]"}], ",", 
            RowBox[{"Text", "[", 
             RowBox[{"Dynamic", "[", 
              RowBox[{"\"\<Points selected: \>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"Length", "[", "selectedPoints", "]"}], "]"}], 
               "<>", "\"\</\>\"", "<>", 
               RowBox[{"ToString", "[", "initialFires", "]"}]}], "]"}], "]"}],
             ",", 
            RowBox[{"LocatorPane", "[", 
             RowBox[{
              RowBox[{"Dynamic", "[", "currentPoint", "]"}], ",", 
              RowBox[{"plotTerrain", "[", 
               RowBox[{
               "terrainGrid", ",", "\"\<Select Fire Starting Points\>\""}], 
               "]"}], ",", 
              RowBox[{"Appearance", "->", 
               RowBox[{"Graphics", "[", 
                RowBox[{"{", 
                 RowBox[{"Red", ",", 
                  RowBox[{"PointSize", "[", "0.05", "]"}], ",", 
                  RowBox[{"Point", "[", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], "]"}]}], "}"}], "]"}]}]}],
              "]"}], ",", 
            RowBox[{"Row", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Add Fire Point\>\"", ",", 
                 RowBox[{
                  RowBox[{"gridPos", "=", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Clip", "[", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{"gridSize", "-", 
                    RowBox[{"currentPoint", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "gridSize"}], "}"}]}], "]"}], ",", 
                    RowBox[{"Clip", "[", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{"currentPoint", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "gridSize"}], "}"}]}], "]"}]}], "}"}]}],
                   ";", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"terrainGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"gridPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "!=", 
                    "6"}], ",", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"selectedPoints", ",", "gridPos"}], "]"}], ",", 
                    RowBox[{
                    "MessageDialog", 
                    "[", "\"\<Cannot place fire on water!\>\"", "]"}]}], 
                   "]"}]}], ",", 
                 RowBox[{"Enabled", "->", 
                  RowBox[{"Dynamic", "[", 
                   RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], "<", 
                    "initialFires"}], "]"}]}]}], "]"}], ",", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Reset\>\"", ",", 
                 RowBox[{"selectedPoints", "=", 
                  RowBox[{"{", "}"}]}]}], "]"}], ",", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Run Simulation\>\"", ",", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], ">", 
                    "0"}], ",", 
                   RowBox[{"DialogReturn", "[", "selectedPoints", "]"}], ",", 
                   
                   RowBox[{
                   "MessageDialog", 
                    "[", "\"\<Please select at least one fire point!\>\"", 
                    "]"}]}], "]"}], ",", 
                 RowBox[{"Enabled", "->", 
                  RowBox[{"Dynamic", "[", 
                   RowBox[{
                    RowBox[{"Length", "[", "selectedPoints", "]"}], ">", 
                    "0"}], "]"}]}]}], "]"}], ",", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Cancel\>\"", ",", 
                 RowBox[{"DialogReturn", "[", "$Canceled", "]"}]}], "]"}]}], 
              "}"}], "]"}]}], "}"}], "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"result", "===", "$Canceled"}], ",", 
       RowBox[{"Return", "[", "$Canceled", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"firePoints", "=", "result"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"terrain", "=", 
         RowBox[{"terrainGrid", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"props", "=", 
         RowBox[{"getPatchProperties", "[", "terrain", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fireGrid", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "=", 
         RowBox[{"props", "[", "\"\<burnTime\>\"", "]"}]}], ";"}], ",", 
       RowBox[{"{", 
        RowBox[{"pos", ",", "firePoints"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fireHistory", "=", 
      RowBox[{"NestList", "[", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{"fg", ",", 
          RowBox[{"Module", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"tg4", ",", "eg4", ",", "fg4", ",", "upd"}], "}"}], ",", 
            
            RowBox[{
             RowBox[{"tg4", "=", 
              RowBox[{"{", 
               RowBox[{"{", "terrainGrid", "}"}], "}"}]}], ";", 
             RowBox[{"(*", 
              RowBox[{"1", "\[Times]", "1", " ", "region", " ", "wrap"}], 
              "*)"}], 
             RowBox[{"eg4", "=", 
              RowBox[{"{", 
               RowBox[{"{", "elevationGrid", "}"}], "}"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"fg4", "=", 
              RowBox[{"{", 
               RowBox[{"{", "fg", "}"}], "}"}]}], ";", "\[IndentingNewLine]", 
             
             RowBox[{"upd", "=", 
              RowBox[{"updateAllFireRegions", "[", 
               RowBox[{
               "tg4", ",", "fg4", ",", "eg4", ",", "gridSize", ",", "1", ",", 
                "1", ",", "ignitionProbability", ",", "windSpeed", ",", 
                "windDirection", ",", "moisture", ",", "0.0", ",", 
                RowBox[{"(*", 
                 RowBox[{"interRegionSpreadProb", " ", 
                  RowBox[{"(", 
                   RowBox[{"unused", " ", "for", " ", "1", "\[Times]", "1"}], 
                   ")"}]}], "*)"}], "uphillMultiplier", ",", 
                "downhillMultiplier"}], "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "emberRadius", " ", "uses", " ", "default", " ", "8"}], 
                "*)"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"upd", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], 
           "                      ", 
           RowBox[{"(*", 
            RowBox[{"unwrap", " ", "back", " ", "to", " ", "2", "D"}], "*)"}],
            "]"}]}], "]"}], ",", "fireGrid", ",", "timeSteps"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"animation3D", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"fire3D", "=", 
          RowBox[{"mapFireTo3D", "[", 
           RowBox[{"array3D", ",", 
            RowBox[{"fireHistory", "[", 
             RowBox[{"[", "t", "]"}], "]"}], ",", "terrainGrid", ",", 
            "elevationGrid", ",", "maxHeight"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"visualize3DFire", "[", 
          RowBox[{"fire3D", ",", 
           RowBox[{"\"\<Time: \>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"t", "-", "1"}], "]"}]}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"Length", "[", "fireHistory", "]"}]}], "}"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"animationSurface", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"visualize3DFireSurface", "[", 
         RowBox[{"elevationGrid", ",", 
          RowBox[{"fireHistory", "[", 
           RowBox[{"[", "t", "]"}], "]"}], ",", "terrainGrid", ",", 
          RowBox[{"\"\<Time: \>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"t", "-", "1"}], "]"}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"Length", "[", "fireHistory", "]"}]}], "}"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<VoxelAnimation\>\"", "->", 
        RowBox[{"ListAnimate", "[", 
         RowBox[{"animation3D", ",", 
          RowBox[{"AnimationRunning", "->", "True"}], ",", 
          RowBox[{"AnimationRate", "->", "1"}]}], "]"}]}], ",", 
       RowBox[{"\"\<FireHistory\>\"", "->", "fireHistory"}], ",", 
       RowBox[{"\"\<TerrainGrid\>\"", "->", "terrainGrid"}], ",", 
       RowBox[{"\"\<ElevationGrid\>\"", "->", "elevationGrid"}], ",", 
       RowBox[{"\"\<Location\>\"", "->", "actualLocation"}], ",", 
       RowBox[{"\"\<FinalVoxelPlot\>\"", "->", 
        RowBox[{"Last", "[", "animation3D", "]"}]}], ",", 
       RowBox[{"\"\<FinalSurfacePlot\>\"", "->", 
        RowBox[{"Last", "[", "animationSurface", "]"}]}]}], "|>"}]}]}], 
   "]"}]}]], "Input",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{
  3.961019249469328*^9, 3.961019657527384*^9, 3.961019751519121*^9, {
   3.9610198236839256`*^9, 3.9610198566263523`*^9}, {3.9610198911239033`*^9, 
   3.961019922405594*^9}, 3.9610200476585865`*^9, {3.9610201487366695`*^9, 
   3.9610201624734936`*^9}, {3.9610202219768734`*^9, 3.9610203932842655`*^9}, 
   3.961020585568228*^9, {3.961020736032217*^9, 3.961020911755659*^9}, 
   3.961021175728647*^9, {3.9610568848952446`*^9, 3.961056891669256*^9}, {
   3.9610570345234985`*^9, 3.9610570414194393`*^9}, {3.9610572441077156`*^9, 
   3.9610572969849243`*^9}, {3.9610579271069527`*^9, 
   3.9610579608535137`*^9}, {3.961058013843725*^9, 3.96105813067153*^9}, {
   3.9610582718110104`*^9, 3.9610583179927464`*^9}, 3.961062284606779*^9, {
   3.961064789079359*^9, 3.9610648858194237`*^9}, 3.961080866263054*^9, 
   3.9610810281542835`*^9, 3.9610842765115337`*^9, {3.962337308401782*^9, 
   3.962337310825856*^9}, {3.9623683219370728`*^9, 3.9623683264609528`*^9}, {
   3.96236835719973*^9, 3.962368358205181*^9}, {3.9641540883327303`*^9, 
   3.964154089741171*^9}},
 CellLabel->
  "In[122]:=",ExpressionUUID->"cdf089a7-25fc-534c-8f37-a105b4d01e6b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"predictFireSpread", "[", 
   RowBox[{
   "terrainGrid_", ",", "elevationGrid_", ",", "windSpeed_", ",", 
    "windDirection_", ",", "moisture_", ",", "gridSize_", ",", 
    RowBox[{"predictionSteps_", ":", "10"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "riskMap", ",", "patchProps", ",", "windFactor", ",", "moistureFactor", ",",
       "slopeFactor", ",", "neighbors", ",", "avgRisk", ",", 
      "windAlignment"}], "}"}], ",", 
    RowBox[{
     RowBox[{"riskMap", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"0.0", ",", 
        RowBox[{"{", "gridSize", "}"}], ",", 
        RowBox[{"{", "gridSize", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"terrainGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "6"}], "||", 
          RowBox[{
           RowBox[{"terrainGrid", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "3"}]}], ",", 
         RowBox[{
          RowBox[{"riskMap", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", "0"}], ",", 
         RowBox[{
          RowBox[{"patchProps", "=", 
           RowBox[{"getPatchProperties", "[", 
            RowBox[{"terrainGrid", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"riskMap", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"7", "-", 
              RowBox[{"patchProps", "[", "\"\<flammability\>\"", "]"}]}], 
             ")"}], "/", "6.0"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"moistureFactor", "=", 
           RowBox[{"1", "-", "moisture"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"riskMap", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "*=", "moistureFactor"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"windFactor", "=", 
           RowBox[{"1", "+", 
            RowBox[{"windSpeed", "*", "2"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"neighbors", "=", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"i", "-", "1"}], ",", 
                 RowBox[{"j", "-", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"i", "-", "1"}], ",", "j"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"i", "-", "1"}], ",", 
                 RowBox[{"j", "+", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"j", "-", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"j", "+", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"i", "+", "1"}], ",", 
                 RowBox[{"j", "-", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"i", "+", "1"}], ",", "j"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"i", "+", "1"}], ",", 
                 RowBox[{"j", "+", "1"}]}], "}"}]}], "}"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"1", "<=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "<=", "gridSize"}], "&&", 
               RowBox[{"1", "<=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "<=", "gridSize"}]}], 
              "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"avgRisk", "=", 
           RowBox[{"Mean", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"terrainGrid", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"n", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"n", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "==", 
                  "6"}], "||", 
                 RowBox[{
                  RowBox[{"terrainGrid", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"n", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"n", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "==", 
                  "3"}]}], ",", "0", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"7", "-", 
                   RowBox[{
                    RowBox[{"getPatchProperties", "[", 
                    RowBox[{"terrainGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"n", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"n", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "\"\<flammability\>\"", "]"}], "]"}]}], 
                  ")"}], "/", "6.0"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", "neighbors"}], "}"}]}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"riskMap", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"0.7", "*", 
             RowBox[{"riskMap", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "+", 
            RowBox[{"0.3", "*", "avgRisk"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"windAlignment", "=", 
              RowBox[{"windDirection", ".", 
               RowBox[{"Normalize", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"n", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "i"}], ",", 
                  RowBox[{
                   RowBox[{"n", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "-", "j"}]}], "}"}], 
                "]"}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"windAlignment", ">", "0.5"}], ",", 
               RowBox[{
                RowBox[{"riskMap", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], "+=", 
                RowBox[{"0.2", "*", "windSpeed", "*", "windAlignment"}]}]}], 
              "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "neighbors"}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"slopeFactor", "=", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"elevationGrid", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"n", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"n", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "-", 
                RowBox[{"elevationGrid", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ")"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"slopeFactor", ">", "0"}], ",", 
               RowBox[{
                RowBox[{"riskMap", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], "*=", 
                RowBox[{"(", 
                 RowBox[{"1", "+", 
                  RowBox[{"0.3", "*", 
                   RowBox[{"Tanh", "[", 
                    RowBox[{"slopeFactor", "*", "10"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"riskMap", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], "*=", 
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  RowBox[{"0.2", "*", 
                   RowBox[{"Tanh", "[", 
                    RowBox[{
                    RowBox[{"Abs", "[", "slopeFactor", "]"}], "*", "10"}], 
                    "]"}]}]}], ")"}]}]}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "neighbors"}], "}"}]}], "]"}], ";"}]}], "]"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "gridSize"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "gridSize"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"riskMap", "=", 
      RowBox[{"Rescale", "[", 
       RowBox[{"riskMap", ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"Max", "[", "riskMap", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"riskMap", "=", 
      RowBox[{"riskMap", "^", "1.5"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"GaussianFilter", "[", 
      RowBox[{"riskMap", ",", "2"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.960736793277609*^9}, {
   3.9608256334891243`*^9, 3.9608257464847717`*^9}, {3.960825811866663*^9, 
   3.9608258224095097`*^9}, {3.960825880602461*^9, 3.960825883797512*^9}, 
   3.960882703980961*^9, {3.961066165303526*^9, 3.9610661781692963`*^9}, {
   3.961066216831787*^9, 3.961066220117161*^9}, {3.9610664685935383`*^9, 
   3.96106648910433*^9}, {3.9611011553447685`*^9, 3.961101164699402*^9}, 
   3.9611012119572296`*^9, 3.9611019017121086`*^9, {3.961103497677809*^9, 
   3.9611034983636284`*^9}, 3.9611431351609592`*^9, {3.9611432042830353`*^9, 
   3.96114324507963*^9}},
 CellLabel->
  "In[123]:=",ExpressionUUID->"368c5096-3ebc-f84e-b373-2814b5984bd5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"applyControlledBurnStrategy", "[", 
   RowBox[{
   "terrainGrid_", ",", "elevationGrid_", ",", "windSpeed_", ",", 
    "windDirection_", ",", "moisture_", ",", "gridSize_", ",", 
    RowBox[{"showVisualization_", ":", "True"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "riskMap", ",", "burnPatches", ",", "corridorBreaks", ",", 
      "modifiedTerrain", ",", "allBurnCells", ",", "patchBurnArea", ",", 
      "corridorBurnArea"}], "}"}], ",", 
    RowBox[{
     RowBox[{"riskMap", "=", 
      RowBox[{"predictFireSpread", "[", 
       RowBox[{
       "terrainGrid", ",", "elevationGrid", ",", "windSpeed", ",", 
        "windDirection", ",", "moisture", ",", "gridSize"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"showVisualization", ",", 
       RowBox[{"Grid", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ArrayPlot", "[", 
             RowBox[{"riskMap", ",", 
              RowBox[{"ColorFunction", "->", "\"\<TemperatureMap\>\""}], ",", 
              
              RowBox[{"PlotLabel", "->", "\"\<Fire Risk Map\>\""}], ",", 
              RowBox[{"ImageSize", "->", "300"}]}], "]"}], ",", 
            RowBox[{"ArrayPlot", "[", 
             RowBox[{"terrainGrid", ",", 
              RowBox[{"ColorRules", "->", "$terrainColorRules"}], ",", 
              RowBox[{"PlotLabel", "->", "\"\<Original Terrain\>\""}], ",", 
              RowBox[{"ImageSize", "->", "300"}]}], "]"}]}], "}"}], "}"}], ",", 
         RowBox[{"Frame", "->", "All"}], ",", 
         RowBox[{"FrameStyle", "->", "LightGray"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.960736793277609*^9}, {
   3.9608256334891243`*^9, 3.9608257464847717`*^9}, {3.960825811866663*^9, 
   3.9608258224095097`*^9}, {3.960825880602461*^9, 3.960825883797512*^9}, 
   3.960882703980961*^9, {3.961066165303526*^9, 3.9610661781692963`*^9}, {
   3.961066216831787*^9, 3.961066220117161*^9}, {3.9610664685935383`*^9, 
   3.96106648910433*^9}, {3.9611011553447685`*^9, 3.961101164699402*^9}, 
   3.9611012119572296`*^9, {3.961103323028406*^9, 3.9611033273105087`*^9}, {
   3.961103506573805*^9, 3.961103541995678*^9}, {3.9611431586557083`*^9, 
   3.9611431597676353`*^9}, {3.9611432493510227`*^9, 3.961143252117676*^9}, {
   3.9611434513929977`*^9, 3.9611434572628555`*^9}, {3.961143506686657*^9, 
   3.961143532319439*^9}, 3.961162207319044*^9},
 CellLabel->
  "In[124]:=",ExpressionUUID->"2959dc27-2a5e-7e48-b08b-d5abeccb9d0b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"visualizeRisks", "[", 
   RowBox[{
    RowBox[{"gridSize_", ":", "50"}], ",", " ", 
    RowBox[{"windSpeed_", ":", "0"}], ",", " ", 
    RowBox[{"windDirection_", ":", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}]}], ",", " ", 
    RowBox[{"moisture_", ":", "0"}], ",", 
    RowBox[{"rangeKM_", ":", "1.0"}]}], "]"}], " ", ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "location", ",", " ", "terrainAndElev", ",", " ", "terrainGrid", ",", 
      " ", "elevationGrid"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"location", "=", 
      RowBox[{"getRandomEarthLocation", "[", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"terrainAndElev", "=", 
      RowBox[{"initializeTerrainGrid", "[", 
       RowBox[{"50", ",", "location"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"terrainGrid", "=", 
      RowBox[{"terrainAndElev", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"elevationGrid", "=", 
      RowBox[{"terrainAndElev", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"applyControlledBurnStrategy", "[", 
      RowBox[{
      "terrainGrid", ",", " ", "elevationGrid", ",", "windSpeed", ",", " ", 
       "windDirection", ",", "moisture", ",", "gridSize"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.9607367581890583`*^9, 3.960736793277609*^9}, {
   3.9608256334891243`*^9, 3.9608257464847717`*^9}, {3.960825811866663*^9, 
   3.9608258224095097`*^9}, {3.960825880602461*^9, 3.960825883797512*^9}, 
   3.960882703980961*^9, {3.961066165303526*^9, 3.9610661781692963`*^9}, {
   3.961066216831787*^9, 3.961066220117161*^9}, {3.9610664685935383`*^9, 
   3.96106648910433*^9}, {3.9611011553447685`*^9, 3.961101164699402*^9}, 
   3.9611012119572296`*^9, {3.961103323028406*^9, 3.961103329648525*^9}, 
   3.961103606535824*^9, {3.9611432678526917`*^9, 3.9611434307843475`*^9}, {
   3.961143484972645*^9, 3.9611434866016903`*^9}, 3.961166537662548*^9, {
   3.9623683737997036`*^9, 3.962368378468233*^9}, 3.962411188264433*^9},
 CellLabel->
  "In[125]:=",ExpressionUUID->"39622a8d-f5f5-c140-b1d6-1ba0ad41036b"]
},
WindowSize->{1026, 927},
WindowMargins->{{Automatic, 46}, {Automatic, 0}},
Magnification:>1.1 Inherited,
FrontEndVersion->"14.3 for Mac OS X ARM (64-bit) (July 8, 2025)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"468298ce-fc02-dc43-8fee-3233b58223fc"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[554, 20, 4711, 108, 301, "Input",ExpressionUUID->"768da140-46fd-fc4d-b7f7-0aa72e58ae79"],
Cell[5268, 130, 1204, 32, 77, "Input",ExpressionUUID->"38863809-cbbb-476e-bfa9-9f8a470bb97f"],
Cell[6475, 164, 7892, 226, 324, "Input",ExpressionUUID->"0666a3dd-7178-704d-b657-fc28c92475a3"],
Cell[14370, 392, 1427, 27, 122, "Input",ExpressionUUID->"d87ea8f4-d142-5048-bc62-77f02a01d10c"],
Cell[15800, 421, 882, 24, 77, "Input",ExpressionUUID->"a4b8d42e-0feb-4466-8d8c-c31d4e2e7047"],
Cell[16685, 447, 1551, 41, 122, "Input",ExpressionUUID->"d76a9bca-33ec-420d-b24b-3b4c2dd62d59"],
Cell[18239, 490, 1848, 47, 212, "Input",ExpressionUUID->"cffd2813-845a-40f2-b83c-dd67e18b914f"],
Cell[20090, 539, 2312, 50, 144, "Input",ExpressionUUID->"7187de4f-acf5-c241-8ca3-53da990091ff"],
Cell[22405, 591, 3461, 81, 279, "Input",ExpressionUUID->"8efdc0f2-844d-4199-9238-e642a8a87cd2"],
Cell[25869, 674, 3229, 69, 346, "Input",ExpressionUUID->"15a996ff-97ba-fe4f-ba42-7a8539a08c4c"],
Cell[29101, 745, 6206, 130, 728, "Input",ExpressionUUID->"1bcc62c0-2646-4f2b-adb5-69ebbb3730ad"],
Cell[35310, 877, 1820, 41, 122, "Input",ExpressionUUID->"a4fce2ce-228f-1c43-9b68-d5e7ac4ba401"],
Cell[37133, 920, 4166, 113, 301, "Input",ExpressionUUID->"dfc5ae06-a454-4aa6-a3af-7868802cee2d"],
Cell[41302, 1035, 13006, 299, 998, "Input",ExpressionUUID->"b3948862-fc5b-450a-abca-be01d1beed51"],
Cell[54311, 1336, 1044, 19, 54, "Input",ExpressionUUID->"25564546-6bba-864e-b3ce-ae78c09daf74"],
Cell[55358, 1357, 2549, 60, 122, "Input",ExpressionUUID->"b7ebc6ff-7b15-5e46-9415-d17d2acb89f7"],
Cell[57910, 1419, 1919, 44, 144, "Input",ExpressionUUID->"4939bdab-b121-3b4e-9dcc-952c421ac91d"],
Cell[59832, 1465, 1189, 26, 77, "Input",ExpressionUUID->"db3623ff-0adc-1a45-9a39-330368b9cab0"],
Cell[61024, 1493, 1447, 32, 77, "Input",ExpressionUUID->"a7c6b6b1-599e-4e4e-8a73-b13435879e7c"],
Cell[CellGroupData[{
Cell[62496, 1529, 12938, 288, 908, "Input",ExpressionUUID->"433b8f1f-f250-b441-a8db-15ef350cdd16"],
Cell[75437, 1819, 4111, 61, 82, "Message",ExpressionUUID->"a655a2b6-7409-4cca-84ef-adb85307ad5e"],
Cell[79551, 1882, 4111, 61, 82, "Message",ExpressionUUID->"97d98cb2-826f-409c-bbf6-5ff63ae27cc0"]
}, Open  ]],
Cell[83677, 1946, 1538, 27, 99, "Input",ExpressionUUID->"864aa9b8-02af-4548-98b3-87d5a98f48f6"],
Cell[85218, 1975, 2535, 58, 301, "Input",ExpressionUUID->"e02be539-e7e9-4b36-a325-ddabfb0e00bb"],
Cell[87756, 2035, 10834, 241, 931, "Input",ExpressionUUID->"1e9b58e1-29de-e840-b218-820a4b0d6c52"],
Cell[98593, 2278, 2567, 53, 189, "Input",ExpressionUUID->"e2ccba17-ac1c-c549-9317-d0b3d0fee38d"],
Cell[101163, 2333, 3100, 72, 234, "Input",ExpressionUUID->"df968b51-9824-0a4d-9a4d-5a2a460619c2"],
Cell[104266, 2407, 4105, 98, 234, "Input",ExpressionUUID->"9bbdbf82-3b0c-3442-ab88-24b71fac3113"],
Cell[108374, 2507, 4090, 106, 324, "Input",ExpressionUUID->"ae38ac6d-4925-4cd2-9f29-341233abbe96"],
Cell[112467, 2615, 4746, 128, 234, "Input",ExpressionUUID->"2802e3a5-c6db-4d98-9ab1-b11cc2da101e"],
Cell[117216, 2745, 4502, 93, 301, "Input",ExpressionUUID->"599bf2ab-016f-2d4b-8f64-48159cb8d469"],
Cell[121721, 2840, 3200, 66, 256, "Input",ExpressionUUID->"2ac75469-9924-d84d-ad47-42231ee57918"],
Cell[124924, 2908, 14088, 321, 1065, "Input",ExpressionUUID->"cdf089a7-25fc-534c-8f37-a105b4d01e6b"],
Cell[139015, 3231, 10531, 256, 593, "Input",ExpressionUUID->"368c5096-3ebc-f84e-b373-2814b5984bd5"],
Cell[149549, 3489, 2704, 56, 256, "Input",ExpressionUUID->"2959dc27-2a5e-7e48-b08b-d5abeccb9d0b"],
Cell[152256, 3547, 2275, 47, 189, "Input",ExpressionUUID->"39622a8d-f5f5-c140-b1d6-1ba0ad41036b"]
}
]
*)

